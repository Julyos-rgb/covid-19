{"remainingRequest":"E:\\疫情防控管理系统\\vue_epidemic\\node_modules\\thread-loader\\dist\\cjs.js!E:\\疫情防控管理系统\\vue_epidemic\\node_modules\\babel-loader\\lib\\index.js!E:\\疫情防控管理系统\\vue_epidemic\\src\\components\\socket\\weapp.socket.io.js","dependencies":[{"path":"E:\\疫情防控管理系统\\vue_epidemic\\src\\components\\socket\\weapp.socket.io.js","mtime":1620538518000},{"path":"E:\\疫情防控管理系统\\vue_epidemic\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\疫情防控管理系统\\vue_epidemic\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\疫情防控管理系统\\vue_epidemic\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:cmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnN5bWJvbCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnN5bWJvbC5kZXNjcmlwdGlvbiIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnN5bWJvbC5zcGVjaWVzIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sLnRvLXN0cmluZy10YWciKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5jb25jYXQiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5maWxsIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZm9yLWVhY2giKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5pbmNsdWRlcyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmluZGV4LW9mIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuam9pbiIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5Lmxhc3QtaW5kZXgtb2YiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5tYXAiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5yZWR1Y2UiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zbGljZSIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnNwZWNpZXMiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zcGxpY2UiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS1idWZmZXIuY29uc3RydWN0b3IiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5mdW5jdGlvbi5uYW1lIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuanNvbi50by1zdHJpbmctdGFnIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMubWF0aC50by1zdHJpbmctdGFnIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMubnVtYmVyLmNvbnN0cnVjdG9yIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMubnVtYmVyLmlzLW5hbiIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5nZXQtb3duLXByb3BlcnR5LW5hbWVzIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmdldC1wcm90b3R5cGUtb2YiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3Qua2V5cyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmciKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5yZWZsZWN0LmFwcGx5Iik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMucmVmbGVjdC5vd24ta2V5cyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC5leGVjIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmZsYWdzIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLnRvLXN0cmluZyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pbmNsdWRlcyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5tYXRjaCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5yZXBsYWNlIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnNlYXJjaCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5zcGxpdCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy50cmltIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkudWludDgtYXJyYXkiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5jb3B5LXdpdGhpbiIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LmV2ZXJ5Iik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuZmlsbCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LmZpbHRlciIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LmZpbmQiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5maW5kLWluZGV4Iik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuZm9yLWVhY2giKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5pbmNsdWRlcyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LmluZGV4LW9mIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuaXRlcmF0b3IiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5qb2luIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkubGFzdC1pbmRleC1vZiIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5Lm1hcCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LnJlZHVjZSIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LnJlZHVjZS1yaWdodCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LnJldmVyc2UiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5zZXQiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5zbGljZSIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LnNvbWUiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5zb3J0Iik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuc3ViYXJyYXkiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS50by1sb2NhbGUtc3RyaW5nIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkudG8tc3RyaW5nIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5mb3ItZWFjaCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL3dlYi51cmwudG8tanNvbiIpOwoKdmFyIF9vYmplY3RTcHJlYWQgPSByZXF1aXJlKCJFOi9cdTc1QUJcdTYwQzVcdTk2MzJcdTYzQTdcdTdCQTFcdTc0MDZcdTdDRkJcdTdFREYvdnVlX2VwaWRlbWljL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL29iamVjdFNwcmVhZDIiKTsKCnZhciBfY2xhc3NDYWxsQ2hlY2sgPSByZXF1aXJlKCJFOi9cdTc1QUJcdTYwQzVcdTk2MzJcdTYzQTdcdTdCQTFcdTc0MDZcdTdDRkJcdTdFREYvdnVlX2VwaWRlbWljL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2NsYXNzQ2FsbENoZWNrIik7Cgp2YXIgX2NyZWF0ZUNsYXNzID0gcmVxdWlyZSgiRTovXHU3NUFCXHU2MEM1XHU5NjMyXHU2M0E3XHU3QkExXHU3NDA2XHU3Q0ZCXHU3RURGL3Z1ZV9lcGlkZW1pYy9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9jcmVhdGVDbGFzcyIpOwoKdmFyIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQgPSByZXF1aXJlKCJFOi9cdTc1QUJcdTYwQzVcdTk2MzJcdTYzQTdcdTdCQTFcdTc0MDZcdTdDRkJcdTdFREYvdnVlX2VwaWRlbWljL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2Fzc2VydFRoaXNJbml0aWFsaXplZCIpOwoKdmFyIF9pbmhlcml0cyA9IHJlcXVpcmUoIkU6L1x1NzVBQlx1NjBDNVx1OTYzMlx1NjNBN1x1N0JBMVx1NzQwNlx1N0NGQlx1N0VERi92dWVfZXBpZGVtaWMvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvaW5oZXJpdHMiKTsKCnZhciBfY3JlYXRlU3VwZXIgPSByZXF1aXJlKCJFOi9cdTc1QUJcdTYwQzVcdTk2MzJcdTYzQTdcdTdCQTFcdTc0MDZcdTdDRkJcdTdFREYvdnVlX2VwaWRlbWljL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2NyZWF0ZVN1cGVyIik7Cgp2YXIgX3R5cGVvZiA9IHJlcXVpcmUoIkU6L1x1NzVBQlx1NjBDNVx1OTYzMlx1NjNBN1x1N0JBMVx1NzQwNlx1N0NGQlx1N0VERi92dWVfZXBpZGVtaWMvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvdHlwZW9mIik7CgohZnVuY3Rpb24gKHQsIGUpIHsKICBpZiAoIm9iamVjdCIgPT0gKHR5cGVvZiBleHBvcnRzID09PSAidW5kZWZpbmVkIiA/ICJ1bmRlZmluZWQiIDogX3R5cGVvZihleHBvcnRzKSkgJiYgIm9iamVjdCIgPT0gKHR5cGVvZiBtb2R1bGUgPT09ICJ1bmRlZmluZWQiID8gInVuZGVmaW5lZCIgOiBfdHlwZW9mKG1vZHVsZSkpKSBtb2R1bGUuZXhwb3J0cyA9IGUoKTtlbHNlIGlmICgiZnVuY3Rpb24iID09IHR5cGVvZiBkZWZpbmUgJiYgZGVmaW5lLmFtZCkgZGVmaW5lKFtdLCBlKTtlbHNlIHsKICAgIHZhciByID0gZSgpOwoKICAgIGZvciAodmFyIG4gaW4gcikgewogICAgICAoIm9iamVjdCIgPT0gKHR5cGVvZiBleHBvcnRzID09PSAidW5kZWZpbmVkIiA/ICJ1bmRlZmluZWQiIDogX3R5cGVvZihleHBvcnRzKSkgPyBleHBvcnRzIDogdClbbl0gPSByW25dOwogICAgfQogIH0KfSh3aW5kb3csIGZ1bmN0aW9uICgpIHsKICByZXR1cm4gZnVuY3Rpb24gKHQpIHsKICAgIHZhciBlID0ge307CgogICAgZnVuY3Rpb24gcihuKSB7CiAgICAgIGlmIChlW25dKSByZXR1cm4gZVtuXS5leHBvcnRzOwogICAgICB2YXIgbyA9IGVbbl0gPSB7CiAgICAgICAgaTogbiwKICAgICAgICBsOiAhMSwKICAgICAgICBleHBvcnRzOiB7fQogICAgICB9OwogICAgICByZXR1cm4gdFtuXS5jYWxsKG8uZXhwb3J0cywgbywgby5leHBvcnRzLCByKSwgby5sID0gITAsIG8uZXhwb3J0czsKICAgIH0KCiAgICByZXR1cm4gci5tID0gdCwgci5jID0gZSwgci5kID0gZnVuY3Rpb24gKHQsIGUsIG4pIHsKICAgICAgci5vKHQsIGUpIHx8IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LCBlLCB7CiAgICAgICAgZW51bWVyYWJsZTogITAsCiAgICAgICAgZ2V0OiBuCiAgICAgIH0pOwogICAgfSwgci5yID0gZnVuY3Rpb24gKHQpIHsKICAgICAgInVuZGVmaW5lZCIgIT0gdHlwZW9mIFN5bWJvbCAmJiBTeW1ib2wudG9TdHJpbmdUYWcgJiYgT2JqZWN0LmRlZmluZVByb3BlcnR5KHQsIFN5bWJvbC50b1N0cmluZ1RhZywgewogICAgICAgIHZhbHVlOiAiTW9kdWxlIgogICAgICB9KSwgT2JqZWN0LmRlZmluZVByb3BlcnR5KHQsICJfX2VzTW9kdWxlIiwgewogICAgICAgIHZhbHVlOiAhMAogICAgICB9KTsKICAgIH0sIHIudCA9IGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgIGlmICgxICYgZSAmJiAodCA9IHIodCkpLCA4ICYgZSkgcmV0dXJuIHQ7CiAgICAgIGlmICg0ICYgZSAmJiAib2JqZWN0IiA9PSBfdHlwZW9mKHQpICYmIHQgJiYgdC5fX2VzTW9kdWxlKSByZXR1cm4gdDsKICAgICAgdmFyIG4gPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICBpZiAoci5yKG4pLCBPYmplY3QuZGVmaW5lUHJvcGVydHkobiwgImRlZmF1bHQiLCB7CiAgICAgICAgZW51bWVyYWJsZTogITAsCiAgICAgICAgdmFsdWU6IHQKICAgICAgfSksIDIgJiBlICYmICJzdHJpbmciICE9IHR5cGVvZiB0KSBmb3IgKHZhciBvIGluIHQpIHsKICAgICAgICByLmQobiwgbywgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIHJldHVybiB0W2VdOwogICAgICAgIH0uYmluZChudWxsLCBvKSk7CiAgICAgIH0KICAgICAgcmV0dXJuIG47CiAgICB9LCByLm4gPSBmdW5jdGlvbiAodCkgewogICAgICB2YXIgZSA9IHQgJiYgdC5fX2VzTW9kdWxlID8gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiB0LmRlZmF1bHQ7CiAgICAgIH0gOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHQ7CiAgICAgIH07CiAgICAgIHJldHVybiByLmQoZSwgImEiLCBlKSwgZTsKICAgIH0sIHIubyA9IGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgIHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwodCwgZSk7CiAgICB9LCByLnAgPSAiIiwgcihyLnMgPSAxOCk7CiAgfShbZnVuY3Rpb24gKHQsIGUpIHsKICAgIHQuZXhwb3J0cyA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHt9OwogICAgfTsKICB9LCBmdW5jdGlvbiAodCwgZSwgcikgewogICAgZnVuY3Rpb24gbih0KSB7CiAgICAgIGlmICh0KSByZXR1cm4gZnVuY3Rpb24gKHQpIHsKICAgICAgICBmb3IgKHZhciBlIGluIG4ucHJvdG90eXBlKSB7CiAgICAgICAgICB0W2VdID0gbi5wcm90b3R5cGVbZV07CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdDsKICAgICAgfSh0KTsKICAgIH0KCiAgICB0LmV4cG9ydHMgPSBuLCBuLnByb3RvdHlwZS5vbiA9IG4ucHJvdG90eXBlLmFkZEV2ZW50TGlzdGVuZXIgPSBmdW5jdGlvbiAodCwgZSkgewogICAgICByZXR1cm4gdGhpcy5fY2FsbGJhY2tzID0gdGhpcy5fY2FsbGJhY2tzIHx8IHt9LCAodGhpcy5fY2FsbGJhY2tzWyIkIiArIHRdID0gdGhpcy5fY2FsbGJhY2tzWyIkIiArIHRdIHx8IFtdKS5wdXNoKGUpLCB0aGlzOwogICAgfSwgbi5wcm90b3R5cGUub25jZSA9IGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgIGZ1bmN0aW9uIHIoKSB7CiAgICAgICAgdGhpcy5vZmYodCwgciksIGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHIuZm4gPSBlLCB0aGlzLm9uKHQsIHIpLCB0aGlzOwogICAgfSwgbi5wcm90b3R5cGUub2ZmID0gbi5wcm90b3R5cGUucmVtb3ZlTGlzdGVuZXIgPSBuLnByb3RvdHlwZS5yZW1vdmVBbGxMaXN0ZW5lcnMgPSBuLnByb3RvdHlwZS5yZW1vdmVFdmVudExpc3RlbmVyID0gZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgaWYgKHRoaXMuX2NhbGxiYWNrcyA9IHRoaXMuX2NhbGxiYWNrcyB8fCB7fSwgMCA9PSBhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gdGhpcy5fY2FsbGJhY2tzID0ge30sIHRoaXM7CiAgICAgIHZhciByLAogICAgICAgICAgbiA9IHRoaXMuX2NhbGxiYWNrc1siJCIgKyB0XTsKICAgICAgaWYgKCFuKSByZXR1cm4gdGhpczsKICAgICAgaWYgKDEgPT0gYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIGRlbGV0ZSB0aGlzLl9jYWxsYmFja3NbIiQiICsgdF0sIHRoaXM7CgogICAgICBmb3IgKHZhciBvID0gMDsgbyA8IG4ubGVuZ3RoOyBvKyspIHsKICAgICAgICBpZiAoKHIgPSBuW29dKSA9PT0gZSB8fCByLmZuID09PSBlKSB7CiAgICAgICAgICBuLnNwbGljZShvLCAxKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LCBuLnByb3RvdHlwZS5lbWl0ID0gZnVuY3Rpb24gKHQpIHsKICAgICAgdGhpcy5fY2FsbGJhY2tzID0gdGhpcy5fY2FsbGJhY2tzIHx8IHt9OwogICAgICB2YXIgZSA9IFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSwKICAgICAgICAgIHIgPSB0aGlzLl9jYWxsYmFja3NbIiQiICsgdF07CiAgICAgIGlmIChyKSBmb3IgKHZhciBuID0gMCwgbyA9IChyID0gci5zbGljZSgwKSkubGVuZ3RoOyBuIDwgbzsgKytuKSB7CiAgICAgICAgcltuXS5hcHBseSh0aGlzLCBlKTsKICAgICAgfQogICAgICByZXR1cm4gdGhpczsKICAgIH0sIG4ucHJvdG90eXBlLmxpc3RlbmVycyA9IGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiB0aGlzLl9jYWxsYmFja3MgPSB0aGlzLl9jYWxsYmFja3MgfHwge30sIHRoaXMuX2NhbGxiYWNrc1siJCIgKyB0XSB8fCBbXTsKICAgIH0sIG4ucHJvdG90eXBlLmhhc0xpc3RlbmVycyA9IGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiAhIXRoaXMubGlzdGVuZXJzKHQpLmxlbmd0aDsKICAgIH07CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgIHZhciBuLAogICAgICAgIG8gPSByKDI4KSwKICAgICAgICBpID0gcigxMyksCiAgICAgICAgcyA9IHIoMzApLAogICAgICAgIGEgPSByKDMxKSwKICAgICAgICBjID0gcigzMik7CiAgICAidW5kZWZpbmVkIiAhPSB0eXBlb2YgQXJyYXlCdWZmZXIgJiYgKG4gPSByKDMzKSk7CiAgICB2YXIgaCA9ICJ1bmRlZmluZWQiICE9IHR5cGVvZiBuYXZpZ2F0b3IgJiYgL0FuZHJvaWQvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpLAogICAgICAgIHUgPSAidW5kZWZpbmVkIiAhPSB0eXBlb2YgbmF2aWdhdG9yICYmIC9QaGFudG9tSlMvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpLAogICAgICAgIGYgPSBoIHx8IHU7CiAgICBlLnByb3RvY29sID0gMzsKICAgIHZhciBwID0gZS5wYWNrZXRzID0gewogICAgICBvcGVuOiAwLAogICAgICBjbG9zZTogMSwKICAgICAgcGluZzogMiwKICAgICAgcG9uZzogMywKICAgICAgbWVzc2FnZTogNCwKICAgICAgdXBncmFkZTogNSwKICAgICAgbm9vcDogNgogICAgfSwKICAgICAgICBsID0gbyhwKSwKICAgICAgICBkID0gewogICAgICB0eXBlOiAiZXJyb3IiLAogICAgICBkYXRhOiAicGFyc2VyIGVycm9yIgogICAgfSwKICAgICAgICB5ID0gcigzNCk7CgogICAgZnVuY3Rpb24gZyh0LCBlLCByKSB7CiAgICAgIGZvciAodmFyIG4gPSBuZXcgQXJyYXkodC5sZW5ndGgpLCBvID0gYSh0Lmxlbmd0aCwgciksIGkgPSBmdW5jdGlvbiBpKHQsIHIsIG8pIHsKICAgICAgICBlKHIsIGZ1bmN0aW9uIChlLCByKSB7CiAgICAgICAgICBuW3RdID0gciwgbyhlLCBuKTsKICAgICAgICB9KTsKICAgICAgfSwgcyA9IDA7IHMgPCB0Lmxlbmd0aDsgcysrKSB7CiAgICAgICAgaShzLCB0W3NdLCBvKTsKICAgICAgfQogICAgfQoKICAgIGUuZW5jb2RlUGFja2V0ID0gZnVuY3Rpb24gKHQsIHIsIG4sIG8pIHsKICAgICAgImZ1bmN0aW9uIiA9PSB0eXBlb2YgciAmJiAobyA9IHIsIHIgPSAhMSksICJmdW5jdGlvbiIgPT0gdHlwZW9mIG4gJiYgKG8gPSBuLCBuID0gbnVsbCk7CiAgICAgIHZhciBpID0gdm9pZCAwID09PSB0LmRhdGEgPyB2b2lkIDAgOiB0LmRhdGEuYnVmZmVyIHx8IHQuZGF0YTsKICAgICAgaWYgKCJ1bmRlZmluZWQiICE9IHR5cGVvZiBBcnJheUJ1ZmZlciAmJiBpIGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpIHJldHVybiBmdW5jdGlvbiAodCwgciwgbikgewogICAgICAgIGlmICghcikgcmV0dXJuIGUuZW5jb2RlQmFzZTY0UGFja2V0KHQsIG4pOwogICAgICAgIHZhciBvID0gdC5kYXRhLAogICAgICAgICAgICBpID0gbmV3IFVpbnQ4QXJyYXkobyksCiAgICAgICAgICAgIHMgPSBuZXcgVWludDhBcnJheSgxICsgby5ieXRlTGVuZ3RoKTsKICAgICAgICBzWzBdID0gcFt0LnR5cGVdOwoKICAgICAgICBmb3IgKHZhciBhID0gMDsgYSA8IGkubGVuZ3RoOyBhKyspIHsKICAgICAgICAgIHNbYSArIDFdID0gaVthXTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBuKHMuYnVmZmVyKTsKICAgICAgfSh0LCByLCBvKTsKICAgICAgaWYgKHZvaWQgMCAhPT0geSAmJiBpIGluc3RhbmNlb2YgeSkgcmV0dXJuIGZ1bmN0aW9uICh0LCByLCBuKSB7CiAgICAgICAgaWYgKCFyKSByZXR1cm4gZS5lbmNvZGVCYXNlNjRQYWNrZXQodCwgbik7CiAgICAgICAgaWYgKGYpIHJldHVybiBmdW5jdGlvbiAodCwgciwgbikgewogICAgICAgICAgaWYgKCFyKSByZXR1cm4gZS5lbmNvZGVCYXNlNjRQYWNrZXQodCwgbik7CiAgICAgICAgICB2YXIgbyA9IG5ldyBGaWxlUmVhZGVyKCk7CiAgICAgICAgICByZXR1cm4gby5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGUuZW5jb2RlUGFja2V0KHsKICAgICAgICAgICAgICB0eXBlOiB0LnR5cGUsCiAgICAgICAgICAgICAgZGF0YTogby5yZXN1bHQKICAgICAgICAgICAgfSwgciwgITAsIG4pOwogICAgICAgICAgfSwgby5yZWFkQXNBcnJheUJ1ZmZlcih0LmRhdGEpOwogICAgICAgIH0odCwgciwgbik7CiAgICAgICAgdmFyIG8gPSBuZXcgVWludDhBcnJheSgxKTsKICAgICAgICBvWzBdID0gcFt0LnR5cGVdOwogICAgICAgIHZhciBpID0gbmV3IHkoW28uYnVmZmVyLCB0LmRhdGFdKTsKICAgICAgICByZXR1cm4gbihpKTsKICAgICAgfSh0LCByLCBvKTsKICAgICAgaWYgKGkgJiYgaS5iYXNlNjQpIHJldHVybiBmdW5jdGlvbiAodCwgcikgewogICAgICAgIHZhciBuID0gImIiICsgZS5wYWNrZXRzW3QudHlwZV0gKyB0LmRhdGEuZGF0YTsKICAgICAgICByZXR1cm4gcihuKTsKICAgICAgfSh0LCBvKTsKICAgICAgdmFyIHMgPSBwW3QudHlwZV07CiAgICAgIHJldHVybiB2b2lkIDAgIT09IHQuZGF0YSAmJiAocyArPSBuID8gYy5lbmNvZGUoU3RyaW5nKHQuZGF0YSksIHsKICAgICAgICBzdHJpY3Q6ICExCiAgICAgIH0pIDogU3RyaW5nKHQuZGF0YSkpLCBvKCIiICsgcyk7CiAgICB9LCBlLmVuY29kZUJhc2U2NFBhY2tldCA9IGZ1bmN0aW9uICh0LCByKSB7CiAgICAgIHZhciBuLAogICAgICAgICAgbyA9ICJiIiArIGUucGFja2V0c1t0LnR5cGVdOwoKICAgICAgaWYgKHZvaWQgMCAhPT0geSAmJiB0LmRhdGEgaW5zdGFuY2VvZiB5KSB7CiAgICAgICAgdmFyIGkgPSBuZXcgRmlsZVJlYWRlcigpOwogICAgICAgIHJldHVybiBpLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciB0ID0gaS5yZXN1bHQuc3BsaXQoIiwiKVsxXTsKICAgICAgICAgIHIobyArIHQpOwogICAgICAgIH0sIGkucmVhZEFzRGF0YVVSTCh0LmRhdGEpOwogICAgICB9CgogICAgICB0cnkgewogICAgICAgIG4gPSBTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsIG5ldyBVaW50OEFycmF5KHQuZGF0YSkpOwogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgZm9yICh2YXIgcyA9IG5ldyBVaW50OEFycmF5KHQuZGF0YSksIGEgPSBuZXcgQXJyYXkocy5sZW5ndGgpLCBjID0gMDsgYyA8IHMubGVuZ3RoOyBjKyspIHsKICAgICAgICAgIGFbY10gPSBzW2NdOwogICAgICAgIH0KCiAgICAgICAgbiA9IFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkobnVsbCwgYSk7CiAgICAgIH0KCiAgICAgIHJldHVybiBvICs9IGJ0b2EobiksIHIobyk7CiAgICB9LCBlLmRlY29kZVBhY2tldCA9IGZ1bmN0aW9uICh0LCByLCBuKSB7CiAgICAgIGlmICh2b2lkIDAgPT09IHQpIHJldHVybiBkOwoKICAgICAgaWYgKCJzdHJpbmciID09IHR5cGVvZiB0KSB7CiAgICAgICAgaWYgKCJiIiA9PT0gdC5jaGFyQXQoMCkpIHJldHVybiBlLmRlY29kZUJhc2U2NFBhY2tldCh0LnN1YnN0cigxKSwgcik7CiAgICAgICAgaWYgKG4gJiYgITEgPT09ICh0ID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIHQgPSBjLmRlY29kZSh0LCB7CiAgICAgICAgICAgICAgc3RyaWN0OiAhMQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gY2F0Y2ggKHQpIHsKICAgICAgICAgICAgcmV0dXJuICExOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiB0OwogICAgICAgIH0odCkpKSByZXR1cm4gZDsKICAgICAgICB2YXIgbyA9IHQuY2hhckF0KDApOwogICAgICAgIHJldHVybiBOdW1iZXIobykgPT0gbyAmJiBsW29dID8gdC5sZW5ndGggPiAxID8gewogICAgICAgICAgdHlwZTogbFtvXSwKICAgICAgICAgIGRhdGE6IHQuc3Vic3RyaW5nKDEpCiAgICAgICAgfSA6IHsKICAgICAgICAgIHR5cGU6IGxbb10KICAgICAgICB9IDogZDsKICAgICAgfQoKICAgICAgbyA9IG5ldyBVaW50OEFycmF5KHQpWzBdOwogICAgICB2YXIgaSA9IHModCwgMSk7CiAgICAgIHJldHVybiB5ICYmICJibG9iIiA9PT0gciAmJiAoaSA9IG5ldyB5KFtpXSkpLCB7CiAgICAgICAgdHlwZTogbFtvXSwKICAgICAgICBkYXRhOiBpCiAgICAgIH07CiAgICB9LCBlLmRlY29kZUJhc2U2NFBhY2tldCA9IGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgIHZhciByID0gbFt0LmNoYXJBdCgwKV07CiAgICAgIGlmICghbikgcmV0dXJuIHsKICAgICAgICB0eXBlOiByLAogICAgICAgIGRhdGE6IHsKICAgICAgICAgIGJhc2U2NDogITAsCiAgICAgICAgICBkYXRhOiB0LnN1YnN0cigxKQogICAgICAgIH0KICAgICAgfTsKICAgICAgdmFyIG8gPSBuLmRlY29kZSh0LnN1YnN0cigxKSk7CiAgICAgIHJldHVybiAiYmxvYiIgPT09IGUgJiYgeSAmJiAobyA9IG5ldyB5KFtvXSkpLCB7CiAgICAgICAgdHlwZTogciwKICAgICAgICBkYXRhOiBvCiAgICAgIH07CiAgICB9LCBlLmVuY29kZVBheWxvYWQgPSBmdW5jdGlvbiAodCwgciwgbikgewogICAgICAiZnVuY3Rpb24iID09IHR5cGVvZiByICYmIChuID0gciwgciA9IG51bGwpOwogICAgICB2YXIgbyA9IGkodCk7CiAgICAgIGlmIChyICYmIG8pIHJldHVybiB5ICYmICFmID8gZS5lbmNvZGVQYXlsb2FkQXNCbG9iKHQsIG4pIDogZS5lbmNvZGVQYXlsb2FkQXNBcnJheUJ1ZmZlcih0LCBuKTsKICAgICAgaWYgKCF0Lmxlbmd0aCkgcmV0dXJuIG4oIjA6Iik7CiAgICAgIGcodCwgZnVuY3Rpb24gKHQsIG4pIHsKICAgICAgICBlLmVuY29kZVBhY2tldCh0LCAhIW8gJiYgciwgITEsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICBuKG51bGwsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIHJldHVybiB0Lmxlbmd0aCArICI6IiArIHQ7CiAgICAgICAgICB9KHQpKTsKICAgICAgICB9KTsKICAgICAgfSwgZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgICByZXR1cm4gbihlLmpvaW4oIiIpKTsKICAgICAgfSk7CiAgICB9LCBlLmRlY29kZVBheWxvYWQgPSBmdW5jdGlvbiAodCwgciwgbikgewogICAgICBpZiAoInN0cmluZyIgIT0gdHlwZW9mIHQpIHJldHVybiBlLmRlY29kZVBheWxvYWRBc0JpbmFyeSh0LCByLCBuKTsKICAgICAgdmFyIG87CiAgICAgIGlmICgiZnVuY3Rpb24iID09IHR5cGVvZiByICYmIChuID0gciwgciA9IG51bGwpLCAiIiA9PT0gdCkgcmV0dXJuIG4oZCwgMCwgMSk7CgogICAgICBmb3IgKHZhciBpLCBzLCBhID0gIiIsIGMgPSAwLCBoID0gdC5sZW5ndGg7IGMgPCBoOyBjKyspIHsKICAgICAgICB2YXIgdSA9IHQuY2hhckF0KGMpOwoKICAgICAgICBpZiAoIjoiID09PSB1KSB7CiAgICAgICAgICBpZiAoIiIgPT09IGEgfHwgYSAhPSAoaSA9IE51bWJlcihhKSkpIHJldHVybiBuKGQsIDAsIDEpOwogICAgICAgICAgaWYgKGEgIT0gKHMgPSB0LnN1YnN0cihjICsgMSwgaSkpLmxlbmd0aCkgcmV0dXJuIG4oZCwgMCwgMSk7CgogICAgICAgICAgaWYgKHMubGVuZ3RoKSB7CiAgICAgICAgICAgIGlmIChvID0gZS5kZWNvZGVQYWNrZXQocywgciwgITEpLCBkLnR5cGUgPT09IG8udHlwZSAmJiBkLmRhdGEgPT09IG8uZGF0YSkgcmV0dXJuIG4oZCwgMCwgMSk7CiAgICAgICAgICAgIGlmICghMSA9PT0gbihvLCBjICsgaSwgaCkpIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBjICs9IGksIGEgPSAiIjsKICAgICAgICB9IGVsc2UgYSArPSB1OwogICAgICB9CgogICAgICByZXR1cm4gIiIgIT09IGEgPyBuKGQsIDAsIDEpIDogdm9pZCAwOwogICAgfSwgZS5lbmNvZGVQYXlsb2FkQXNBcnJheUJ1ZmZlciA9IGZ1bmN0aW9uICh0LCByKSB7CiAgICAgIGlmICghdC5sZW5ndGgpIHJldHVybiByKG5ldyBBcnJheUJ1ZmZlcigwKSk7CiAgICAgIGcodCwgZnVuY3Rpb24gKHQsIHIpIHsKICAgICAgICBlLmVuY29kZVBhY2tldCh0LCAhMCwgITAsIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICByZXR1cm4gcihudWxsLCB0KTsKICAgICAgICB9KTsKICAgICAgfSwgZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgICB2YXIgbiA9IGUucmVkdWNlKGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgICB2YXIgcjsKICAgICAgICAgIHJldHVybiB0ICsgKHIgPSAic3RyaW5nIiA9PSB0eXBlb2YgZSA/IGUubGVuZ3RoIDogZS5ieXRlTGVuZ3RoKS50b1N0cmluZygpLmxlbmd0aCArIHIgKyAyOwogICAgICAgIH0sIDApLAogICAgICAgICAgICBvID0gbmV3IFVpbnQ4QXJyYXkobiksCiAgICAgICAgICAgIGkgPSAwOwogICAgICAgIHJldHVybiBlLmZvckVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHZhciBlID0gInN0cmluZyIgPT0gdHlwZW9mIHQsCiAgICAgICAgICAgICAgciA9IHQ7CgogICAgICAgICAgaWYgKGUpIHsKICAgICAgICAgICAgZm9yICh2YXIgbiA9IG5ldyBVaW50OEFycmF5KHQubGVuZ3RoKSwgcyA9IDA7IHMgPCB0Lmxlbmd0aDsgcysrKSB7CiAgICAgICAgICAgICAgbltzXSA9IHQuY2hhckNvZGVBdChzKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgciA9IG4uYnVmZmVyOwogICAgICAgICAgfQoKICAgICAgICAgIG9baSsrXSA9IGUgPyAwIDogMTsKICAgICAgICAgIHZhciBhID0gci5ieXRlTGVuZ3RoLnRvU3RyaW5nKCk7CgogICAgICAgICAgZm9yIChzID0gMDsgcyA8IGEubGVuZ3RoOyBzKyspIHsKICAgICAgICAgICAgb1tpKytdID0gcGFyc2VJbnQoYVtzXSk7CiAgICAgICAgICB9CgogICAgICAgICAgb1tpKytdID0gMjU1OwoKICAgICAgICAgIGZvciAobiA9IG5ldyBVaW50OEFycmF5KHIpLCBzID0gMDsgcyA8IG4ubGVuZ3RoOyBzKyspIHsKICAgICAgICAgICAgb1tpKytdID0gbltzXTsKICAgICAgICAgIH0KICAgICAgICB9KSwgcihvLmJ1ZmZlcik7CiAgICAgIH0pOwogICAgfSwgZS5lbmNvZGVQYXlsb2FkQXNCbG9iID0gZnVuY3Rpb24gKHQsIHIpIHsKICAgICAgZyh0LCBmdW5jdGlvbiAodCwgcikgewogICAgICAgIGUuZW5jb2RlUGFja2V0KHQsICEwLCAhMCwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHZhciBlID0gbmV3IFVpbnQ4QXJyYXkoMSk7CgogICAgICAgICAgaWYgKGVbMF0gPSAxLCAic3RyaW5nIiA9PSB0eXBlb2YgdCkgewogICAgICAgICAgICBmb3IgKHZhciBuID0gbmV3IFVpbnQ4QXJyYXkodC5sZW5ndGgpLCBvID0gMDsgbyA8IHQubGVuZ3RoOyBvKyspIHsKICAgICAgICAgICAgICBuW29dID0gdC5jaGFyQ29kZUF0KG8pOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0ID0gbi5idWZmZXIsIGVbMF0gPSAwOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBpID0gKHQgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlciA/IHQuYnl0ZUxlbmd0aCA6IHQuc2l6ZSkudG9TdHJpbmcoKSwKICAgICAgICAgICAgICBzID0gbmV3IFVpbnQ4QXJyYXkoaS5sZW5ndGggKyAxKTsKCiAgICAgICAgICBmb3IgKG8gPSAwOyBvIDwgaS5sZW5ndGg7IG8rKykgewogICAgICAgICAgICBzW29dID0gcGFyc2VJbnQoaVtvXSk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHNbaS5sZW5ndGhdID0gMjU1LCB5KSB7CiAgICAgICAgICAgIHZhciBhID0gbmV3IHkoW2UuYnVmZmVyLCBzLmJ1ZmZlciwgdF0pOwogICAgICAgICAgICByKG51bGwsIGEpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9LCBmdW5jdGlvbiAodCwgZSkgewogICAgICAgIHJldHVybiByKG5ldyB5KGUpKTsKICAgICAgfSk7CiAgICB9LCBlLmRlY29kZVBheWxvYWRBc0JpbmFyeSA9IGZ1bmN0aW9uICh0LCByLCBuKSB7CiAgICAgICJmdW5jdGlvbiIgPT0gdHlwZW9mIHIgJiYgKG4gPSByLCByID0gbnVsbCk7CgogICAgICBmb3IgKHZhciBvID0gdCwgaSA9IFtdOyBvLmJ5dGVMZW5ndGggPiAwOykgewogICAgICAgIGZvciAodmFyIGEgPSBuZXcgVWludDhBcnJheShvKSwgYyA9IDAgPT09IGFbMF0sIGggPSAiIiwgdSA9IDE7IDI1NSAhPT0gYVt1XTsgdSsrKSB7CiAgICAgICAgICBpZiAoaC5sZW5ndGggPiAzMTApIHJldHVybiBuKGQsIDAsIDEpOwogICAgICAgICAgaCArPSBhW3VdOwogICAgICAgIH0KCiAgICAgICAgbyA9IHMobywgMiArIGgubGVuZ3RoKSwgaCA9IHBhcnNlSW50KGgpOwogICAgICAgIHZhciBmID0gcyhvLCAwLCBoKTsKICAgICAgICBpZiAoYykgdHJ5IHsKICAgICAgICAgIGYgPSBTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsIG5ldyBVaW50OEFycmF5KGYpKTsKICAgICAgICB9IGNhdGNoICh0KSB7CiAgICAgICAgICB2YXIgcCA9IG5ldyBVaW50OEFycmF5KGYpOwogICAgICAgICAgZiA9ICIiOwoKICAgICAgICAgIGZvciAodSA9IDA7IHUgPCBwLmxlbmd0aDsgdSsrKSB7CiAgICAgICAgICAgIGYgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShwW3VdKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaS5wdXNoKGYpLCBvID0gcyhvLCBoKTsKICAgICAgfQoKICAgICAgdmFyIGwgPSBpLmxlbmd0aDsKICAgICAgaS5mb3JFYWNoKGZ1bmN0aW9uICh0LCBvKSB7CiAgICAgICAgbihlLmRlY29kZVBhY2tldCh0LCByLCAhMCksIG8sIGwpOwogICAgICB9KTsKICAgIH07CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgIHZhciBuID0gcigwKSgic29ja2V0LmlvLXBhcnNlciIpLAogICAgICAgIG8gPSByKDEpLAogICAgICAgIGkgPSByKDIxKSwKICAgICAgICBzID0gcig3KSwKICAgICAgICBhID0gcig4KTsKCiAgICBmdW5jdGlvbiBjKCkge30KCiAgICBlLnByb3RvY29sID0gNCwgZS50eXBlcyA9IFsiQ09OTkVDVCIsICJESVNDT05ORUNUIiwgIkVWRU5UIiwgIkFDSyIsICJFUlJPUiIsICJCSU5BUllfRVZFTlQiLCAiQklOQVJZX0FDSyJdLCBlLkNPTk5FQ1QgPSAwLCBlLkRJU0NPTk5FQ1QgPSAxLCBlLkVWRU5UID0gMiwgZS5BQ0sgPSAzLCBlLkVSUk9SID0gNCwgZS5CSU5BUllfRVZFTlQgPSA1LCBlLkJJTkFSWV9BQ0sgPSA2LCBlLkVuY29kZXIgPSBjLCBlLkRlY29kZXIgPSBmOwogICAgdmFyIGggPSBlLkVSUk9SICsgJyJlbmNvZGUgZXJyb3IiJzsKCiAgICBmdW5jdGlvbiB1KHQpIHsKICAgICAgdmFyIHIgPSAiIiArIHQudHlwZTsKCiAgICAgIGlmIChlLkJJTkFSWV9FVkVOVCAhPT0gdC50eXBlICYmIGUuQklOQVJZX0FDSyAhPT0gdC50eXBlIHx8IChyICs9IHQuYXR0YWNobWVudHMgKyAiLSIpLCB0Lm5zcCAmJiAiLyIgIT09IHQubnNwICYmIChyICs9IHQubnNwICsgIiwiKSwgbnVsbCAhPSB0LmlkICYmIChyICs9IHQuaWQpLCBudWxsICE9IHQuZGF0YSkgewogICAgICAgIHZhciBvID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeSh0KTsKICAgICAgICAgIH0gY2F0Y2ggKHQpIHsKICAgICAgICAgICAgcmV0dXJuICExOwogICAgICAgICAgfQogICAgICAgIH0odC5kYXRhKTsKCiAgICAgICAgaWYgKCExID09PSBvKSByZXR1cm4gaDsKICAgICAgICByICs9IG87CiAgICAgIH0KCiAgICAgIHJldHVybiBuKCJlbmNvZGVkICVqIGFzICVzIiwgdCwgciksIHI7CiAgICB9CgogICAgZnVuY3Rpb24gZigpIHsKICAgICAgdGhpcy5yZWNvbnN0cnVjdG9yID0gbnVsbDsKICAgIH0KCiAgICBmdW5jdGlvbiBwKHQpIHsKICAgICAgdGhpcy5yZWNvblBhY2sgPSB0LCB0aGlzLmJ1ZmZlcnMgPSBbXTsKICAgIH0KCiAgICBmdW5jdGlvbiBsKHQpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICB0eXBlOiBlLkVSUk9SLAogICAgICAgIGRhdGE6ICJwYXJzZXIgZXJyb3I6ICIgKyB0CiAgICAgIH07CiAgICB9CgogICAgYy5wcm90b3R5cGUuZW5jb2RlID0gZnVuY3Rpb24gKHQsIHIpIHsKICAgICAgKG4oImVuY29kaW5nIHBhY2tldCAlaiIsIHQpLCBlLkJJTkFSWV9FVkVOVCA9PT0gdC50eXBlIHx8IGUuQklOQVJZX0FDSyA9PT0gdC50eXBlKSA/IGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgaS5yZW1vdmVCbG9icyh0LCBmdW5jdGlvbiAodCkgewogICAgICAgICAgdmFyIHIgPSBpLmRlY29uc3RydWN0UGFja2V0KHQpLAogICAgICAgICAgICAgIG4gPSB1KHIucGFja2V0KSwKICAgICAgICAgICAgICBvID0gci5idWZmZXJzOwogICAgICAgICAgby51bnNoaWZ0KG4pLCBlKG8pOwogICAgICAgIH0pOwogICAgICB9KHQsIHIpIDogcihbdSh0KV0pOwogICAgfSwgbyhmLnByb3RvdHlwZSksIGYucHJvdG90eXBlLmFkZCA9IGZ1bmN0aW9uICh0KSB7CiAgICAgIHZhciByOwogICAgICBpZiAoInN0cmluZyIgPT0gdHlwZW9mIHQpIHIgPSBmdW5jdGlvbiAodCkgewogICAgICAgIHZhciByID0gMCwKICAgICAgICAgICAgbyA9IHsKICAgICAgICAgIHR5cGU6IE51bWJlcih0LmNoYXJBdCgwKSkKICAgICAgICB9OwogICAgICAgIGlmIChudWxsID09IGUudHlwZXNbby50eXBlXSkgcmV0dXJuIGwoInVua25vd24gcGFja2V0IHR5cGUgIiArIG8udHlwZSk7CgogICAgICAgIGlmIChlLkJJTkFSWV9FVkVOVCA9PT0gby50eXBlIHx8IGUuQklOQVJZX0FDSyA9PT0gby50eXBlKSB7CiAgICAgICAgICBmb3IgKHZhciBpID0gIiI7ICItIiAhPT0gdC5jaGFyQXQoKytyKSAmJiAoaSArPSB0LmNoYXJBdChyKSwgciAhPSB0Lmxlbmd0aCk7KSB7CiAgICAgICAgICAgIDsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoaSAhPSBOdW1iZXIoaSkgfHwgIi0iICE9PSB0LmNoYXJBdChyKSkgdGhyb3cgbmV3IEVycm9yKCJJbGxlZ2FsIGF0dGFjaG1lbnRzIik7CiAgICAgICAgICBvLmF0dGFjaG1lbnRzID0gTnVtYmVyKGkpOwogICAgICAgIH0KCiAgICAgICAgaWYgKCIvIiA9PT0gdC5jaGFyQXQociArIDEpKSBmb3IgKG8ubnNwID0gIiI7ICsrcjspIHsKICAgICAgICAgIGlmICgiLCIgPT09IChjID0gdC5jaGFyQXQocikpKSBicmVhazsKICAgICAgICAgIGlmIChvLm5zcCArPSBjLCByID09PSB0Lmxlbmd0aCkgYnJlYWs7CiAgICAgICAgfSBlbHNlIG8ubnNwID0gIi8iOwogICAgICAgIHZhciBhID0gdC5jaGFyQXQociArIDEpOwoKICAgICAgICBpZiAoIiIgIT09IGEgJiYgTnVtYmVyKGEpID09IGEpIHsKICAgICAgICAgIGZvciAoby5pZCA9ICIiOyArK3I7KSB7CiAgICAgICAgICAgIHZhciBjOwoKICAgICAgICAgICAgaWYgKG51bGwgPT0gKGMgPSB0LmNoYXJBdChyKSkgfHwgTnVtYmVyKGMpICE9IGMpIHsKICAgICAgICAgICAgICAtLXI7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChvLmlkICs9IHQuY2hhckF0KHIpLCByID09PSB0Lmxlbmd0aCkgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgby5pZCA9IE51bWJlcihvLmlkKTsKICAgICAgICB9CgogICAgICAgIGlmICh0LmNoYXJBdCgrK3IpKSB7CiAgICAgICAgICB2YXIgaCA9IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UodCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKHQpIHsKICAgICAgICAgICAgICByZXR1cm4gITE7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0odC5zdWJzdHIocikpOwoKICAgICAgICAgIGlmICghKCExICE9PSBoICYmIChvLnR5cGUgPT09IGUuRVJST1IgfHwgcyhoKSkpKSByZXR1cm4gbCgiaW52YWxpZCBwYXlsb2FkIik7CiAgICAgICAgICBvLmRhdGEgPSBoOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG4oImRlY29kZWQgJXMgYXMgJWoiLCB0LCBvKSwgbzsKICAgICAgfSh0KSwgZS5CSU5BUllfRVZFTlQgPT09IHIudHlwZSB8fCBlLkJJTkFSWV9BQ0sgPT09IHIudHlwZSA/ICh0aGlzLnJlY29uc3RydWN0b3IgPSBuZXcgcChyKSwgMCA9PT0gdGhpcy5yZWNvbnN0cnVjdG9yLnJlY29uUGFjay5hdHRhY2htZW50cyAmJiB0aGlzLmVtaXQoImRlY29kZWQiLCByKSkgOiB0aGlzLmVtaXQoImRlY29kZWQiLCByKTtlbHNlIHsKICAgICAgICBpZiAoIWEodCkgJiYgIXQuYmFzZTY0KSB0aHJvdyBuZXcgRXJyb3IoIlVua25vd24gdHlwZTogIiArIHQpOwogICAgICAgIGlmICghdGhpcy5yZWNvbnN0cnVjdG9yKSB0aHJvdyBuZXcgRXJyb3IoImdvdCBiaW5hcnkgZGF0YSB3aGVuIG5vdCByZWNvbnN0cnVjdGluZyBhIHBhY2tldCIpOwogICAgICAgIChyID0gdGhpcy5yZWNvbnN0cnVjdG9yLnRha2VCaW5hcnlEYXRhKHQpKSAmJiAodGhpcy5yZWNvbnN0cnVjdG9yID0gbnVsbCwgdGhpcy5lbWl0KCJkZWNvZGVkIiwgcikpOwogICAgICB9CiAgICB9LCBmLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkgewogICAgICB0aGlzLnJlY29uc3RydWN0b3IgJiYgdGhpcy5yZWNvbnN0cnVjdG9yLmZpbmlzaGVkUmVjb25zdHJ1Y3Rpb24oKTsKICAgIH0sIHAucHJvdG90eXBlLnRha2VCaW5hcnlEYXRhID0gZnVuY3Rpb24gKHQpIHsKICAgICAgaWYgKHRoaXMuYnVmZmVycy5wdXNoKHQpLCB0aGlzLmJ1ZmZlcnMubGVuZ3RoID09PSB0aGlzLnJlY29uUGFjay5hdHRhY2htZW50cykgewogICAgICAgIHZhciBlID0gaS5yZWNvbnN0cnVjdFBhY2tldCh0aGlzLnJlY29uUGFjaywgdGhpcy5idWZmZXJzKTsKICAgICAgICByZXR1cm4gdGhpcy5maW5pc2hlZFJlY29uc3RydWN0aW9uKCksIGU7CiAgICAgIH0KCiAgICAgIHJldHVybiBudWxsOwogICAgfSwgcC5wcm90b3R5cGUuZmluaXNoZWRSZWNvbnN0cnVjdGlvbiA9IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5yZWNvblBhY2sgPSBudWxsLCB0aGlzLmJ1ZmZlcnMgPSBbXTsKICAgIH07CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICAoZnVuY3Rpb24gKHQpIHsKICAgICAgLyohCiAgICAgICAqIFRoZSBidWZmZXIgbW9kdWxlIGZyb20gbm9kZS5qcywgZm9yIHRoZSBicm93c2VyLgogICAgICAgKgogICAgICAgKiBAYXV0aG9yICAgRmVyb3NzIEFib3VraGFkaWplaCA8aHR0cDovL2Zlcm9zcy5vcmc+CiAgICAgICAqIEBsaWNlbnNlICBNSVQKICAgICAgICovCiAgICAgIHZhciBuID0gcigyMiksCiAgICAgICAgICBvID0gcigyMyksCiAgICAgICAgICBpID0gcigyNCk7CgogICAgICBmdW5jdGlvbiBzKCkgewogICAgICAgIHJldHVybiBjLlRZUEVEX0FSUkFZX1NVUFBPUlQgPyAyMTQ3NDgzNjQ3IDogMTA3Mzc0MTgyMzsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gYSh0LCBlKSB7CiAgICAgICAgaWYgKHMoKSA8IGUpIHRocm93IG5ldyBSYW5nZUVycm9yKCJJbnZhbGlkIHR5cGVkIGFycmF5IGxlbmd0aCIpOwogICAgICAgIHJldHVybiBjLlRZUEVEX0FSUkFZX1NVUFBPUlQgPyAodCA9IG5ldyBVaW50OEFycmF5KGUpKS5fX3Byb3RvX18gPSBjLnByb3RvdHlwZSA6IChudWxsID09PSB0ICYmICh0ID0gbmV3IGMoZSkpLCB0Lmxlbmd0aCA9IGUpLCB0OwogICAgICB9CgogICAgICBmdW5jdGlvbiBjKHQsIGUsIHIpIHsKICAgICAgICBpZiAoIShjLlRZUEVEX0FSUkFZX1NVUFBPUlQgfHwgdGhpcyBpbnN0YW5jZW9mIGMpKSByZXR1cm4gbmV3IGModCwgZSwgcik7CgogICAgICAgIGlmICgibnVtYmVyIiA9PSB0eXBlb2YgdCkgewogICAgICAgICAgaWYgKCJzdHJpbmciID09IHR5cGVvZiBlKSB0aHJvdyBuZXcgRXJyb3IoIklmIGVuY29kaW5nIGlzIHNwZWNpZmllZCB0aGVuIHRoZSBmaXJzdCBhcmd1bWVudCBtdXN0IGJlIGEgc3RyaW5nIik7CiAgICAgICAgICByZXR1cm4gZih0aGlzLCB0KTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBoKHRoaXMsIHQsIGUsIHIpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBoKHQsIGUsIHIsIG4pIHsKICAgICAgICBpZiAoIm51bWJlciIgPT0gdHlwZW9mIGUpIHRocm93IG5ldyBUeXBlRXJyb3IoJyJ2YWx1ZSIgYXJndW1lbnQgbXVzdCBub3QgYmUgYSBudW1iZXInKTsKICAgICAgICByZXR1cm4gInVuZGVmaW5lZCIgIT0gdHlwZW9mIEFycmF5QnVmZmVyICYmIGUgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlciA/IGZ1bmN0aW9uICh0LCBlLCByLCBuKSB7CiAgICAgICAgICBpZiAoZS5ieXRlTGVuZ3RoLCByIDwgMCB8fCBlLmJ5dGVMZW5ndGggPCByKSB0aHJvdyBuZXcgUmFuZ2VFcnJvcigiJ29mZnNldCcgaXMgb3V0IG9mIGJvdW5kcyIpOwogICAgICAgICAgaWYgKGUuYnl0ZUxlbmd0aCA8IHIgKyAobiB8fCAwKSkgdGhyb3cgbmV3IFJhbmdlRXJyb3IoIidsZW5ndGgnIGlzIG91dCBvZiBib3VuZHMiKTsKICAgICAgICAgIGUgPSB2b2lkIDAgPT09IHIgJiYgdm9pZCAwID09PSBuID8gbmV3IFVpbnQ4QXJyYXkoZSkgOiB2b2lkIDAgPT09IG4gPyBuZXcgVWludDhBcnJheShlLCByKSA6IG5ldyBVaW50OEFycmF5KGUsIHIsIG4pOwogICAgICAgICAgYy5UWVBFRF9BUlJBWV9TVVBQT1JUID8gKHQgPSBlKS5fX3Byb3RvX18gPSBjLnByb3RvdHlwZSA6IHQgPSBwKHQsIGUpOwogICAgICAgICAgcmV0dXJuIHQ7CiAgICAgICAgfSh0LCBlLCByLCBuKSA6ICJzdHJpbmciID09IHR5cGVvZiBlID8gZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgICAgICAgICJzdHJpbmciID09IHR5cGVvZiByICYmICIiICE9PSByIHx8IChyID0gInV0ZjgiKTsKICAgICAgICAgIGlmICghYy5pc0VuY29kaW5nKHIpKSB0aHJvdyBuZXcgVHlwZUVycm9yKCciZW5jb2RpbmciIG11c3QgYmUgYSB2YWxpZCBzdHJpbmcgZW5jb2RpbmcnKTsKICAgICAgICAgIHZhciBuID0gMCB8IGQoZSwgciksCiAgICAgICAgICAgICAgbyA9ICh0ID0gYSh0LCBuKSkud3JpdGUoZSwgcik7CiAgICAgICAgICBvICE9PSBuICYmICh0ID0gdC5zbGljZSgwLCBvKSk7CiAgICAgICAgICByZXR1cm4gdDsKICAgICAgICB9KHQsIGUsIHIpIDogZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgICAgIGlmIChjLmlzQnVmZmVyKGUpKSB7CiAgICAgICAgICAgIHZhciByID0gMCB8IGwoZS5sZW5ndGgpOwogICAgICAgICAgICByZXR1cm4gMCA9PT0gKHQgPSBhKHQsIHIpKS5sZW5ndGggfHwgZS5jb3B5KHQsIDAsIDAsIHIpLCB0OwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChlKSB7CiAgICAgICAgICAgIGlmICgidW5kZWZpbmVkIiAhPSB0eXBlb2YgQXJyYXlCdWZmZXIgJiYgZS5idWZmZXIgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlciB8fCAibGVuZ3RoIiBpbiBlKSByZXR1cm4gIm51bWJlciIgIT0gdHlwZW9mIGUubGVuZ3RoIHx8IChuID0gZS5sZW5ndGgpICE9IG4gPyBhKHQsIDApIDogcCh0LCBlKTsKICAgICAgICAgICAgaWYgKCJCdWZmZXIiID09PSBlLnR5cGUgJiYgaShlLmRhdGEpKSByZXR1cm4gcCh0LCBlLmRhdGEpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBuOwogICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiRmlyc3QgYXJndW1lbnQgbXVzdCBiZSBhIHN0cmluZywgQnVmZmVyLCBBcnJheUJ1ZmZlciwgQXJyYXksIG9yIGFycmF5LWxpa2Ugb2JqZWN0LiIpOwogICAgICAgIH0odCwgZSk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIHUodCkgewogICAgICAgIGlmICgibnVtYmVyIiAhPSB0eXBlb2YgdCkgdGhyb3cgbmV3IFR5cGVFcnJvcignInNpemUiIGFyZ3VtZW50IG11c3QgYmUgYSBudW1iZXInKTsKICAgICAgICBpZiAodCA8IDApIHRocm93IG5ldyBSYW5nZUVycm9yKCcic2l6ZSIgYXJndW1lbnQgbXVzdCBub3QgYmUgbmVnYXRpdmUnKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gZih0LCBlKSB7CiAgICAgICAgaWYgKHUoZSksIHQgPSBhKHQsIGUgPCAwID8gMCA6IDAgfCBsKGUpKSwgIWMuVFlQRURfQVJSQVlfU1VQUE9SVCkgZm9yICh2YXIgciA9IDA7IHIgPCBlOyArK3IpIHsKICAgICAgICAgIHRbcl0gPSAwOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdDsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gcCh0LCBlKSB7CiAgICAgICAgdmFyIHIgPSBlLmxlbmd0aCA8IDAgPyAwIDogMCB8IGwoZS5sZW5ndGgpOwogICAgICAgIHQgPSBhKHQsIHIpOwoKICAgICAgICBmb3IgKHZhciBuID0gMDsgbiA8IHI7IG4gKz0gMSkgewogICAgICAgICAgdFtuXSA9IDI1NSAmIGVbbl07CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdDsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gbCh0KSB7CiAgICAgICAgaWYgKHQgPj0gcygpKSB0aHJvdyBuZXcgUmFuZ2VFcnJvcigiQXR0ZW1wdCB0byBhbGxvY2F0ZSBCdWZmZXIgbGFyZ2VyIHRoYW4gbWF4aW11bSBzaXplOiAweCIgKyBzKCkudG9TdHJpbmcoMTYpICsgIiBieXRlcyIpOwogICAgICAgIHJldHVybiAwIHwgdDsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gZCh0LCBlKSB7CiAgICAgICAgaWYgKGMuaXNCdWZmZXIodCkpIHJldHVybiB0Lmxlbmd0aDsKICAgICAgICBpZiAoInVuZGVmaW5lZCIgIT0gdHlwZW9mIEFycmF5QnVmZmVyICYmICJmdW5jdGlvbiIgPT0gdHlwZW9mIEFycmF5QnVmZmVyLmlzVmlldyAmJiAoQXJyYXlCdWZmZXIuaXNWaWV3KHQpIHx8IHQgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlcikpIHJldHVybiB0LmJ5dGVMZW5ndGg7CiAgICAgICAgInN0cmluZyIgIT0gdHlwZW9mIHQgJiYgKHQgPSAiIiArIHQpOwogICAgICAgIHZhciByID0gdC5sZW5ndGg7CiAgICAgICAgaWYgKDAgPT09IHIpIHJldHVybiAwOwoKICAgICAgICBmb3IgKHZhciBuID0gITE7OykgewogICAgICAgICAgc3dpdGNoIChlKSB7CiAgICAgICAgICAgIGNhc2UgImFzY2lpIjoKICAgICAgICAgICAgY2FzZSAibGF0aW4xIjoKICAgICAgICAgICAgY2FzZSAiYmluYXJ5IjoKICAgICAgICAgICAgICByZXR1cm4gcjsKCiAgICAgICAgICAgIGNhc2UgInV0ZjgiOgogICAgICAgICAgICBjYXNlICJ1dGYtOCI6CiAgICAgICAgICAgIGNhc2Ugdm9pZCAwOgogICAgICAgICAgICAgIHJldHVybiBxKHQpLmxlbmd0aDsKCiAgICAgICAgICAgIGNhc2UgInVjczIiOgogICAgICAgICAgICBjYXNlICJ1Y3MtMiI6CiAgICAgICAgICAgIGNhc2UgInV0ZjE2bGUiOgogICAgICAgICAgICBjYXNlICJ1dGYtMTZsZSI6CiAgICAgICAgICAgICAgcmV0dXJuIDIgKiByOwoKICAgICAgICAgICAgY2FzZSAiaGV4IjoKICAgICAgICAgICAgICByZXR1cm4gciA+Pj4gMTsKCiAgICAgICAgICAgIGNhc2UgImJhc2U2NCI6CiAgICAgICAgICAgICAgcmV0dXJuIFkodCkubGVuZ3RoOwoKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICBpZiAobikgcmV0dXJuIHEodCkubGVuZ3RoOwogICAgICAgICAgICAgIGUgPSAoIiIgKyBlKS50b0xvd2VyQ2FzZSgpLCBuID0gITA7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICBmdW5jdGlvbiB5KHQsIGUsIHIpIHsKICAgICAgICB2YXIgbiA9ICExOwogICAgICAgIGlmICgodm9pZCAwID09PSBlIHx8IGUgPCAwKSAmJiAoZSA9IDApLCBlID4gdGhpcy5sZW5ndGgpIHJldHVybiAiIjsKICAgICAgICBpZiAoKHZvaWQgMCA9PT0gciB8fCByID4gdGhpcy5sZW5ndGgpICYmIChyID0gdGhpcy5sZW5ndGgpLCByIDw9IDApIHJldHVybiAiIjsKICAgICAgICBpZiAoKHIgPj4+PSAwKSA8PSAoZSA+Pj49IDApKSByZXR1cm4gIiI7CgogICAgICAgIGZvciAodCB8fCAodCA9ICJ1dGY4Iik7OykgewogICAgICAgICAgc3dpdGNoICh0KSB7CiAgICAgICAgICAgIGNhc2UgImhleCI6CiAgICAgICAgICAgICAgcmV0dXJuIE8odGhpcywgZSwgcik7CgogICAgICAgICAgICBjYXNlICJ1dGY4IjoKICAgICAgICAgICAgY2FzZSAidXRmLTgiOgogICAgICAgICAgICAgIHJldHVybiBTKHRoaXMsIGUsIHIpOwoKICAgICAgICAgICAgY2FzZSAiYXNjaWkiOgogICAgICAgICAgICAgIHJldHVybiBDKHRoaXMsIGUsIHIpOwoKICAgICAgICAgICAgY2FzZSAibGF0aW4xIjoKICAgICAgICAgICAgY2FzZSAiYmluYXJ5IjoKICAgICAgICAgICAgICByZXR1cm4gUih0aGlzLCBlLCByKTsKCiAgICAgICAgICAgIGNhc2UgImJhc2U2NCI6CiAgICAgICAgICAgICAgcmV0dXJuIEIodGhpcywgZSwgcik7CgogICAgICAgICAgICBjYXNlICJ1Y3MyIjoKICAgICAgICAgICAgY2FzZSAidWNzLTIiOgogICAgICAgICAgICBjYXNlICJ1dGYxNmxlIjoKICAgICAgICAgICAgY2FzZSAidXRmLTE2bGUiOgogICAgICAgICAgICAgIHJldHVybiB4KHRoaXMsIGUsIHIpOwoKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICBpZiAobikgdGhyb3cgbmV3IFR5cGVFcnJvcigiVW5rbm93biBlbmNvZGluZzogIiArIHQpOwogICAgICAgICAgICAgIHQgPSAodCArICIiKS50b0xvd2VyQ2FzZSgpLCBuID0gITA7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICBmdW5jdGlvbiBnKHQsIGUsIHIpIHsKICAgICAgICB2YXIgbiA9IHRbZV07CiAgICAgICAgdFtlXSA9IHRbcl0sIHRbcl0gPSBuOwogICAgICB9CgogICAgICBmdW5jdGlvbiB2KHQsIGUsIHIsIG4sIG8pIHsKICAgICAgICBpZiAoMCA9PT0gdC5sZW5ndGgpIHJldHVybiAtMTsKCiAgICAgICAgaWYgKCJzdHJpbmciID09IHR5cGVvZiByID8gKG4gPSByLCByID0gMCkgOiByID4gMjE0NzQ4MzY0NyA/IHIgPSAyMTQ3NDgzNjQ3IDogciA8IC0yMTQ3NDgzNjQ4ICYmIChyID0gLTIxNDc0ODM2NDgpLCByID0gK3IsIGlzTmFOKHIpICYmIChyID0gbyA/IDAgOiB0Lmxlbmd0aCAtIDEpLCByIDwgMCAmJiAociA9IHQubGVuZ3RoICsgciksIHIgPj0gdC5sZW5ndGgpIHsKICAgICAgICAgIGlmIChvKSByZXR1cm4gLTE7CiAgICAgICAgICByID0gdC5sZW5ndGggLSAxOwogICAgICAgIH0gZWxzZSBpZiAociA8IDApIHsKICAgICAgICAgIGlmICghbykgcmV0dXJuIC0xOwogICAgICAgICAgciA9IDA7CiAgICAgICAgfQoKICAgICAgICBpZiAoInN0cmluZyIgPT0gdHlwZW9mIGUgJiYgKGUgPSBjLmZyb20oZSwgbikpLCBjLmlzQnVmZmVyKGUpKSByZXR1cm4gMCA9PT0gZS5sZW5ndGggPyAtMSA6IG0odCwgZSwgciwgbiwgbyk7CiAgICAgICAgaWYgKCJudW1iZXIiID09IHR5cGVvZiBlKSByZXR1cm4gZSAmPSAyNTUsIGMuVFlQRURfQVJSQVlfU1VQUE9SVCAmJiAiZnVuY3Rpb24iID09IHR5cGVvZiBVaW50OEFycmF5LnByb3RvdHlwZS5pbmRleE9mID8gbyA/IFVpbnQ4QXJyYXkucHJvdG90eXBlLmluZGV4T2YuY2FsbCh0LCBlLCByKSA6IFVpbnQ4QXJyYXkucHJvdG90eXBlLmxhc3RJbmRleE9mLmNhbGwodCwgZSwgcikgOiBtKHQsIFtlXSwgciwgbiwgbyk7CiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigidmFsIG11c3QgYmUgc3RyaW5nLCBudW1iZXIgb3IgQnVmZmVyIik7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIG0odCwgZSwgciwgbiwgbykgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBzID0gMSwKICAgICAgICAgICAgYSA9IHQubGVuZ3RoLAogICAgICAgICAgICBjID0gZS5sZW5ndGg7CgogICAgICAgIGlmICh2b2lkIDAgIT09IG4gJiYgKCJ1Y3MyIiA9PT0gKG4gPSBTdHJpbmcobikudG9Mb3dlckNhc2UoKSkgfHwgInVjcy0yIiA9PT0gbiB8fCAidXRmMTZsZSIgPT09IG4gfHwgInV0Zi0xNmxlIiA9PT0gbikpIHsKICAgICAgICAgIGlmICh0Lmxlbmd0aCA8IDIgfHwgZS5sZW5ndGggPCAyKSByZXR1cm4gLTE7CiAgICAgICAgICBzID0gMiwgYSAvPSAyLCBjIC89IDIsIHIgLz0gMjsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGgodCwgZSkgewogICAgICAgICAgcmV0dXJuIDEgPT09IHMgPyB0W2VdIDogdC5yZWFkVUludDE2QkUoZSAqIHMpOwogICAgICAgIH0KCiAgICAgICAgaWYgKG8pIHsKICAgICAgICAgIHZhciB1ID0gLTE7CgogICAgICAgICAgZm9yIChpID0gcjsgaSA8IGE7IGkrKykgewogICAgICAgICAgICBpZiAoaCh0LCBpKSA9PT0gaChlLCAtMSA9PT0gdSA/IDAgOiBpIC0gdSkpIHsKICAgICAgICAgICAgICBpZiAoLTEgPT09IHUgJiYgKHUgPSBpKSwgaSAtIHUgKyAxID09PSBjKSByZXR1cm4gdSAqIHM7CiAgICAgICAgICAgIH0gZWxzZSAtMSAhPT0gdSAmJiAoaSAtPSBpIC0gdSksIHUgPSAtMTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgZm9yIChyICsgYyA+IGEgJiYgKHIgPSBhIC0gYyksIGkgPSByOyBpID49IDA7IGktLSkgewogICAgICAgICAgZm9yICh2YXIgZiA9ICEwLCBwID0gMDsgcCA8IGM7IHArKykgewogICAgICAgICAgICBpZiAoaCh0LCBpICsgcCkgIT09IGgoZSwgcCkpIHsKICAgICAgICAgICAgICBmID0gITE7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZikgcmV0dXJuIGk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gLTE7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGIodCwgZSwgciwgbikgewogICAgICAgIHIgPSBOdW1iZXIocikgfHwgMDsKICAgICAgICB2YXIgbyA9IHQubGVuZ3RoIC0gcjsKICAgICAgICBuID8gKG4gPSBOdW1iZXIobikpID4gbyAmJiAobiA9IG8pIDogbiA9IG87CiAgICAgICAgdmFyIGkgPSBlLmxlbmd0aDsKICAgICAgICBpZiAoaSAlIDIgIT0gMCkgdGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBoZXggc3RyaW5nIik7CiAgICAgICAgbiA+IGkgLyAyICYmIChuID0gaSAvIDIpOwoKICAgICAgICBmb3IgKHZhciBzID0gMDsgcyA8IG47ICsrcykgewogICAgICAgICAgdmFyIGEgPSBwYXJzZUludChlLnN1YnN0cigyICogcywgMiksIDE2KTsKICAgICAgICAgIGlmIChpc05hTihhKSkgcmV0dXJuIHM7CiAgICAgICAgICB0W3IgKyBzXSA9IGE7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gczsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gdyh0LCBlLCByLCBuKSB7CiAgICAgICAgcmV0dXJuIEYocShlLCB0Lmxlbmd0aCAtIHIpLCB0LCByLCBuKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gQSh0LCBlLCByLCBuKSB7CiAgICAgICAgcmV0dXJuIEYoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIGZvciAodmFyIGUgPSBbXSwgciA9IDA7IHIgPCB0Lmxlbmd0aDsgKytyKSB7CiAgICAgICAgICAgIGUucHVzaCgyNTUgJiB0LmNoYXJDb2RlQXQocikpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBlOwogICAgICAgIH0oZSksIHQsIHIsIG4pOwogICAgICB9CgogICAgICBmdW5jdGlvbiBrKHQsIGUsIHIsIG4pIHsKICAgICAgICByZXR1cm4gQSh0LCBlLCByLCBuKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gXyh0LCBlLCByLCBuKSB7CiAgICAgICAgcmV0dXJuIEYoWShlKSwgdCwgciwgbik7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIEUodCwgZSwgciwgbikgewogICAgICAgIHJldHVybiBGKGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgICBmb3IgKHZhciByLCBuLCBvLCBpID0gW10sIHMgPSAwOyBzIDwgdC5sZW5ndGggJiYgISgoZSAtPSAyKSA8IDApOyArK3MpIHsKICAgICAgICAgICAgciA9IHQuY2hhckNvZGVBdChzKSwgbiA9IHIgPj4gOCwgbyA9IHIgJSAyNTYsIGkucHVzaChvKSwgaS5wdXNoKG4pOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBpOwogICAgICAgIH0oZSwgdC5sZW5ndGggLSByKSwgdCwgciwgbik7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIEIodCwgZSwgcikgewogICAgICAgIHJldHVybiAwID09PSBlICYmIHIgPT09IHQubGVuZ3RoID8gbi5mcm9tQnl0ZUFycmF5KHQpIDogbi5mcm9tQnl0ZUFycmF5KHQuc2xpY2UoZSwgcikpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBTKHQsIGUsIHIpIHsKICAgICAgICByID0gTWF0aC5taW4odC5sZW5ndGgsIHIpOwoKICAgICAgICBmb3IgKHZhciBuID0gW10sIG8gPSBlOyBvIDwgcjspIHsKICAgICAgICAgIHZhciBpLAogICAgICAgICAgICAgIHMsCiAgICAgICAgICAgICAgYSwKICAgICAgICAgICAgICBjLAogICAgICAgICAgICAgIGggPSB0W29dLAogICAgICAgICAgICAgIHUgPSBudWxsLAogICAgICAgICAgICAgIGYgPSBoID4gMjM5ID8gNCA6IGggPiAyMjMgPyAzIDogaCA+IDE5MSA/IDIgOiAxOwogICAgICAgICAgaWYgKG8gKyBmIDw9IHIpIHN3aXRjaCAoZikgewogICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgaCA8IDEyOCAmJiAodSA9IGgpOwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgIDEyOCA9PSAoMTkyICYgKGkgPSB0W28gKyAxXSkpICYmIChjID0gKDMxICYgaCkgPDwgNiB8IDYzICYgaSkgPiAxMjcgJiYgKHUgPSBjKTsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICBpID0gdFtvICsgMV0sIHMgPSB0W28gKyAyXSwgMTI4ID09ICgxOTIgJiBpKSAmJiAxMjggPT0gKDE5MiAmIHMpICYmIChjID0gKDE1ICYgaCkgPDwgMTIgfCAoNjMgJiBpKSA8PCA2IHwgNjMgJiBzKSA+IDIwNDcgJiYgKGMgPCA1NTI5NiB8fCBjID4gNTczNDMpICYmICh1ID0gYyk7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgaSA9IHRbbyArIDFdLCBzID0gdFtvICsgMl0sIGEgPSB0W28gKyAzXSwgMTI4ID09ICgxOTIgJiBpKSAmJiAxMjggPT0gKDE5MiAmIHMpICYmIDEyOCA9PSAoMTkyICYgYSkgJiYgKGMgPSAoMTUgJiBoKSA8PCAxOCB8ICg2MyAmIGkpIDw8IDEyIHwgKDYzICYgcykgPDwgNiB8IDYzICYgYSkgPiA2NTUzNSAmJiBjIDwgMTExNDExMiAmJiAodSA9IGMpOwogICAgICAgICAgfQogICAgICAgICAgbnVsbCA9PT0gdSA/ICh1ID0gNjU1MzMsIGYgPSAxKSA6IHUgPiA2NTUzNSAmJiAodSAtPSA2NTUzNiwgbi5wdXNoKHUgPj4+IDEwICYgMTAyMyB8IDU1Mjk2KSwgdSA9IDU2MzIwIHwgMTAyMyAmIHUpLCBuLnB1c2godSksIG8gKz0gZjsKICAgICAgICB9CgogICAgICAgIHJldHVybiBmdW5jdGlvbiAodCkgewogICAgICAgICAgdmFyIGUgPSB0Lmxlbmd0aDsKICAgICAgICAgIGlmIChlIDw9IDQwOTYpIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KFN0cmluZywgdCk7CiAgICAgICAgICB2YXIgciA9ICIiLAogICAgICAgICAgICAgIG4gPSAwOwoKICAgICAgICAgIGZvciAoOyBuIDwgZTspIHsKICAgICAgICAgICAgciArPSBTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KFN0cmluZywgdC5zbGljZShuLCBuICs9IDQwOTYpKTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gcjsKICAgICAgICB9KG4pOwogICAgICB9CgogICAgICBlLkJ1ZmZlciA9IGMsIGUuU2xvd0J1ZmZlciA9IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgK3QgIT0gdCAmJiAodCA9IDApOwogICAgICAgIHJldHVybiBjLmFsbG9jKCt0KTsKICAgICAgfSwgZS5JTlNQRUNUX01BWF9CWVRFUyA9IDUwLCBjLlRZUEVEX0FSUkFZX1NVUFBPUlQgPSB2b2lkIDAgIT09IHQuVFlQRURfQVJSQVlfU1VQUE9SVCA/IHQuVFlQRURfQVJSQVlfU1VQUE9SVCA6IGZ1bmN0aW9uICgpIHsKICAgICAgICB0cnkgewogICAgICAgICAgdmFyIHQgPSBuZXcgVWludDhBcnJheSgxKTsKICAgICAgICAgIHJldHVybiB0Ll9fcHJvdG9fXyA9IHsKICAgICAgICAgICAgX19wcm90b19fOiBVaW50OEFycmF5LnByb3RvdHlwZSwKICAgICAgICAgICAgZm9vOiBmdW5jdGlvbiBmb28oKSB7CiAgICAgICAgICAgICAgcmV0dXJuIDQyOwogICAgICAgICAgICB9CiAgICAgICAgICB9LCA0MiA9PT0gdC5mb28oKSAmJiAiZnVuY3Rpb24iID09IHR5cGVvZiB0LnN1YmFycmF5ICYmIDAgPT09IHQuc3ViYXJyYXkoMSwgMSkuYnl0ZUxlbmd0aDsKICAgICAgICB9IGNhdGNoICh0KSB7CiAgICAgICAgICByZXR1cm4gITE7CiAgICAgICAgfQogICAgICB9KCksIGUua01heExlbmd0aCA9IHMoKSwgYy5wb29sU2l6ZSA9IDgxOTIsIGMuX2F1Z21lbnQgPSBmdW5jdGlvbiAodCkgewogICAgICAgIHJldHVybiB0Ll9fcHJvdG9fXyA9IGMucHJvdG90eXBlLCB0OwogICAgICB9LCBjLmZyb20gPSBmdW5jdGlvbiAodCwgZSwgcikgewogICAgICAgIHJldHVybiBoKG51bGwsIHQsIGUsIHIpOwogICAgICB9LCBjLlRZUEVEX0FSUkFZX1NVUFBPUlQgJiYgKGMucHJvdG90eXBlLl9fcHJvdG9fXyA9IFVpbnQ4QXJyYXkucHJvdG90eXBlLCBjLl9fcHJvdG9fXyA9IFVpbnQ4QXJyYXksICJ1bmRlZmluZWQiICE9IHR5cGVvZiBTeW1ib2wgJiYgU3ltYm9sLnNwZWNpZXMgJiYgY1tTeW1ib2wuc3BlY2llc10gPT09IGMgJiYgT2JqZWN0LmRlZmluZVByb3BlcnR5KGMsIFN5bWJvbC5zcGVjaWVzLCB7CiAgICAgICAgdmFsdWU6IG51bGwsCiAgICAgICAgY29uZmlndXJhYmxlOiAhMAogICAgICB9KSksIGMuYWxsb2MgPSBmdW5jdGlvbiAodCwgZSwgcikgewogICAgICAgIHJldHVybiBmdW5jdGlvbiAodCwgZSwgciwgbikgewogICAgICAgICAgcmV0dXJuIHUoZSksIGUgPD0gMCA/IGEodCwgZSkgOiB2b2lkIDAgIT09IHIgPyAic3RyaW5nIiA9PSB0eXBlb2YgbiA/IGEodCwgZSkuZmlsbChyLCBuKSA6IGEodCwgZSkuZmlsbChyKSA6IGEodCwgZSk7CiAgICAgICAgfShudWxsLCB0LCBlLCByKTsKICAgICAgfSwgYy5hbGxvY1Vuc2FmZSA9IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgcmV0dXJuIGYobnVsbCwgdCk7CiAgICAgIH0sIGMuYWxsb2NVbnNhZmVTbG93ID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICByZXR1cm4gZihudWxsLCB0KTsKICAgICAgfSwgYy5pc0J1ZmZlciA9IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgcmV0dXJuICEobnVsbCA9PSB0IHx8ICF0Ll9pc0J1ZmZlcik7CiAgICAgIH0sIGMuY29tcGFyZSA9IGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgaWYgKCFjLmlzQnVmZmVyKHQpIHx8ICFjLmlzQnVmZmVyKGUpKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJBcmd1bWVudHMgbXVzdCBiZSBCdWZmZXJzIik7CiAgICAgICAgaWYgKHQgPT09IGUpIHJldHVybiAwOwoKICAgICAgICBmb3IgKHZhciByID0gdC5sZW5ndGgsIG4gPSBlLmxlbmd0aCwgbyA9IDAsIGkgPSBNYXRoLm1pbihyLCBuKTsgbyA8IGk7ICsrbykgewogICAgICAgICAgaWYgKHRbb10gIT09IGVbb10pIHsKICAgICAgICAgICAgciA9IHRbb10sIG4gPSBlW29dOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiByIDwgbiA/IC0xIDogbiA8IHIgPyAxIDogMDsKICAgICAgfSwgYy5pc0VuY29kaW5nID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICBzd2l0Y2ggKFN0cmluZyh0KS50b0xvd2VyQ2FzZSgpKSB7CiAgICAgICAgICBjYXNlICJoZXgiOgogICAgICAgICAgY2FzZSAidXRmOCI6CiAgICAgICAgICBjYXNlICJ1dGYtOCI6CiAgICAgICAgICBjYXNlICJhc2NpaSI6CiAgICAgICAgICBjYXNlICJsYXRpbjEiOgogICAgICAgICAgY2FzZSAiYmluYXJ5IjoKICAgICAgICAgIGNhc2UgImJhc2U2NCI6CiAgICAgICAgICBjYXNlICJ1Y3MyIjoKICAgICAgICAgIGNhc2UgInVjcy0yIjoKICAgICAgICAgIGNhc2UgInV0ZjE2bGUiOgogICAgICAgICAgY2FzZSAidXRmLTE2bGUiOgogICAgICAgICAgICByZXR1cm4gITA7CgogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgcmV0dXJuICExOwogICAgICAgIH0KICAgICAgfSwgYy5jb25jYXQgPSBmdW5jdGlvbiAodCwgZSkgewogICAgICAgIGlmICghaSh0KSkgdGhyb3cgbmV3IFR5cGVFcnJvcignImxpc3QiIGFyZ3VtZW50IG11c3QgYmUgYW4gQXJyYXkgb2YgQnVmZmVycycpOwogICAgICAgIGlmICgwID09PSB0Lmxlbmd0aCkgcmV0dXJuIGMuYWxsb2MoMCk7CiAgICAgICAgdmFyIHI7CiAgICAgICAgaWYgKHZvaWQgMCA9PT0gZSkgZm9yIChlID0gMCwgciA9IDA7IHIgPCB0Lmxlbmd0aDsgKytyKSB7CiAgICAgICAgICBlICs9IHRbcl0ubGVuZ3RoOwogICAgICAgIH0KICAgICAgICB2YXIgbiA9IGMuYWxsb2NVbnNhZmUoZSksCiAgICAgICAgICAgIG8gPSAwOwoKICAgICAgICBmb3IgKHIgPSAwOyByIDwgdC5sZW5ndGg7ICsrcikgewogICAgICAgICAgdmFyIHMgPSB0W3JdOwogICAgICAgICAgaWYgKCFjLmlzQnVmZmVyKHMpKSB0aHJvdyBuZXcgVHlwZUVycm9yKCcibGlzdCIgYXJndW1lbnQgbXVzdCBiZSBhbiBBcnJheSBvZiBCdWZmZXJzJyk7CiAgICAgICAgICBzLmNvcHkobiwgbyksIG8gKz0gcy5sZW5ndGg7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbjsKICAgICAgfSwgYy5ieXRlTGVuZ3RoID0gZCwgYy5wcm90b3R5cGUuX2lzQnVmZmVyID0gITAsIGMucHJvdG90eXBlLnN3YXAxNiA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgdCA9IHRoaXMubGVuZ3RoOwogICAgICAgIGlmICh0ICUgMiAhPSAwKSB0aHJvdyBuZXcgUmFuZ2VFcnJvcigiQnVmZmVyIHNpemUgbXVzdCBiZSBhIG11bHRpcGxlIG9mIDE2LWJpdHMiKTsKCiAgICAgICAgZm9yICh2YXIgZSA9IDA7IGUgPCB0OyBlICs9IDIpIHsKICAgICAgICAgIGcodGhpcywgZSwgZSArIDEpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0sIGMucHJvdG90eXBlLnN3YXAzMiA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgdCA9IHRoaXMubGVuZ3RoOwogICAgICAgIGlmICh0ICUgNCAhPSAwKSB0aHJvdyBuZXcgUmFuZ2VFcnJvcigiQnVmZmVyIHNpemUgbXVzdCBiZSBhIG11bHRpcGxlIG9mIDMyLWJpdHMiKTsKCiAgICAgICAgZm9yICh2YXIgZSA9IDA7IGUgPCB0OyBlICs9IDQpIHsKICAgICAgICAgIGcodGhpcywgZSwgZSArIDMpLCBnKHRoaXMsIGUgKyAxLCBlICsgMik7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfSwgYy5wcm90b3R5cGUuc3dhcDY0ID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciB0ID0gdGhpcy5sZW5ndGg7CiAgICAgICAgaWYgKHQgJSA4ICE9IDApIHRocm93IG5ldyBSYW5nZUVycm9yKCJCdWZmZXIgc2l6ZSBtdXN0IGJlIGEgbXVsdGlwbGUgb2YgNjQtYml0cyIpOwoKICAgICAgICBmb3IgKHZhciBlID0gMDsgZSA8IHQ7IGUgKz0gOCkgewogICAgICAgICAgZyh0aGlzLCBlLCBlICsgNyksIGcodGhpcywgZSArIDEsIGUgKyA2KSwgZyh0aGlzLCBlICsgMiwgZSArIDUpLCBnKHRoaXMsIGUgKyAzLCBlICsgNCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfSwgYy5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHQgPSAwIHwgdGhpcy5sZW5ndGg7CiAgICAgICAgcmV0dXJuIDAgPT09IHQgPyAiIiA6IDAgPT09IGFyZ3VtZW50cy5sZW5ndGggPyBTKHRoaXMsIDAsIHQpIDogeS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9LCBjLnByb3RvdHlwZS5lcXVhbHMgPSBmdW5jdGlvbiAodCkgewogICAgICAgIGlmICghYy5pc0J1ZmZlcih0KSkgdGhyb3cgbmV3IFR5cGVFcnJvcigiQXJndW1lbnQgbXVzdCBiZSBhIEJ1ZmZlciIpOwogICAgICAgIHJldHVybiB0aGlzID09PSB0IHx8IDAgPT09IGMuY29tcGFyZSh0aGlzLCB0KTsKICAgICAgfSwgYy5wcm90b3R5cGUuaW5zcGVjdCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgdCA9ICIiLAogICAgICAgICAgICByID0gZS5JTlNQRUNUX01BWF9CWVRFUzsKICAgICAgICByZXR1cm4gdGhpcy5sZW5ndGggPiAwICYmICh0ID0gdGhpcy50b1N0cmluZygiaGV4IiwgMCwgcikubWF0Y2goLy57Mn0vZykuam9pbigiICIpLCB0aGlzLmxlbmd0aCA+IHIgJiYgKHQgKz0gIiAuLi4gIikpLCAiPEJ1ZmZlciAiICsgdCArICI+IjsKICAgICAgfSwgYy5wcm90b3R5cGUuY29tcGFyZSA9IGZ1bmN0aW9uICh0LCBlLCByLCBuLCBvKSB7CiAgICAgICAgaWYgKCFjLmlzQnVmZmVyKHQpKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJBcmd1bWVudCBtdXN0IGJlIGEgQnVmZmVyIik7CiAgICAgICAgaWYgKHZvaWQgMCA9PT0gZSAmJiAoZSA9IDApLCB2b2lkIDAgPT09IHIgJiYgKHIgPSB0ID8gdC5sZW5ndGggOiAwKSwgdm9pZCAwID09PSBuICYmIChuID0gMCksIHZvaWQgMCA9PT0gbyAmJiAobyA9IHRoaXMubGVuZ3RoKSwgZSA8IDAgfHwgciA+IHQubGVuZ3RoIHx8IG4gPCAwIHx8IG8gPiB0aGlzLmxlbmd0aCkgdGhyb3cgbmV3IFJhbmdlRXJyb3IoIm91dCBvZiByYW5nZSBpbmRleCIpOwogICAgICAgIGlmIChuID49IG8gJiYgZSA+PSByKSByZXR1cm4gMDsKICAgICAgICBpZiAobiA+PSBvKSByZXR1cm4gLTE7CiAgICAgICAgaWYgKGUgPj0gcikgcmV0dXJuIDE7CiAgICAgICAgaWYgKHRoaXMgPT09IHQpIHJldHVybiAwOwoKICAgICAgICBmb3IgKHZhciBpID0gKG8gPj4+PSAwKSAtIChuID4+Pj0gMCksIHMgPSAociA+Pj49IDApIC0gKGUgPj4+PSAwKSwgYSA9IE1hdGgubWluKGksIHMpLCBoID0gdGhpcy5zbGljZShuLCBvKSwgdSA9IHQuc2xpY2UoZSwgciksIGYgPSAwOyBmIDwgYTsgKytmKSB7CiAgICAgICAgICBpZiAoaFtmXSAhPT0gdVtmXSkgewogICAgICAgICAgICBpID0gaFtmXSwgcyA9IHVbZl07CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGkgPCBzID8gLTEgOiBzIDwgaSA/IDEgOiAwOwogICAgICB9LCBjLnByb3RvdHlwZS5pbmNsdWRlcyA9IGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICAgICAgcmV0dXJuIC0xICE9PSB0aGlzLmluZGV4T2YodCwgZSwgcik7CiAgICAgIH0sIGMucHJvdG90eXBlLmluZGV4T2YgPSBmdW5jdGlvbiAodCwgZSwgcikgewogICAgICAgIHJldHVybiB2KHRoaXMsIHQsIGUsIHIsICEwKTsKICAgICAgfSwgYy5wcm90b3R5cGUubGFzdEluZGV4T2YgPSBmdW5jdGlvbiAodCwgZSwgcikgewogICAgICAgIHJldHVybiB2KHRoaXMsIHQsIGUsIHIsICExKTsKICAgICAgfSwgYy5wcm90b3R5cGUud3JpdGUgPSBmdW5jdGlvbiAodCwgZSwgciwgbikgewogICAgICAgIGlmICh2b2lkIDAgPT09IGUpIG4gPSAidXRmOCIsIHIgPSB0aGlzLmxlbmd0aCwgZSA9IDA7ZWxzZSBpZiAodm9pZCAwID09PSByICYmICJzdHJpbmciID09IHR5cGVvZiBlKSBuID0gZSwgciA9IHRoaXMubGVuZ3RoLCBlID0gMDtlbHNlIHsKICAgICAgICAgIGlmICghaXNGaW5pdGUoZSkpIHRocm93IG5ldyBFcnJvcigiQnVmZmVyLndyaXRlKHN0cmluZywgZW5jb2RpbmcsIG9mZnNldFssIGxlbmd0aF0pIGlzIG5vIGxvbmdlciBzdXBwb3J0ZWQiKTsKICAgICAgICAgIGUgfD0gMCwgaXNGaW5pdGUocikgPyAociB8PSAwLCB2b2lkIDAgPT09IG4gJiYgKG4gPSAidXRmOCIpKSA6IChuID0gciwgciA9IHZvaWQgMCk7CiAgICAgICAgfQogICAgICAgIHZhciBvID0gdGhpcy5sZW5ndGggLSBlOwogICAgICAgIGlmICgodm9pZCAwID09PSByIHx8IHIgPiBvKSAmJiAociA9IG8pLCB0Lmxlbmd0aCA+IDAgJiYgKHIgPCAwIHx8IGUgPCAwKSB8fCBlID4gdGhpcy5sZW5ndGgpIHRocm93IG5ldyBSYW5nZUVycm9yKCJBdHRlbXB0IHRvIHdyaXRlIG91dHNpZGUgYnVmZmVyIGJvdW5kcyIpOwogICAgICAgIG4gfHwgKG4gPSAidXRmOCIpOwoKICAgICAgICBmb3IgKHZhciBpID0gITE7OykgewogICAgICAgICAgc3dpdGNoIChuKSB7CiAgICAgICAgICAgIGNhc2UgImhleCI6CiAgICAgICAgICAgICAgcmV0dXJuIGIodGhpcywgdCwgZSwgcik7CgogICAgICAgICAgICBjYXNlICJ1dGY4IjoKICAgICAgICAgICAgY2FzZSAidXRmLTgiOgogICAgICAgICAgICAgIHJldHVybiB3KHRoaXMsIHQsIGUsIHIpOwoKICAgICAgICAgICAgY2FzZSAiYXNjaWkiOgogICAgICAgICAgICAgIHJldHVybiBBKHRoaXMsIHQsIGUsIHIpOwoKICAgICAgICAgICAgY2FzZSAibGF0aW4xIjoKICAgICAgICAgICAgY2FzZSAiYmluYXJ5IjoKICAgICAgICAgICAgICByZXR1cm4gayh0aGlzLCB0LCBlLCByKTsKCiAgICAgICAgICAgIGNhc2UgImJhc2U2NCI6CiAgICAgICAgICAgICAgcmV0dXJuIF8odGhpcywgdCwgZSwgcik7CgogICAgICAgICAgICBjYXNlICJ1Y3MyIjoKICAgICAgICAgICAgY2FzZSAidWNzLTIiOgogICAgICAgICAgICBjYXNlICJ1dGYxNmxlIjoKICAgICAgICAgICAgY2FzZSAidXRmLTE2bGUiOgogICAgICAgICAgICAgIHJldHVybiBFKHRoaXMsIHQsIGUsIHIpOwoKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICBpZiAoaSkgdGhyb3cgbmV3IFR5cGVFcnJvcigiVW5rbm93biBlbmNvZGluZzogIiArIG4pOwogICAgICAgICAgICAgIG4gPSAoIiIgKyBuKS50b0xvd2VyQ2FzZSgpLCBpID0gITA7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCBjLnByb3RvdHlwZS50b0pTT04gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHR5cGU6ICJCdWZmZXIiLAogICAgICAgICAgZGF0YTogQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwodGhpcy5fYXJyIHx8IHRoaXMsIDApCiAgICAgICAgfTsKICAgICAgfTsKCiAgICAgIGZ1bmN0aW9uIEModCwgZSwgcikgewogICAgICAgIHZhciBuID0gIiI7CiAgICAgICAgciA9IE1hdGgubWluKHQubGVuZ3RoLCByKTsKCiAgICAgICAgZm9yICh2YXIgbyA9IGU7IG8gPCByOyArK28pIHsKICAgICAgICAgIG4gKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgxMjcgJiB0W29dKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBuOwogICAgICB9CgogICAgICBmdW5jdGlvbiBSKHQsIGUsIHIpIHsKICAgICAgICB2YXIgbiA9ICIiOwogICAgICAgIHIgPSBNYXRoLm1pbih0Lmxlbmd0aCwgcik7CgogICAgICAgIGZvciAodmFyIG8gPSBlOyBvIDwgcjsgKytvKSB7CiAgICAgICAgICBuICs9IFN0cmluZy5mcm9tQ2hhckNvZGUodFtvXSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbjsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gTyh0LCBlLCByKSB7CiAgICAgICAgdmFyIG4gPSB0Lmxlbmd0aDsKICAgICAgICAoIWUgfHwgZSA8IDApICYmIChlID0gMCksICghciB8fCByIDwgMCB8fCByID4gbikgJiYgKHIgPSBuKTsKCiAgICAgICAgZm9yICh2YXIgbyA9ICIiLCBpID0gZTsgaSA8IHI7ICsraSkgewogICAgICAgICAgbyArPSBEKHRbaV0pOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG87CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIHgodCwgZSwgcikgewogICAgICAgIGZvciAodmFyIG4gPSB0LnNsaWNlKGUsIHIpLCBvID0gIiIsIGkgPSAwOyBpIDwgbi5sZW5ndGg7IGkgKz0gMikgewogICAgICAgICAgbyArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKG5baV0gKyAyNTYgKiBuW2kgKyAxXSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbzsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gUCh0LCBlLCByKSB7CiAgICAgICAgaWYgKHQgJSAxICE9IDAgfHwgdCA8IDApIHRocm93IG5ldyBSYW5nZUVycm9yKCJvZmZzZXQgaXMgbm90IHVpbnQiKTsKICAgICAgICBpZiAodCArIGUgPiByKSB0aHJvdyBuZXcgUmFuZ2VFcnJvcigiVHJ5aW5nIHRvIGFjY2VzcyBiZXlvbmQgYnVmZmVyIGxlbmd0aCIpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBUKHQsIGUsIHIsIG4sIG8sIGkpIHsKICAgICAgICBpZiAoIWMuaXNCdWZmZXIodCkpIHRocm93IG5ldyBUeXBlRXJyb3IoJyJidWZmZXIiIGFyZ3VtZW50IG11c3QgYmUgYSBCdWZmZXIgaW5zdGFuY2UnKTsKICAgICAgICBpZiAoZSA+IG8gfHwgZSA8IGkpIHRocm93IG5ldyBSYW5nZUVycm9yKCcidmFsdWUiIGFyZ3VtZW50IGlzIG91dCBvZiBib3VuZHMnKTsKICAgICAgICBpZiAociArIG4gPiB0Lmxlbmd0aCkgdGhyb3cgbmV3IFJhbmdlRXJyb3IoIkluZGV4IG91dCBvZiByYW5nZSIpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBOKHQsIGUsIHIsIG4pIHsKICAgICAgICBlIDwgMCAmJiAoZSA9IDY1NTM1ICsgZSArIDEpOwoKICAgICAgICBmb3IgKHZhciBvID0gMCwgaSA9IE1hdGgubWluKHQubGVuZ3RoIC0gciwgMik7IG8gPCBpOyArK28pIHsKICAgICAgICAgIHRbciArIG9dID0gKGUgJiAyNTUgPDwgOCAqIChuID8gbyA6IDEgLSBvKSkgPj4+IDggKiAobiA/IG8gOiAxIC0gbyk7CiAgICAgICAgfQogICAgICB9CgogICAgICBmdW5jdGlvbiBMKHQsIGUsIHIsIG4pIHsKICAgICAgICBlIDwgMCAmJiAoZSA9IDQyOTQ5NjcyOTUgKyBlICsgMSk7CgogICAgICAgIGZvciAodmFyIG8gPSAwLCBpID0gTWF0aC5taW4odC5sZW5ndGggLSByLCA0KTsgbyA8IGk7ICsrbykgewogICAgICAgICAgdFtyICsgb10gPSBlID4+PiA4ICogKG4gPyBvIDogMyAtIG8pICYgMjU1OwogICAgICAgIH0KICAgICAgfQoKICAgICAgZnVuY3Rpb24gaih0LCBlLCByLCBuLCBvLCBpKSB7CiAgICAgICAgaWYgKHIgKyBuID4gdC5sZW5ndGgpIHRocm93IG5ldyBSYW5nZUVycm9yKCJJbmRleCBvdXQgb2YgcmFuZ2UiKTsKICAgICAgICBpZiAociA8IDApIHRocm93IG5ldyBSYW5nZUVycm9yKCJJbmRleCBvdXQgb2YgcmFuZ2UiKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gSSh0LCBlLCByLCBuLCBpKSB7CiAgICAgICAgcmV0dXJuIGkgfHwgaih0LCAwLCByLCA0KSwgby53cml0ZSh0LCBlLCByLCBuLCAyMywgNCksIHIgKyA0OwogICAgICB9CgogICAgICBmdW5jdGlvbiBVKHQsIGUsIHIsIG4sIGkpIHsKICAgICAgICByZXR1cm4gaSB8fCBqKHQsIDAsIHIsIDgpLCBvLndyaXRlKHQsIGUsIHIsIG4sIDUyLCA4KSwgciArIDg7CiAgICAgIH0KCiAgICAgIGMucHJvdG90eXBlLnNsaWNlID0gZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgICB2YXIgciwKICAgICAgICAgICAgbiA9IHRoaXMubGVuZ3RoOwogICAgICAgIGlmICgodCA9IH5+dCkgPCAwID8gKHQgKz0gbikgPCAwICYmICh0ID0gMCkgOiB0ID4gbiAmJiAodCA9IG4pLCAoZSA9IHZvaWQgMCA9PT0gZSA/IG4gOiB+fmUpIDwgMCA/IChlICs9IG4pIDwgMCAmJiAoZSA9IDApIDogZSA+IG4gJiYgKGUgPSBuKSwgZSA8IHQgJiYgKGUgPSB0KSwgYy5UWVBFRF9BUlJBWV9TVVBQT1JUKSAociA9IHRoaXMuc3ViYXJyYXkodCwgZSkpLl9fcHJvdG9fXyA9IGMucHJvdG90eXBlO2Vsc2UgewogICAgICAgICAgdmFyIG8gPSBlIC0gdDsKICAgICAgICAgIHIgPSBuZXcgYyhvLCB2b2lkIDApOwoKICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbzsgKytpKSB7CiAgICAgICAgICAgIHJbaV0gPSB0aGlzW2kgKyB0XTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHI7CiAgICAgIH0sIGMucHJvdG90eXBlLnJlYWRVSW50TEUgPSBmdW5jdGlvbiAodCwgZSwgcikgewogICAgICAgIHQgfD0gMCwgZSB8PSAwLCByIHx8IFAodCwgZSwgdGhpcy5sZW5ndGgpOwoKICAgICAgICBmb3IgKHZhciBuID0gdGhpc1t0XSwgbyA9IDEsIGkgPSAwOyArK2kgPCBlICYmIChvICo9IDI1Nik7KSB7CiAgICAgICAgICBuICs9IHRoaXNbdCArIGldICogbzsKICAgICAgICB9CgogICAgICAgIHJldHVybiBuOwogICAgICB9LCBjLnByb3RvdHlwZS5yZWFkVUludEJFID0gZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgICAgICB0IHw9IDAsIGUgfD0gMCwgciB8fCBQKHQsIGUsIHRoaXMubGVuZ3RoKTsKCiAgICAgICAgZm9yICh2YXIgbiA9IHRoaXNbdCArIC0tZV0sIG8gPSAxOyBlID4gMCAmJiAobyAqPSAyNTYpOykgewogICAgICAgICAgbiArPSB0aGlzW3QgKyAtLWVdICogbzsKICAgICAgICB9CgogICAgICAgIHJldHVybiBuOwogICAgICB9LCBjLnByb3RvdHlwZS5yZWFkVUludDggPSBmdW5jdGlvbiAodCwgZSkgewogICAgICAgIHJldHVybiBlIHx8IFAodCwgMSwgdGhpcy5sZW5ndGgpLCB0aGlzW3RdOwogICAgICB9LCBjLnByb3RvdHlwZS5yZWFkVUludDE2TEUgPSBmdW5jdGlvbiAodCwgZSkgewogICAgICAgIHJldHVybiBlIHx8IFAodCwgMiwgdGhpcy5sZW5ndGgpLCB0aGlzW3RdIHwgdGhpc1t0ICsgMV0gPDwgODsKICAgICAgfSwgYy5wcm90b3R5cGUucmVhZFVJbnQxNkJFID0gZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgICByZXR1cm4gZSB8fCBQKHQsIDIsIHRoaXMubGVuZ3RoKSwgdGhpc1t0XSA8PCA4IHwgdGhpc1t0ICsgMV07CiAgICAgIH0sIGMucHJvdG90eXBlLnJlYWRVSW50MzJMRSA9IGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgcmV0dXJuIGUgfHwgUCh0LCA0LCB0aGlzLmxlbmd0aCksICh0aGlzW3RdIHwgdGhpc1t0ICsgMV0gPDwgOCB8IHRoaXNbdCArIDJdIDw8IDE2KSArIDE2Nzc3MjE2ICogdGhpc1t0ICsgM107CiAgICAgIH0sIGMucHJvdG90eXBlLnJlYWRVSW50MzJCRSA9IGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgcmV0dXJuIGUgfHwgUCh0LCA0LCB0aGlzLmxlbmd0aCksIDE2Nzc3MjE2ICogdGhpc1t0XSArICh0aGlzW3QgKyAxXSA8PCAxNiB8IHRoaXNbdCArIDJdIDw8IDggfCB0aGlzW3QgKyAzXSk7CiAgICAgIH0sIGMucHJvdG90eXBlLnJlYWRJbnRMRSA9IGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICAgICAgdCB8PSAwLCBlIHw9IDAsIHIgfHwgUCh0LCBlLCB0aGlzLmxlbmd0aCk7CgogICAgICAgIGZvciAodmFyIG4gPSB0aGlzW3RdLCBvID0gMSwgaSA9IDA7ICsraSA8IGUgJiYgKG8gKj0gMjU2KTspIHsKICAgICAgICAgIG4gKz0gdGhpc1t0ICsgaV0gKiBvOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG4gPj0gKG8gKj0gMTI4KSAmJiAobiAtPSBNYXRoLnBvdygyLCA4ICogZSkpLCBuOwogICAgICB9LCBjLnByb3RvdHlwZS5yZWFkSW50QkUgPSBmdW5jdGlvbiAodCwgZSwgcikgewogICAgICAgIHQgfD0gMCwgZSB8PSAwLCByIHx8IFAodCwgZSwgdGhpcy5sZW5ndGgpOwoKICAgICAgICBmb3IgKHZhciBuID0gZSwgbyA9IDEsIGkgPSB0aGlzW3QgKyAtLW5dOyBuID4gMCAmJiAobyAqPSAyNTYpOykgewogICAgICAgICAgaSArPSB0aGlzW3QgKyAtLW5dICogbzsKICAgICAgICB9CgogICAgICAgIHJldHVybiBpID49IChvICo9IDEyOCkgJiYgKGkgLT0gTWF0aC5wb3coMiwgOCAqIGUpKSwgaTsKICAgICAgfSwgYy5wcm90b3R5cGUucmVhZEludDggPSBmdW5jdGlvbiAodCwgZSkgewogICAgICAgIHJldHVybiBlIHx8IFAodCwgMSwgdGhpcy5sZW5ndGgpLCAxMjggJiB0aGlzW3RdID8gLTEgKiAoMjU1IC0gdGhpc1t0XSArIDEpIDogdGhpc1t0XTsKICAgICAgfSwgYy5wcm90b3R5cGUucmVhZEludDE2TEUgPSBmdW5jdGlvbiAodCwgZSkgewogICAgICAgIGUgfHwgUCh0LCAyLCB0aGlzLmxlbmd0aCk7CiAgICAgICAgdmFyIHIgPSB0aGlzW3RdIHwgdGhpc1t0ICsgMV0gPDwgODsKICAgICAgICByZXR1cm4gMzI3NjggJiByID8gNDI5NDkwMTc2MCB8IHIgOiByOwogICAgICB9LCBjLnByb3RvdHlwZS5yZWFkSW50MTZCRSA9IGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgZSB8fCBQKHQsIDIsIHRoaXMubGVuZ3RoKTsKICAgICAgICB2YXIgciA9IHRoaXNbdCArIDFdIHwgdGhpc1t0XSA8PCA4OwogICAgICAgIHJldHVybiAzMjc2OCAmIHIgPyA0Mjk0OTAxNzYwIHwgciA6IHI7CiAgICAgIH0sIGMucHJvdG90eXBlLnJlYWRJbnQzMkxFID0gZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgICByZXR1cm4gZSB8fCBQKHQsIDQsIHRoaXMubGVuZ3RoKSwgdGhpc1t0XSB8IHRoaXNbdCArIDFdIDw8IDggfCB0aGlzW3QgKyAyXSA8PCAxNiB8IHRoaXNbdCArIDNdIDw8IDI0OwogICAgICB9LCBjLnByb3RvdHlwZS5yZWFkSW50MzJCRSA9IGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgcmV0dXJuIGUgfHwgUCh0LCA0LCB0aGlzLmxlbmd0aCksIHRoaXNbdF0gPDwgMjQgfCB0aGlzW3QgKyAxXSA8PCAxNiB8IHRoaXNbdCArIDJdIDw8IDggfCB0aGlzW3QgKyAzXTsKICAgICAgfSwgYy5wcm90b3R5cGUucmVhZEZsb2F0TEUgPSBmdW5jdGlvbiAodCwgZSkgewogICAgICAgIHJldHVybiBlIHx8IFAodCwgNCwgdGhpcy5sZW5ndGgpLCBvLnJlYWQodGhpcywgdCwgITAsIDIzLCA0KTsKICAgICAgfSwgYy5wcm90b3R5cGUucmVhZEZsb2F0QkUgPSBmdW5jdGlvbiAodCwgZSkgewogICAgICAgIHJldHVybiBlIHx8IFAodCwgNCwgdGhpcy5sZW5ndGgpLCBvLnJlYWQodGhpcywgdCwgITEsIDIzLCA0KTsKICAgICAgfSwgYy5wcm90b3R5cGUucmVhZERvdWJsZUxFID0gZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgICByZXR1cm4gZSB8fCBQKHQsIDgsIHRoaXMubGVuZ3RoKSwgby5yZWFkKHRoaXMsIHQsICEwLCA1MiwgOCk7CiAgICAgIH0sIGMucHJvdG90eXBlLnJlYWREb3VibGVCRSA9IGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgICAgcmV0dXJuIGUgfHwgUCh0LCA4LCB0aGlzLmxlbmd0aCksIG8ucmVhZCh0aGlzLCB0LCAhMSwgNTIsIDgpOwogICAgICB9LCBjLnByb3RvdHlwZS53cml0ZVVJbnRMRSA9IGZ1bmN0aW9uICh0LCBlLCByLCBuKSB7CiAgICAgICAgKHQgPSArdCwgZSB8PSAwLCByIHw9IDAsIG4pIHx8IFQodGhpcywgdCwgZSwgciwgTWF0aC5wb3coMiwgOCAqIHIpIC0gMSwgMCk7CiAgICAgICAgdmFyIG8gPSAxLAogICAgICAgICAgICBpID0gMDsKCiAgICAgICAgZm9yICh0aGlzW2VdID0gMjU1ICYgdDsgKytpIDwgciAmJiAobyAqPSAyNTYpOykgewogICAgICAgICAgdGhpc1tlICsgaV0gPSB0IC8gbyAmIDI1NTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBlICsgcjsKICAgICAgfSwgYy5wcm90b3R5cGUud3JpdGVVSW50QkUgPSBmdW5jdGlvbiAodCwgZSwgciwgbikgewogICAgICAgICh0ID0gK3QsIGUgfD0gMCwgciB8PSAwLCBuKSB8fCBUKHRoaXMsIHQsIGUsIHIsIE1hdGgucG93KDIsIDggKiByKSAtIDEsIDApOwogICAgICAgIHZhciBvID0gciAtIDEsCiAgICAgICAgICAgIGkgPSAxOwoKICAgICAgICBmb3IgKHRoaXNbZSArIG9dID0gMjU1ICYgdDsgLS1vID49IDAgJiYgKGkgKj0gMjU2KTspIHsKICAgICAgICAgIHRoaXNbZSArIG9dID0gdCAvIGkgJiAyNTU7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZSArIHI7CiAgICAgIH0sIGMucHJvdG90eXBlLndyaXRlVUludDggPSBmdW5jdGlvbiAodCwgZSwgcikgewogICAgICAgIHJldHVybiB0ID0gK3QsIGUgfD0gMCwgciB8fCBUKHRoaXMsIHQsIGUsIDEsIDI1NSwgMCksIGMuVFlQRURfQVJSQVlfU1VQUE9SVCB8fCAodCA9IE1hdGguZmxvb3IodCkpLCB0aGlzW2VdID0gMjU1ICYgdCwgZSArIDE7CiAgICAgIH0sIGMucHJvdG90eXBlLndyaXRlVUludDE2TEUgPSBmdW5jdGlvbiAodCwgZSwgcikgewogICAgICAgIHJldHVybiB0ID0gK3QsIGUgfD0gMCwgciB8fCBUKHRoaXMsIHQsIGUsIDIsIDY1NTM1LCAwKSwgYy5UWVBFRF9BUlJBWV9TVVBQT1JUID8gKHRoaXNbZV0gPSAyNTUgJiB0LCB0aGlzW2UgKyAxXSA9IHQgPj4+IDgpIDogTih0aGlzLCB0LCBlLCAhMCksIGUgKyAyOwogICAgICB9LCBjLnByb3RvdHlwZS53cml0ZVVJbnQxNkJFID0gZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgICAgICByZXR1cm4gdCA9ICt0LCBlIHw9IDAsIHIgfHwgVCh0aGlzLCB0LCBlLCAyLCA2NTUzNSwgMCksIGMuVFlQRURfQVJSQVlfU1VQUE9SVCA/ICh0aGlzW2VdID0gdCA+Pj4gOCwgdGhpc1tlICsgMV0gPSAyNTUgJiB0KSA6IE4odGhpcywgdCwgZSwgITEpLCBlICsgMjsKICAgICAgfSwgYy5wcm90b3R5cGUud3JpdGVVSW50MzJMRSA9IGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICAgICAgcmV0dXJuIHQgPSArdCwgZSB8PSAwLCByIHx8IFQodGhpcywgdCwgZSwgNCwgNDI5NDk2NzI5NSwgMCksIGMuVFlQRURfQVJSQVlfU1VQUE9SVCA/ICh0aGlzW2UgKyAzXSA9IHQgPj4+IDI0LCB0aGlzW2UgKyAyXSA9IHQgPj4+IDE2LCB0aGlzW2UgKyAxXSA9IHQgPj4+IDgsIHRoaXNbZV0gPSAyNTUgJiB0KSA6IEwodGhpcywgdCwgZSwgITApLCBlICsgNDsKICAgICAgfSwgYy5wcm90b3R5cGUud3JpdGVVSW50MzJCRSA9IGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICAgICAgcmV0dXJuIHQgPSArdCwgZSB8PSAwLCByIHx8IFQodGhpcywgdCwgZSwgNCwgNDI5NDk2NzI5NSwgMCksIGMuVFlQRURfQVJSQVlfU1VQUE9SVCA/ICh0aGlzW2VdID0gdCA+Pj4gMjQsIHRoaXNbZSArIDFdID0gdCA+Pj4gMTYsIHRoaXNbZSArIDJdID0gdCA+Pj4gOCwgdGhpc1tlICsgM10gPSAyNTUgJiB0KSA6IEwodGhpcywgdCwgZSwgITEpLCBlICsgNDsKICAgICAgfSwgYy5wcm90b3R5cGUud3JpdGVJbnRMRSA9IGZ1bmN0aW9uICh0LCBlLCByLCBuKSB7CiAgICAgICAgaWYgKHQgPSArdCwgZSB8PSAwLCAhbikgewogICAgICAgICAgdmFyIG8gPSBNYXRoLnBvdygyLCA4ICogciAtIDEpOwogICAgICAgICAgVCh0aGlzLCB0LCBlLCByLCBvIC0gMSwgLW8pOwogICAgICAgIH0KCiAgICAgICAgdmFyIGkgPSAwLAogICAgICAgICAgICBzID0gMSwKICAgICAgICAgICAgYSA9IDA7CgogICAgICAgIGZvciAodGhpc1tlXSA9IDI1NSAmIHQ7ICsraSA8IHIgJiYgKHMgKj0gMjU2KTspIHsKICAgICAgICAgIHQgPCAwICYmIDAgPT09IGEgJiYgMCAhPT0gdGhpc1tlICsgaSAtIDFdICYmIChhID0gMSksIHRoaXNbZSArIGldID0gKHQgLyBzID4+IDApIC0gYSAmIDI1NTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBlICsgcjsKICAgICAgfSwgYy5wcm90b3R5cGUud3JpdGVJbnRCRSA9IGZ1bmN0aW9uICh0LCBlLCByLCBuKSB7CiAgICAgICAgaWYgKHQgPSArdCwgZSB8PSAwLCAhbikgewogICAgICAgICAgdmFyIG8gPSBNYXRoLnBvdygyLCA4ICogciAtIDEpOwogICAgICAgICAgVCh0aGlzLCB0LCBlLCByLCBvIC0gMSwgLW8pOwogICAgICAgIH0KCiAgICAgICAgdmFyIGkgPSByIC0gMSwKICAgICAgICAgICAgcyA9IDEsCiAgICAgICAgICAgIGEgPSAwOwoKICAgICAgICBmb3IgKHRoaXNbZSArIGldID0gMjU1ICYgdDsgLS1pID49IDAgJiYgKHMgKj0gMjU2KTspIHsKICAgICAgICAgIHQgPCAwICYmIDAgPT09IGEgJiYgMCAhPT0gdGhpc1tlICsgaSArIDFdICYmIChhID0gMSksIHRoaXNbZSArIGldID0gKHQgLyBzID4+IDApIC0gYSAmIDI1NTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBlICsgcjsKICAgICAgfSwgYy5wcm90b3R5cGUud3JpdGVJbnQ4ID0gZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgICAgICByZXR1cm4gdCA9ICt0LCBlIHw9IDAsIHIgfHwgVCh0aGlzLCB0LCBlLCAxLCAxMjcsIC0xMjgpLCBjLlRZUEVEX0FSUkFZX1NVUFBPUlQgfHwgKHQgPSBNYXRoLmZsb29yKHQpKSwgdCA8IDAgJiYgKHQgPSAyNTUgKyB0ICsgMSksIHRoaXNbZV0gPSAyNTUgJiB0LCBlICsgMTsKICAgICAgfSwgYy5wcm90b3R5cGUud3JpdGVJbnQxNkxFID0gZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgICAgICByZXR1cm4gdCA9ICt0LCBlIHw9IDAsIHIgfHwgVCh0aGlzLCB0LCBlLCAyLCAzMjc2NywgLTMyNzY4KSwgYy5UWVBFRF9BUlJBWV9TVVBQT1JUID8gKHRoaXNbZV0gPSAyNTUgJiB0LCB0aGlzW2UgKyAxXSA9IHQgPj4+IDgpIDogTih0aGlzLCB0LCBlLCAhMCksIGUgKyAyOwogICAgICB9LCBjLnByb3RvdHlwZS53cml0ZUludDE2QkUgPSBmdW5jdGlvbiAodCwgZSwgcikgewogICAgICAgIHJldHVybiB0ID0gK3QsIGUgfD0gMCwgciB8fCBUKHRoaXMsIHQsIGUsIDIsIDMyNzY3LCAtMzI3NjgpLCBjLlRZUEVEX0FSUkFZX1NVUFBPUlQgPyAodGhpc1tlXSA9IHQgPj4+IDgsIHRoaXNbZSArIDFdID0gMjU1ICYgdCkgOiBOKHRoaXMsIHQsIGUsICExKSwgZSArIDI7CiAgICAgIH0sIGMucHJvdG90eXBlLndyaXRlSW50MzJMRSA9IGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICAgICAgcmV0dXJuIHQgPSArdCwgZSB8PSAwLCByIHx8IFQodGhpcywgdCwgZSwgNCwgMjE0NzQ4MzY0NywgLTIxNDc0ODM2NDgpLCBjLlRZUEVEX0FSUkFZX1NVUFBPUlQgPyAodGhpc1tlXSA9IDI1NSAmIHQsIHRoaXNbZSArIDFdID0gdCA+Pj4gOCwgdGhpc1tlICsgMl0gPSB0ID4+PiAxNiwgdGhpc1tlICsgM10gPSB0ID4+PiAyNCkgOiBMKHRoaXMsIHQsIGUsICEwKSwgZSArIDQ7CiAgICAgIH0sIGMucHJvdG90eXBlLndyaXRlSW50MzJCRSA9IGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICAgICAgcmV0dXJuIHQgPSArdCwgZSB8PSAwLCByIHx8IFQodGhpcywgdCwgZSwgNCwgMjE0NzQ4MzY0NywgLTIxNDc0ODM2NDgpLCB0IDwgMCAmJiAodCA9IDQyOTQ5NjcyOTUgKyB0ICsgMSksIGMuVFlQRURfQVJSQVlfU1VQUE9SVCA/ICh0aGlzW2VdID0gdCA+Pj4gMjQsIHRoaXNbZSArIDFdID0gdCA+Pj4gMTYsIHRoaXNbZSArIDJdID0gdCA+Pj4gOCwgdGhpc1tlICsgM10gPSAyNTUgJiB0KSA6IEwodGhpcywgdCwgZSwgITEpLCBlICsgNDsKICAgICAgfSwgYy5wcm90b3R5cGUud3JpdGVGbG9hdExFID0gZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgICAgICByZXR1cm4gSSh0aGlzLCB0LCBlLCAhMCwgcik7CiAgICAgIH0sIGMucHJvdG90eXBlLndyaXRlRmxvYXRCRSA9IGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICAgICAgcmV0dXJuIEkodGhpcywgdCwgZSwgITEsIHIpOwogICAgICB9LCBjLnByb3RvdHlwZS53cml0ZURvdWJsZUxFID0gZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgICAgICByZXR1cm4gVSh0aGlzLCB0LCBlLCAhMCwgcik7CiAgICAgIH0sIGMucHJvdG90eXBlLndyaXRlRG91YmxlQkUgPSBmdW5jdGlvbiAodCwgZSwgcikgewogICAgICAgIHJldHVybiBVKHRoaXMsIHQsIGUsICExLCByKTsKICAgICAgfSwgYy5wcm90b3R5cGUuY29weSA9IGZ1bmN0aW9uICh0LCBlLCByLCBuKSB7CiAgICAgICAgaWYgKHIgfHwgKHIgPSAwKSwgbiB8fCAwID09PSBuIHx8IChuID0gdGhpcy5sZW5ndGgpLCBlID49IHQubGVuZ3RoICYmIChlID0gdC5sZW5ndGgpLCBlIHx8IChlID0gMCksIG4gPiAwICYmIG4gPCByICYmIChuID0gciksIG4gPT09IHIpIHJldHVybiAwOwogICAgICAgIGlmICgwID09PSB0Lmxlbmd0aCB8fCAwID09PSB0aGlzLmxlbmd0aCkgcmV0dXJuIDA7CiAgICAgICAgaWYgKGUgPCAwKSB0aHJvdyBuZXcgUmFuZ2VFcnJvcigidGFyZ2V0U3RhcnQgb3V0IG9mIGJvdW5kcyIpOwogICAgICAgIGlmIChyIDwgMCB8fCByID49IHRoaXMubGVuZ3RoKSB0aHJvdyBuZXcgUmFuZ2VFcnJvcigic291cmNlU3RhcnQgb3V0IG9mIGJvdW5kcyIpOwogICAgICAgIGlmIChuIDwgMCkgdGhyb3cgbmV3IFJhbmdlRXJyb3IoInNvdXJjZUVuZCBvdXQgb2YgYm91bmRzIik7CiAgICAgICAgbiA+IHRoaXMubGVuZ3RoICYmIChuID0gdGhpcy5sZW5ndGgpLCB0Lmxlbmd0aCAtIGUgPCBuIC0gciAmJiAobiA9IHQubGVuZ3RoIC0gZSArIHIpOwogICAgICAgIHZhciBvLAogICAgICAgICAgICBpID0gbiAtIHI7CiAgICAgICAgaWYgKHRoaXMgPT09IHQgJiYgciA8IGUgJiYgZSA8IG4pIGZvciAobyA9IGkgLSAxOyBvID49IDA7IC0tbykgewogICAgICAgICAgdFtvICsgZV0gPSB0aGlzW28gKyByXTsKICAgICAgICB9IGVsc2UgaWYgKGkgPCAxZTMgfHwgIWMuVFlQRURfQVJSQVlfU1VQUE9SVCkgZm9yIChvID0gMDsgbyA8IGk7ICsrbykgewogICAgICAgICAgdFtvICsgZV0gPSB0aGlzW28gKyByXTsKICAgICAgICB9IGVsc2UgVWludDhBcnJheS5wcm90b3R5cGUuc2V0LmNhbGwodCwgdGhpcy5zdWJhcnJheShyLCByICsgaSksIGUpOwogICAgICAgIHJldHVybiBpOwogICAgICB9LCBjLnByb3RvdHlwZS5maWxsID0gZnVuY3Rpb24gKHQsIGUsIHIsIG4pIHsKICAgICAgICBpZiAoInN0cmluZyIgPT0gdHlwZW9mIHQpIHsKICAgICAgICAgIGlmICgic3RyaW5nIiA9PSB0eXBlb2YgZSA/IChuID0gZSwgZSA9IDAsIHIgPSB0aGlzLmxlbmd0aCkgOiAic3RyaW5nIiA9PSB0eXBlb2YgciAmJiAobiA9IHIsIHIgPSB0aGlzLmxlbmd0aCksIDEgPT09IHQubGVuZ3RoKSB7CiAgICAgICAgICAgIHZhciBvID0gdC5jaGFyQ29kZUF0KDApOwogICAgICAgICAgICBvIDwgMjU2ICYmICh0ID0gbyk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHZvaWQgMCAhPT0gbiAmJiAic3RyaW5nIiAhPSB0eXBlb2YgbikgdGhyb3cgbmV3IFR5cGVFcnJvcigiZW5jb2RpbmcgbXVzdCBiZSBhIHN0cmluZyIpOwogICAgICAgICAgaWYgKCJzdHJpbmciID09IHR5cGVvZiBuICYmICFjLmlzRW5jb2RpbmcobikpIHRocm93IG5ldyBUeXBlRXJyb3IoIlVua25vd24gZW5jb2Rpbmc6ICIgKyBuKTsKICAgICAgICB9IGVsc2UgIm51bWJlciIgPT0gdHlwZW9mIHQgJiYgKHQgJj0gMjU1KTsKCiAgICAgICAgaWYgKGUgPCAwIHx8IHRoaXMubGVuZ3RoIDwgZSB8fCB0aGlzLmxlbmd0aCA8IHIpIHRocm93IG5ldyBSYW5nZUVycm9yKCJPdXQgb2YgcmFuZ2UgaW5kZXgiKTsKICAgICAgICBpZiAociA8PSBlKSByZXR1cm4gdGhpczsKICAgICAgICB2YXIgaTsKICAgICAgICBpZiAoZSA+Pj49IDAsIHIgPSB2b2lkIDAgPT09IHIgPyB0aGlzLmxlbmd0aCA6IHIgPj4+IDAsIHQgfHwgKHQgPSAwKSwgIm51bWJlciIgPT0gdHlwZW9mIHQpIGZvciAoaSA9IGU7IGkgPCByOyArK2kpIHsKICAgICAgICAgIHRoaXNbaV0gPSB0OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2YXIgcyA9IGMuaXNCdWZmZXIodCkgPyB0IDogcShuZXcgYyh0LCBuKS50b1N0cmluZygpKSwKICAgICAgICAgICAgICBhID0gcy5sZW5ndGg7CgogICAgICAgICAgZm9yIChpID0gMDsgaSA8IHIgLSBlOyArK2kpIHsKICAgICAgICAgICAgdGhpc1tpICsgZV0gPSBzW2kgJSBhXTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH07CiAgICAgIHZhciBNID0gL1teK1wvMC05QS1aYS16LV9dL2c7CgogICAgICBmdW5jdGlvbiBEKHQpIHsKICAgICAgICByZXR1cm4gdCA8IDE2ID8gIjAiICsgdC50b1N0cmluZygxNikgOiB0LnRvU3RyaW5nKDE2KTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gcSh0LCBlKSB7CiAgICAgICAgdmFyIHI7CiAgICAgICAgZSA9IGUgfHwgMSAvIDA7CgogICAgICAgIGZvciAodmFyIG4gPSB0Lmxlbmd0aCwgbyA9IG51bGwsIGkgPSBbXSwgcyA9IDA7IHMgPCBuOyArK3MpIHsKICAgICAgICAgIGlmICgociA9IHQuY2hhckNvZGVBdChzKSkgPiA1NTI5NSAmJiByIDwgNTczNDQpIHsKICAgICAgICAgICAgaWYgKCFvKSB7CiAgICAgICAgICAgICAgaWYgKHIgPiA1NjMxOSkgewogICAgICAgICAgICAgICAgKGUgLT0gMykgPiAtMSAmJiBpLnB1c2goMjM5LCAxOTEsIDE4OSk7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmIChzICsgMSA9PT0gbikgewogICAgICAgICAgICAgICAgKGUgLT0gMykgPiAtMSAmJiBpLnB1c2goMjM5LCAxOTEsIDE4OSk7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIG8gPSByOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAociA8IDU2MzIwKSB7CiAgICAgICAgICAgICAgKGUgLT0gMykgPiAtMSAmJiBpLnB1c2goMjM5LCAxOTEsIDE4OSksIG8gPSByOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICByID0gNjU1MzYgKyAobyAtIDU1Mjk2IDw8IDEwIHwgciAtIDU2MzIwKTsKICAgICAgICAgIH0gZWxzZSBvICYmIChlIC09IDMpID4gLTEgJiYgaS5wdXNoKDIzOSwgMTkxLCAxODkpOwoKICAgICAgICAgIGlmIChvID0gbnVsbCwgciA8IDEyOCkgewogICAgICAgICAgICBpZiAoKGUgLT0gMSkgPCAwKSBicmVhazsKICAgICAgICAgICAgaS5wdXNoKHIpOwogICAgICAgICAgfSBlbHNlIGlmIChyIDwgMjA0OCkgewogICAgICAgICAgICBpZiAoKGUgLT0gMikgPCAwKSBicmVhazsKICAgICAgICAgICAgaS5wdXNoKHIgPj4gNiB8IDE5MiwgNjMgJiByIHwgMTI4KTsKICAgICAgICAgIH0gZWxzZSBpZiAociA8IDY1NTM2KSB7CiAgICAgICAgICAgIGlmICgoZSAtPSAzKSA8IDApIGJyZWFrOwogICAgICAgICAgICBpLnB1c2gociA+PiAxMiB8IDIyNCwgciA+PiA2ICYgNjMgfCAxMjgsIDYzICYgciB8IDEyOCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoIShyIDwgMTExNDExMikpIHRocm93IG5ldyBFcnJvcigiSW52YWxpZCBjb2RlIHBvaW50Iik7CiAgICAgICAgICAgIGlmICgoZSAtPSA0KSA8IDApIGJyZWFrOwogICAgICAgICAgICBpLnB1c2gociA+PiAxOCB8IDI0MCwgciA+PiAxMiAmIDYzIHwgMTI4LCByID4+IDYgJiA2MyB8IDEyOCwgNjMgJiByIHwgMTI4KTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiBpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBZKHQpIHsKICAgICAgICByZXR1cm4gbi50b0J5dGVBcnJheShmdW5jdGlvbiAodCkgewogICAgICAgICAgaWYgKCh0ID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgcmV0dXJuIHQudHJpbSA/IHQudHJpbSgpIDogdC5yZXBsYWNlKC9eXHMrfFxzKyQvZywgIiIpOwogICAgICAgICAgfSh0KS5yZXBsYWNlKE0sICIiKSkubGVuZ3RoIDwgMikgcmV0dXJuICIiOwoKICAgICAgICAgIGZvciAoOyB0Lmxlbmd0aCAlIDQgIT0gMDspIHsKICAgICAgICAgICAgdCArPSAiPSI7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHQ7CiAgICAgICAgfSh0KSk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIEYodCwgZSwgciwgbikgewogICAgICAgIGZvciAodmFyIG8gPSAwOyBvIDwgbiAmJiAhKG8gKyByID49IGUubGVuZ3RoIHx8IG8gPj0gdC5sZW5ndGgpOyArK28pIHsKICAgICAgICAgIGVbbyArIHJdID0gdFtvXTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBvOwogICAgICB9CiAgICB9KS5jYWxsKHRoaXMsIHIoOSkpOwogIH0sIGZ1bmN0aW9uICh0LCBlKSB7CiAgICBlLmVuY29kZSA9IGZ1bmN0aW9uICh0KSB7CiAgICAgIHZhciBlID0gIiI7CgogICAgICBmb3IgKHZhciByIGluIHQpIHsKICAgICAgICB0Lmhhc093blByb3BlcnR5KHIpICYmIChlLmxlbmd0aCAmJiAoZSArPSAiJiIpLCBlICs9IGVuY29kZVVSSUNvbXBvbmVudChyKSArICI9IiArIGVuY29kZVVSSUNvbXBvbmVudCh0W3JdKSk7CiAgICAgIH0KCiAgICAgIHJldHVybiBlOwogICAgfSwgZS5kZWNvZGUgPSBmdW5jdGlvbiAodCkgewogICAgICBmb3IgKHZhciBlID0ge30sIHIgPSB0LnNwbGl0KCImIiksIG4gPSAwLCBvID0gci5sZW5ndGg7IG4gPCBvOyBuKyspIHsKICAgICAgICB2YXIgaSA9IHJbbl0uc3BsaXQoIj0iKTsKICAgICAgICBlW2RlY29kZVVSSUNvbXBvbmVudChpWzBdKV0gPSBkZWNvZGVVUklDb21wb25lbnQoaVsxXSk7CiAgICAgIH0KCiAgICAgIHJldHVybiBlOwogICAgfTsKICB9LCBmdW5jdGlvbiAodCwgZSkgewogICAgdmFyIHIgPSAvXig/Oig/IVteOkBdKzpbXjpAXC9dKkApKGh0dHB8aHR0cHN8d3N8d3NzKTpcL1wvKT8oKD86KChbXjpAXSopKD86OihbXjpAXSopKT8pP0ApPygoPzpbYS1mMC05XXswLDR9Oil7Miw3fVthLWYwLTldezAsNH18W146XC8/I10qKSg/OjooXGQqKSk/KSgoKFwvKD86W14/I10oPyFbXj8jXC9dKlwuW14/I1wvLl0rKD86Wz8jXXwkKSkpKlwvPyk/KFtePyNcL10qKSkoPzpcPyhbXiNdKikpPyg/OiMoLiopKT8pLywKICAgICAgICBuID0gWyJzb3VyY2UiLCAicHJvdG9jb2wiLCAiYXV0aG9yaXR5IiwgInVzZXJJbmZvIiwgInVzZXIiLCAicGFzc3dvcmQiLCAiaG9zdCIsICJwb3J0IiwgInJlbGF0aXZlIiwgInBhdGgiLCAiZGlyZWN0b3J5IiwgImZpbGUiLCAicXVlcnkiLCAiYW5jaG9yIl07CgogICAgdC5leHBvcnRzID0gZnVuY3Rpb24gKHQpIHsKICAgICAgdmFyIGUgPSB0LAogICAgICAgICAgbyA9IHQuaW5kZXhPZigiWyIpLAogICAgICAgICAgaSA9IHQuaW5kZXhPZigiXSIpOwogICAgICAtMSAhPSBvICYmIC0xICE9IGkgJiYgKHQgPSB0LnN1YnN0cmluZygwLCBvKSArIHQuc3Vic3RyaW5nKG8sIGkpLnJlcGxhY2UoLzovZywgIjsiKSArIHQuc3Vic3RyaW5nKGksIHQubGVuZ3RoKSk7CgogICAgICBmb3IgKHZhciBzID0gci5leGVjKHQgfHwgIiIpLCBhID0ge30sIGMgPSAxNDsgYy0tOykgewogICAgICAgIGFbbltjXV0gPSBzW2NdIHx8ICIiOwogICAgICB9CgogICAgICByZXR1cm4gLTEgIT0gbyAmJiAtMSAhPSBpICYmIChhLnNvdXJjZSA9IGUsIGEuaG9zdCA9IGEuaG9zdC5zdWJzdHJpbmcoMSwgYS5ob3N0Lmxlbmd0aCAtIDEpLnJlcGxhY2UoLzsvZywgIjoiKSwgYS5hdXRob3JpdHkgPSBhLmF1dGhvcml0eS5yZXBsYWNlKCJbIiwgIiIpLnJlcGxhY2UoIl0iLCAiIikucmVwbGFjZSgvOy9nLCAiOiIpLCBhLmlwdjZ1cmkgPSAhMCksIGE7CiAgICB9OwogIH0sIGZ1bmN0aW9uICh0LCBlKSB7CiAgICB2YXIgciA9IHt9LnRvU3RyaW5nOwoKICAgIHQuZXhwb3J0cyA9IEFycmF5LmlzQXJyYXkgfHwgZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuICJbb2JqZWN0IEFycmF5XSIgPT0gci5jYWxsKHQpOwogICAgfTsKICB9LCBmdW5jdGlvbiAodCwgZSwgcikgewogICAgKGZ1bmN0aW9uIChlKSB7CiAgICAgIHQuZXhwb3J0cyA9IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgcmV0dXJuIHIgJiYgZS5pc0J1ZmZlcih0KSB8fCBuICYmICh0IGluc3RhbmNlb2YgQXJyYXlCdWZmZXIgfHwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgIHJldHVybiAiZnVuY3Rpb24iID09IHR5cGVvZiBBcnJheUJ1ZmZlci5pc1ZpZXcgPyBBcnJheUJ1ZmZlci5pc1ZpZXcodCkgOiB0LmJ1ZmZlciBpbnN0YW5jZW9mIEFycmF5QnVmZmVyOwogICAgICAgIH0odCkpOwogICAgICB9OwoKICAgICAgdmFyIHIgPSAiZnVuY3Rpb24iID09IHR5cGVvZiBlICYmICJmdW5jdGlvbiIgPT0gdHlwZW9mIGUuaXNCdWZmZXIsCiAgICAgICAgICBuID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgQXJyYXlCdWZmZXI7CiAgICB9KS5jYWxsKHRoaXMsIHIoNCkuQnVmZmVyKTsKICB9LCBmdW5jdGlvbiAodCwgZSkgewogICAgdmFyIHI7CgogICAgciA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9KCk7CgogICAgdHJ5IHsKICAgICAgciA9IHIgfHwgbmV3IEZ1bmN0aW9uKCJyZXR1cm4gdGhpcyIpKCk7CiAgICB9IGNhdGNoICh0KSB7CiAgICAgICJvYmplY3QiID09ICh0eXBlb2Ygd2luZG93ID09PSAidW5kZWZpbmVkIiA/ICJ1bmRlZmluZWQiIDogX3R5cGVvZih3aW5kb3cpKSAmJiAociA9IHdpbmRvdyk7CiAgICB9CgogICAgdC5leHBvcnRzID0gcjsKICB9LCBmdW5jdGlvbiAodCwgZSwgcikgewogICAgdmFyIG4gPSByKDI1KSwKICAgICAgICBvID0gcigxNSksCiAgICAgICAgaSA9IHIoMSksCiAgICAgICAgcyA9IHIoMyksCiAgICAgICAgYSA9IHIoMTYpLAogICAgICAgIGMgPSByKDE3KSwKICAgICAgICBoID0gcigwKSgic29ja2V0LmlvLWNsaWVudDptYW5hZ2VyIiksCiAgICAgICAgdSA9IHIoMTQpLAogICAgICAgIGYgPSByKDQ5KSwKICAgICAgICBwID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eTsKCiAgICBmdW5jdGlvbiBsKHQsIGUpIHsKICAgICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIGwpKSByZXR1cm4gbmV3IGwodCwgZSk7CiAgICAgIHQgJiYgIm9iamVjdCIgPT0gX3R5cGVvZih0KSAmJiAoZSA9IHQsIHQgPSB2b2lkIDApLCAoZSA9IGUgfHwge30pLnBhdGggPSBlLnBhdGggfHwgIi9zb2NrZXQuaW8iLCB0aGlzLm5zcHMgPSB7fSwgdGhpcy5zdWJzID0gW10sIHRoaXMub3B0cyA9IGUsIHRoaXMucmVjb25uZWN0aW9uKCExICE9PSBlLnJlY29ubmVjdGlvbiksIHRoaXMucmVjb25uZWN0aW9uQXR0ZW1wdHMoZS5yZWNvbm5lY3Rpb25BdHRlbXB0cyB8fCAxIC8gMCksIHRoaXMucmVjb25uZWN0aW9uRGVsYXkoZS5yZWNvbm5lY3Rpb25EZWxheSB8fCAxZTMpLCB0aGlzLnJlY29ubmVjdGlvbkRlbGF5TWF4KGUucmVjb25uZWN0aW9uRGVsYXlNYXggfHwgNWUzKSwgdGhpcy5yYW5kb21pemF0aW9uRmFjdG9yKGUucmFuZG9taXphdGlvbkZhY3RvciB8fCAuNSksIHRoaXMuYmFja29mZiA9IG5ldyBmKHsKICAgICAgICBtaW46IHRoaXMucmVjb25uZWN0aW9uRGVsYXkoKSwKICAgICAgICBtYXg6IHRoaXMucmVjb25uZWN0aW9uRGVsYXlNYXgoKSwKICAgICAgICBqaXR0ZXI6IHRoaXMucmFuZG9taXphdGlvbkZhY3RvcigpCiAgICAgIH0pLCB0aGlzLnRpbWVvdXQobnVsbCA9PSBlLnRpbWVvdXQgPyAyZTQgOiBlLnRpbWVvdXQpLCB0aGlzLnJlYWR5U3RhdGUgPSAiY2xvc2VkIiwgdGhpcy51cmkgPSB0LCB0aGlzLmNvbm5lY3RpbmcgPSBbXSwgdGhpcy5sYXN0UGluZyA9IG51bGwsIHRoaXMuZW5jb2RpbmcgPSAhMSwgdGhpcy5wYWNrZXRCdWZmZXIgPSBbXTsKICAgICAgdmFyIHIgPSBlLnBhcnNlciB8fCBzOwogICAgICB0aGlzLmVuY29kZXIgPSBuZXcgci5FbmNvZGVyKCksIHRoaXMuZGVjb2RlciA9IG5ldyByLkRlY29kZXIoKSwgdGhpcy5hdXRvQ29ubmVjdCA9ICExICE9PSBlLmF1dG9Db25uZWN0LCB0aGlzLmF1dG9Db25uZWN0ICYmIHRoaXMub3BlbigpOwogICAgfQoKICAgIHQuZXhwb3J0cyA9IGwsIGwucHJvdG90eXBlLmVtaXRBbGwgPSBmdW5jdGlvbiAoKSB7CiAgICAgIGZvciAodmFyIHQgaW4gdGhpcy5lbWl0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyksIHRoaXMubnNwcykgewogICAgICAgIHAuY2FsbCh0aGlzLm5zcHMsIHQpICYmIHRoaXMubnNwc1t0XS5lbWl0LmFwcGx5KHRoaXMubnNwc1t0XSwgYXJndW1lbnRzKTsKICAgICAgfQogICAgfSwgbC5wcm90b3R5cGUudXBkYXRlU29ja2V0SWRzID0gZnVuY3Rpb24gKCkgewogICAgICBmb3IgKHZhciB0IGluIHRoaXMubnNwcykgewogICAgICAgIHAuY2FsbCh0aGlzLm5zcHMsIHQpICYmICh0aGlzLm5zcHNbdF0uaWQgPSB0aGlzLmdlbmVyYXRlSWQodCkpOwogICAgICB9CiAgICB9LCBsLnByb3RvdHlwZS5nZW5lcmF0ZUlkID0gZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuICgiLyIgPT09IHQgPyAiIiA6IHQgKyAiIyIpICsgdGhpcy5lbmdpbmUuaWQ7CiAgICB9LCBpKGwucHJvdG90eXBlKSwgbC5wcm90b3R5cGUucmVjb25uZWN0aW9uID0gZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAodGhpcy5fcmVjb25uZWN0aW9uID0gISF0LCB0aGlzKSA6IHRoaXMuX3JlY29ubmVjdGlvbjsKICAgIH0sIGwucHJvdG90eXBlLnJlY29ubmVjdGlvbkF0dGVtcHRzID0gZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAodGhpcy5fcmVjb25uZWN0aW9uQXR0ZW1wdHMgPSB0LCB0aGlzKSA6IHRoaXMuX3JlY29ubmVjdGlvbkF0dGVtcHRzOwogICAgfSwgbC5wcm90b3R5cGUucmVjb25uZWN0aW9uRGVsYXkgPSBmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/ICh0aGlzLl9yZWNvbm5lY3Rpb25EZWxheSA9IHQsIHRoaXMuYmFja29mZiAmJiB0aGlzLmJhY2tvZmYuc2V0TWluKHQpLCB0aGlzKSA6IHRoaXMuX3JlY29ubmVjdGlvbkRlbGF5OwogICAgfSwgbC5wcm90b3R5cGUucmFuZG9taXphdGlvbkZhY3RvciA9IGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHRoaXMuX3JhbmRvbWl6YXRpb25GYWN0b3IgPSB0LCB0aGlzLmJhY2tvZmYgJiYgdGhpcy5iYWNrb2ZmLnNldEppdHRlcih0KSwgdGhpcykgOiB0aGlzLl9yYW5kb21pemF0aW9uRmFjdG9yOwogICAgfSwgbC5wcm90b3R5cGUucmVjb25uZWN0aW9uRGVsYXlNYXggPSBmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/ICh0aGlzLl9yZWNvbm5lY3Rpb25EZWxheU1heCA9IHQsIHRoaXMuYmFja29mZiAmJiB0aGlzLmJhY2tvZmYuc2V0TWF4KHQpLCB0aGlzKSA6IHRoaXMuX3JlY29ubmVjdGlvbkRlbGF5TWF4OwogICAgfSwgbC5wcm90b3R5cGUudGltZW91dCA9IGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHRoaXMuX3RpbWVvdXQgPSB0LCB0aGlzKSA6IHRoaXMuX3RpbWVvdXQ7CiAgICB9LCBsLnByb3RvdHlwZS5tYXliZVJlY29ubmVjdE9uT3BlbiA9IGZ1bmN0aW9uICgpIHsKICAgICAgIXRoaXMucmVjb25uZWN0aW5nICYmIHRoaXMuX3JlY29ubmVjdGlvbiAmJiAwID09PSB0aGlzLmJhY2tvZmYuYXR0ZW1wdHMgJiYgdGhpcy5yZWNvbm5lY3QoKTsKICAgIH0sIGwucHJvdG90eXBlLm9wZW4gPSBsLnByb3RvdHlwZS5jb25uZWN0ID0gZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgaWYgKGgoInJlYWR5U3RhdGUgJXMiLCB0aGlzLnJlYWR5U3RhdGUpLCB+dGhpcy5yZWFkeVN0YXRlLmluZGV4T2YoIm9wZW4iKSkgcmV0dXJuIHRoaXM7CiAgICAgIGgoIm9wZW5pbmcgJXMiLCB0aGlzLnVyaSksIHRoaXMuZW5naW5lID0gbih0aGlzLnVyaSwgdGhpcy5vcHRzKTsKICAgICAgdmFyIHIgPSB0aGlzLmVuZ2luZSwKICAgICAgICAgIG8gPSB0aGlzOwogICAgICB0aGlzLnJlYWR5U3RhdGUgPSAib3BlbmluZyIsIHRoaXMuc2tpcFJlY29ubmVjdCA9ICExOwogICAgICB2YXIgaSA9IGEociwgIm9wZW4iLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgby5vbm9wZW4oKSwgdCAmJiB0KCk7CiAgICAgIH0pLAogICAgICAgICAgcyA9IGEociwgImVycm9yIiwgZnVuY3Rpb24gKGUpIHsKICAgICAgICBpZiAoaCgiY29ubmVjdF9lcnJvciIpLCBvLmNsZWFudXAoKSwgby5yZWFkeVN0YXRlID0gImNsb3NlZCIsIG8uZW1pdEFsbCgiY29ubmVjdF9lcnJvciIsIGUpLCB0KSB7CiAgICAgICAgICB2YXIgciA9IG5ldyBFcnJvcigiQ29ubmVjdGlvbiBlcnJvciIpOwogICAgICAgICAgci5kYXRhID0gZSwgdChyKTsKICAgICAgICB9IGVsc2Ugby5tYXliZVJlY29ubmVjdE9uT3BlbigpOwogICAgICB9KTsKCiAgICAgIGlmICghMSAhPT0gdGhpcy5fdGltZW91dCkgewogICAgICAgIHZhciBjID0gdGhpcy5fdGltZW91dDsKICAgICAgICBoKCJjb25uZWN0IGF0dGVtcHQgd2lsbCB0aW1lb3V0IGFmdGVyICVkIiwgYyk7CiAgICAgICAgdmFyIHUgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGgoImNvbm5lY3QgYXR0ZW1wdCB0aW1lZCBvdXQgYWZ0ZXIgJWQiLCBjKSwgaS5kZXN0cm95KCksIHIuY2xvc2UoKSwgci5lbWl0KCJlcnJvciIsICJ0aW1lb3V0IiksIG8uZW1pdEFsbCgiY29ubmVjdF90aW1lb3V0IiwgYyk7CiAgICAgICAgfSwgYyk7CiAgICAgICAgdGhpcy5zdWJzLnB1c2goewogICAgICAgICAgZGVzdHJveTogZnVuY3Rpb24gZGVzdHJveSgpIHsKICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHUpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CgogICAgICByZXR1cm4gdGhpcy5zdWJzLnB1c2goaSksIHRoaXMuc3Vicy5wdXNoKHMpLCB0aGlzOwogICAgfSwgbC5wcm90b3R5cGUub25vcGVuID0gZnVuY3Rpb24gKCkgewogICAgICBoKCJvcGVuIiksIHRoaXMuY2xlYW51cCgpLCB0aGlzLnJlYWR5U3RhdGUgPSAib3BlbiIsIHRoaXMuZW1pdCgib3BlbiIpOwogICAgICB2YXIgdCA9IHRoaXMuZW5naW5lOwogICAgICB0aGlzLnN1YnMucHVzaChhKHQsICJkYXRhIiwgYyh0aGlzLCAib25kYXRhIikpKSwgdGhpcy5zdWJzLnB1c2goYSh0LCAicGluZyIsIGModGhpcywgIm9ucGluZyIpKSksIHRoaXMuc3Vicy5wdXNoKGEodCwgInBvbmciLCBjKHRoaXMsICJvbnBvbmciKSkpLCB0aGlzLnN1YnMucHVzaChhKHQsICJlcnJvciIsIGModGhpcywgIm9uZXJyb3IiKSkpLCB0aGlzLnN1YnMucHVzaChhKHQsICJjbG9zZSIsIGModGhpcywgIm9uY2xvc2UiKSkpLCB0aGlzLnN1YnMucHVzaChhKHRoaXMuZGVjb2RlciwgImRlY29kZWQiLCBjKHRoaXMsICJvbmRlY29kZWQiKSkpOwogICAgfSwgbC5wcm90b3R5cGUub25waW5nID0gZnVuY3Rpb24gKCkgewogICAgICB0aGlzLmxhc3RQaW5nID0gbmV3IERhdGUoKSwgdGhpcy5lbWl0QWxsKCJwaW5nIik7CiAgICB9LCBsLnByb3RvdHlwZS5vbnBvbmcgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHRoaXMuZW1pdEFsbCgicG9uZyIsIG5ldyBEYXRlKCkgLSB0aGlzLmxhc3RQaW5nKTsKICAgIH0sIGwucHJvdG90eXBlLm9uZGF0YSA9IGZ1bmN0aW9uICh0KSB7CiAgICAgIHRoaXMuZGVjb2Rlci5hZGQodCk7CiAgICB9LCBsLnByb3RvdHlwZS5vbmRlY29kZWQgPSBmdW5jdGlvbiAodCkgewogICAgICB0aGlzLmVtaXQoInBhY2tldCIsIHQpOwogICAgfSwgbC5wcm90b3R5cGUub25lcnJvciA9IGZ1bmN0aW9uICh0KSB7CiAgICAgIGgoImVycm9yIiwgdCksIHRoaXMuZW1pdEFsbCgiZXJyb3IiLCB0KTsKICAgIH0sIGwucHJvdG90eXBlLnNvY2tldCA9IGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgIHZhciByID0gdGhpcy5uc3BzW3RdOwoKICAgICAgaWYgKCFyKSB7CiAgICAgICAgciA9IG5ldyBvKHRoaXMsIHQsIGUpLCB0aGlzLm5zcHNbdF0gPSByOwogICAgICAgIHZhciBuID0gdGhpczsKICAgICAgICByLm9uKCJjb25uZWN0aW5nIiwgaSksIHIub24oImNvbm5lY3QiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICByLmlkID0gbi5nZW5lcmF0ZUlkKHQpOwogICAgICAgIH0pLCB0aGlzLmF1dG9Db25uZWN0ICYmIGkoKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gaSgpIHsKICAgICAgICB+dShuLmNvbm5lY3RpbmcsIHIpIHx8IG4uY29ubmVjdGluZy5wdXNoKHIpOwogICAgICB9CgogICAgICByZXR1cm4gcjsKICAgIH0sIGwucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAodCkgewogICAgICB2YXIgZSA9IHUodGhpcy5jb25uZWN0aW5nLCB0KTsKICAgICAgfmUgJiYgdGhpcy5jb25uZWN0aW5nLnNwbGljZShlLCAxKSwgdGhpcy5jb25uZWN0aW5nLmxlbmd0aCB8fCB0aGlzLmNsb3NlKCk7CiAgICB9LCBsLnByb3RvdHlwZS5wYWNrZXQgPSBmdW5jdGlvbiAodCkgewogICAgICBoKCJ3cml0aW5nIHBhY2tldCAlaiIsIHQpOwogICAgICB2YXIgZSA9IHRoaXM7CiAgICAgIHQucXVlcnkgJiYgMCA9PT0gdC50eXBlICYmICh0Lm5zcCArPSAiPyIgKyB0LnF1ZXJ5KSwgZS5lbmNvZGluZyA/IGUucGFja2V0QnVmZmVyLnB1c2godCkgOiAoZS5lbmNvZGluZyA9ICEwLCB0aGlzLmVuY29kZXIuZW5jb2RlKHQsIGZ1bmN0aW9uIChyKSB7CiAgICAgICAgZm9yICh2YXIgbiA9IDA7IG4gPCByLmxlbmd0aDsgbisrKSB7CiAgICAgICAgICBlLmVuZ2luZS53cml0ZShyW25dLCB0Lm9wdGlvbnMpOwogICAgICAgIH0KCiAgICAgICAgZS5lbmNvZGluZyA9ICExLCBlLnByb2Nlc3NQYWNrZXRRdWV1ZSgpOwogICAgICB9KSk7CiAgICB9LCBsLnByb3RvdHlwZS5wcm9jZXNzUGFja2V0UXVldWUgPSBmdW5jdGlvbiAoKSB7CiAgICAgIGlmICh0aGlzLnBhY2tldEJ1ZmZlci5sZW5ndGggPiAwICYmICF0aGlzLmVuY29kaW5nKSB7CiAgICAgICAgdmFyIHQgPSB0aGlzLnBhY2tldEJ1ZmZlci5zaGlmdCgpOwogICAgICAgIHRoaXMucGFja2V0KHQpOwogICAgICB9CiAgICB9LCBsLnByb3RvdHlwZS5jbGVhbnVwID0gZnVuY3Rpb24gKCkgewogICAgICBoKCJjbGVhbnVwIik7CgogICAgICBmb3IgKHZhciB0ID0gdGhpcy5zdWJzLmxlbmd0aCwgZSA9IDA7IGUgPCB0OyBlKyspIHsKICAgICAgICB0aGlzLnN1YnMuc2hpZnQoKS5kZXN0cm95KCk7CiAgICAgIH0KCiAgICAgIHRoaXMucGFja2V0QnVmZmVyID0gW10sIHRoaXMuZW5jb2RpbmcgPSAhMSwgdGhpcy5sYXN0UGluZyA9IG51bGwsIHRoaXMuZGVjb2Rlci5kZXN0cm95KCk7CiAgICB9LCBsLnByb3RvdHlwZS5jbG9zZSA9IGwucHJvdG90eXBlLmRpc2Nvbm5lY3QgPSBmdW5jdGlvbiAoKSB7CiAgICAgIGgoImRpc2Nvbm5lY3QiKSwgdGhpcy5za2lwUmVjb25uZWN0ID0gITAsIHRoaXMucmVjb25uZWN0aW5nID0gITEsICJvcGVuaW5nIiA9PT0gdGhpcy5yZWFkeVN0YXRlICYmIHRoaXMuY2xlYW51cCgpLCB0aGlzLmJhY2tvZmYucmVzZXQoKSwgdGhpcy5yZWFkeVN0YXRlID0gImNsb3NlZCIsIHRoaXMuZW5naW5lICYmIHRoaXMuZW5naW5lLmNsb3NlKCk7CiAgICB9LCBsLnByb3RvdHlwZS5vbmNsb3NlID0gZnVuY3Rpb24gKHQpIHsKICAgICAgaCgib25jbG9zZSIpLCB0aGlzLmNsZWFudXAoKSwgdGhpcy5iYWNrb2ZmLnJlc2V0KCksIHRoaXMucmVhZHlTdGF0ZSA9ICJjbG9zZWQiLCB0aGlzLmVtaXQoImNsb3NlIiwgdCksIHRoaXMuX3JlY29ubmVjdGlvbiAmJiAhdGhpcy5za2lwUmVjb25uZWN0ICYmIHRoaXMucmVjb25uZWN0KCk7CiAgICB9LCBsLnByb3RvdHlwZS5yZWNvbm5lY3QgPSBmdW5jdGlvbiAoKSB7CiAgICAgIGlmICh0aGlzLnJlY29ubmVjdGluZyB8fCB0aGlzLnNraXBSZWNvbm5lY3QpIHJldHVybiB0aGlzOwogICAgICB2YXIgdCA9IHRoaXM7CiAgICAgIGlmICh0aGlzLmJhY2tvZmYuYXR0ZW1wdHMgPj0gdGhpcy5fcmVjb25uZWN0aW9uQXR0ZW1wdHMpIGgoInJlY29ubmVjdCBmYWlsZWQiKSwgdGhpcy5iYWNrb2ZmLnJlc2V0KCksIHRoaXMuZW1pdEFsbCgicmVjb25uZWN0X2ZhaWxlZCIpLCB0aGlzLnJlY29ubmVjdGluZyA9ICExO2Vsc2UgewogICAgICAgIHZhciBlID0gdGhpcy5iYWNrb2ZmLmR1cmF0aW9uKCk7CiAgICAgICAgaCgid2lsbCB3YWl0ICVkbXMgYmVmb3JlIHJlY29ubmVjdCBhdHRlbXB0IiwgZSksIHRoaXMucmVjb25uZWN0aW5nID0gITA7CiAgICAgICAgdmFyIHIgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHQuc2tpcFJlY29ubmVjdCB8fCAoaCgiYXR0ZW1wdGluZyByZWNvbm5lY3QiKSwgdC5lbWl0QWxsKCJyZWNvbm5lY3RfYXR0ZW1wdCIsIHQuYmFja29mZi5hdHRlbXB0cyksIHQuZW1pdEFsbCgicmVjb25uZWN0aW5nIiwgdC5iYWNrb2ZmLmF0dGVtcHRzKSwgdC5za2lwUmVjb25uZWN0IHx8IHQub3BlbihmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBlID8gKGgoInJlY29ubmVjdCBhdHRlbXB0IGVycm9yIiksIHQucmVjb25uZWN0aW5nID0gITEsIHQucmVjb25uZWN0KCksIHQuZW1pdEFsbCgicmVjb25uZWN0X2Vycm9yIiwgZS5kYXRhKSkgOiAoaCgicmVjb25uZWN0IHN1Y2Nlc3MiKSwgdC5vbnJlY29ubmVjdCgpKTsKICAgICAgICAgIH0pKTsKICAgICAgICB9LCBlKTsKICAgICAgICB0aGlzLnN1YnMucHVzaCh7CiAgICAgICAgICBkZXN0cm95OiBmdW5jdGlvbiBkZXN0cm95KCkgewogICAgICAgICAgICBjbGVhclRpbWVvdXQocik7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sIGwucHJvdG90eXBlLm9ucmVjb25uZWN0ID0gZnVuY3Rpb24gKCkgewogICAgICB2YXIgdCA9IHRoaXMuYmFja29mZi5hdHRlbXB0czsKICAgICAgdGhpcy5yZWNvbm5lY3RpbmcgPSAhMSwgdGhpcy5iYWNrb2ZmLnJlc2V0KCksIHRoaXMudXBkYXRlU29ja2V0SWRzKCksIHRoaXMuZW1pdEFsbCgicmVjb25uZWN0IiwgdCk7CiAgICB9OwogIH0sIGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICB2YXIgbiA9IHIoMjcpOwogICAgZS53ZWJzb2NrZXQgPSBuOwogIH0sIGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICB2YXIgbiA9IHIoMiksCiAgICAgICAgbyA9IHIoMSk7CgogICAgZnVuY3Rpb24gaSh0KSB7CiAgICAgIHRoaXMucGF0aCA9IHQucGF0aCwgdGhpcy5ob3N0bmFtZSA9IHQuaG9zdG5hbWUsIHRoaXMucG9ydCA9IHQucG9ydCwgdGhpcy5zZWN1cmUgPSB0LnNlY3VyZSwgdGhpcy5xdWVyeSA9IHQucXVlcnksIHRoaXMudGltZXN0YW1wUGFyYW0gPSB0LnRpbWVzdGFtcFBhcmFtLCB0aGlzLnRpbWVzdGFtcFJlcXVlc3RzID0gdC50aW1lc3RhbXBSZXF1ZXN0cywgdGhpcy5yZWFkeVN0YXRlID0gIiIsIHRoaXMuYWdlbnQgPSB0LmFnZW50IHx8ICExLCB0aGlzLnNvY2tldCA9IHQuc29ja2V0LCB0aGlzLmVuYWJsZXNYRFIgPSB0LmVuYWJsZXNYRFIsIHRoaXMud2l0aENyZWRlbnRpYWxzID0gdC53aXRoQ3JlZGVudGlhbHMsIHRoaXMucGZ4ID0gdC5wZngsIHRoaXMua2V5ID0gdC5rZXksIHRoaXMucGFzc3BocmFzZSA9IHQucGFzc3BocmFzZSwgdGhpcy5jZXJ0ID0gdC5jZXJ0LCB0aGlzLmNhID0gdC5jYSwgdGhpcy5jaXBoZXJzID0gdC5jaXBoZXJzLCB0aGlzLnJlamVjdFVuYXV0aG9yaXplZCA9IHQucmVqZWN0VW5hdXRob3JpemVkLCB0aGlzLmZvcmNlTm9kZSA9IHQuZm9yY2VOb2RlLCB0aGlzLmlzUmVhY3ROYXRpdmUgPSB0LmlzUmVhY3ROYXRpdmUsIHRoaXMuZXh0cmFIZWFkZXJzID0gdC5leHRyYUhlYWRlcnMsIHRoaXMubG9jYWxBZGRyZXNzID0gdC5sb2NhbEFkZHJlc3M7CiAgICB9CgogICAgdC5leHBvcnRzID0gaSwgbyhpLnByb3RvdHlwZSksIGkucHJvdG90eXBlLm9uRXJyb3IgPSBmdW5jdGlvbiAodCwgZSkgewogICAgICB2YXIgciA9IG5ldyBFcnJvcih0KTsKICAgICAgcmV0dXJuIHIudHlwZSA9ICJUcmFuc3BvcnRFcnJvciIsIHIuZGVzY3JpcHRpb24gPSBlLCB0aGlzLmVtaXQoImVycm9yIiwgciksIHRoaXM7CiAgICB9LCBpLnByb3RvdHlwZS5vcGVuID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gImNsb3NlZCIgIT09IHRoaXMucmVhZHlTdGF0ZSAmJiAiIiAhPT0gdGhpcy5yZWFkeVN0YXRlIHx8ICh0aGlzLnJlYWR5U3RhdGUgPSAib3BlbmluZyIsIHRoaXMuZG9PcGVuKCkpLCB0aGlzOwogICAgfSwgaS5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiAib3BlbmluZyIgIT09IHRoaXMucmVhZHlTdGF0ZSAmJiAib3BlbiIgIT09IHRoaXMucmVhZHlTdGF0ZSB8fCAodGhpcy5kb0Nsb3NlKCksIHRoaXMub25DbG9zZSgpKSwgdGhpczsKICAgIH0sIGkucHJvdG90eXBlLnNlbmQgPSBmdW5jdGlvbiAodCkgewogICAgICBpZiAoIm9wZW4iICE9PSB0aGlzLnJlYWR5U3RhdGUpIHRocm93IG5ldyBFcnJvcigiVHJhbnNwb3J0IG5vdCBvcGVuIik7CiAgICAgIHRoaXMud3JpdGUodCk7CiAgICB9LCBpLnByb3RvdHlwZS5vbk9wZW4gPSBmdW5jdGlvbiAoKSB7CiAgICAgIHRoaXMucmVhZHlTdGF0ZSA9ICJvcGVuIiwgdGhpcy53cml0YWJsZSA9ICEwLCB0aGlzLmVtaXQoIm9wZW4iKTsKICAgIH0sIGkucHJvdG90eXBlLm9uRGF0YSA9IGZ1bmN0aW9uICh0KSB7CiAgICAgIHZhciBlID0gbi5kZWNvZGVQYWNrZXQodCwgdGhpcy5zb2NrZXQuYmluYXJ5VHlwZSk7CiAgICAgIHRoaXMub25QYWNrZXQoZSk7CiAgICB9LCBpLnByb3RvdHlwZS5vblBhY2tldCA9IGZ1bmN0aW9uICh0KSB7CiAgICAgIHRoaXMuZW1pdCgicGFja2V0IiwgdCk7CiAgICB9LCBpLnByb3RvdHlwZS5vbkNsb3NlID0gZnVuY3Rpb24gKCkgewogICAgICB0aGlzLnJlYWR5U3RhdGUgPSAiY2xvc2VkIiwgdGhpcy5lbWl0KCJjbG9zZSIpOwogICAgfTsKICB9LCBmdW5jdGlvbiAodCwgZSwgcikgewogICAgKGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciBuID0gcigyOSksCiAgICAgICAgICBvID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZywKICAgICAgICAgIGkgPSAiZnVuY3Rpb24iID09IHR5cGVvZiBCbG9iIHx8ICJ1bmRlZmluZWQiICE9IHR5cGVvZiBCbG9iICYmICJbb2JqZWN0IEJsb2JDb25zdHJ1Y3Rvcl0iID09PSBvLmNhbGwoQmxvYiksCiAgICAgICAgICBzID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgRmlsZSB8fCAidW5kZWZpbmVkIiAhPSB0eXBlb2YgRmlsZSAmJiAiW29iamVjdCBGaWxlQ29uc3RydWN0b3JdIiA9PT0gby5jYWxsKEZpbGUpOwoKICAgICAgdC5leHBvcnRzID0gZnVuY3Rpb24gdChyKSB7CiAgICAgICAgaWYgKCFyIHx8ICJvYmplY3QiICE9IF90eXBlb2YocikpIHJldHVybiAhMTsKCiAgICAgICAgaWYgKG4ocikpIHsKICAgICAgICAgIGZvciAodmFyIG8gPSAwLCBhID0gci5sZW5ndGg7IG8gPCBhOyBvKyspIHsKICAgICAgICAgICAgaWYgKHQocltvXSkpIHJldHVybiAhMDsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gITE7CiAgICAgICAgfQoKICAgICAgICBpZiAoImZ1bmN0aW9uIiA9PSB0eXBlb2YgZSAmJiBlLmlzQnVmZmVyICYmIGUuaXNCdWZmZXIocikgfHwgImZ1bmN0aW9uIiA9PSB0eXBlb2YgQXJyYXlCdWZmZXIgJiYgciBpbnN0YW5jZW9mIEFycmF5QnVmZmVyIHx8IGkgJiYgciBpbnN0YW5jZW9mIEJsb2IgfHwgcyAmJiByIGluc3RhbmNlb2YgRmlsZSkgcmV0dXJuICEwOwogICAgICAgIGlmIChyLnRvSlNPTiAmJiAiZnVuY3Rpb24iID09IHR5cGVvZiByLnRvSlNPTiAmJiAxID09PSBhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gdChyLnRvSlNPTigpLCAhMCk7CgogICAgICAgIGZvciAodmFyIGMgaW4gcikgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChyLCBjKSAmJiB0KHJbY10pKSByZXR1cm4gITA7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gITE7CiAgICAgIH07CiAgICB9KS5jYWxsKHRoaXMsIHIoNCkuQnVmZmVyKTsKICB9LCBmdW5jdGlvbiAodCwgZSkgewogICAgdmFyIHIgPSBbXS5pbmRleE9mOwoKICAgIHQuZXhwb3J0cyA9IGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgIGlmIChyKSByZXR1cm4gdC5pbmRleE9mKGUpOwoKICAgICAgZm9yICh2YXIgbiA9IDA7IG4gPCB0Lmxlbmd0aDsgKytuKSB7CiAgICAgICAgaWYgKHRbbl0gPT09IGUpIHJldHVybiBuOwogICAgICB9CgogICAgICByZXR1cm4gLTE7CiAgICB9OwogIH0sIGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICB2YXIgbiA9IHIoMyksCiAgICAgICAgbyA9IHIoMSksCiAgICAgICAgaSA9IHIoNDgpLAogICAgICAgIHMgPSByKDE2KSwKICAgICAgICBhID0gcigxNyksCiAgICAgICAgYyA9IHIoMCkoInNvY2tldC5pby1jbGllbnQ6c29ja2V0IiksCiAgICAgICAgaCA9IHIoNSksCiAgICAgICAgdSA9IHIoMTMpOwogICAgdC5leHBvcnRzID0gbDsKICAgIHZhciBmID0gewogICAgICBjb25uZWN0OiAxLAogICAgICBjb25uZWN0X2Vycm9yOiAxLAogICAgICBjb25uZWN0X3RpbWVvdXQ6IDEsCiAgICAgIGNvbm5lY3Rpbmc6IDEsCiAgICAgIGRpc2Nvbm5lY3Q6IDEsCiAgICAgIGVycm9yOiAxLAogICAgICByZWNvbm5lY3Q6IDEsCiAgICAgIHJlY29ubmVjdF9hdHRlbXB0OiAxLAogICAgICByZWNvbm5lY3RfZmFpbGVkOiAxLAogICAgICByZWNvbm5lY3RfZXJyb3I6IDEsCiAgICAgIHJlY29ubmVjdGluZzogMSwKICAgICAgcGluZzogMSwKICAgICAgcG9uZzogMQogICAgfSwKICAgICAgICBwID0gby5wcm90b3R5cGUuZW1pdDsKCiAgICBmdW5jdGlvbiBsKHQsIGUsIHIpIHsKICAgICAgdGhpcy5pbyA9IHQsIHRoaXMubnNwID0gZSwgdGhpcy5qc29uID0gdGhpcywgdGhpcy5pZHMgPSAwLCB0aGlzLmFja3MgPSB7fSwgdGhpcy5yZWNlaXZlQnVmZmVyID0gW10sIHRoaXMuc2VuZEJ1ZmZlciA9IFtdLCB0aGlzLmNvbm5lY3RlZCA9ICExLCB0aGlzLmRpc2Nvbm5lY3RlZCA9ICEwLCB0aGlzLmZsYWdzID0ge30sIHIgJiYgci5xdWVyeSAmJiAodGhpcy5xdWVyeSA9IHIucXVlcnkpLCB0aGlzLmlvLmF1dG9Db25uZWN0ICYmIHRoaXMub3BlbigpOwogICAgfQoKICAgIG8obC5wcm90b3R5cGUpLCBsLnByb3RvdHlwZS5zdWJFdmVudHMgPSBmdW5jdGlvbiAoKSB7CiAgICAgIGlmICghdGhpcy5zdWJzKSB7CiAgICAgICAgdmFyIHQgPSB0aGlzLmlvOwogICAgICAgIHRoaXMuc3VicyA9IFtzKHQsICJvcGVuIiwgYSh0aGlzLCAib25vcGVuIikpLCBzKHQsICJwYWNrZXQiLCBhKHRoaXMsICJvbnBhY2tldCIpKSwgcyh0LCAiY2xvc2UiLCBhKHRoaXMsICJvbmNsb3NlIikpXTsKICAgICAgfQogICAgfSwgbC5wcm90b3R5cGUub3BlbiA9IGwucHJvdG90eXBlLmNvbm5lY3QgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiB0aGlzLmNvbm5lY3RlZCB8fCAodGhpcy5zdWJFdmVudHMoKSwgdGhpcy5pby5vcGVuKCksICJvcGVuIiA9PT0gdGhpcy5pby5yZWFkeVN0YXRlICYmIHRoaXMub25vcGVuKCksIHRoaXMuZW1pdCgiY29ubmVjdGluZyIpKSwgdGhpczsKICAgIH0sIGwucHJvdG90eXBlLnNlbmQgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciB0ID0gaShhcmd1bWVudHMpOwogICAgICByZXR1cm4gdC51bnNoaWZ0KCJtZXNzYWdlIiksIHRoaXMuZW1pdC5hcHBseSh0aGlzLCB0KSwgdGhpczsKICAgIH0sIGwucHJvdG90eXBlLmVtaXQgPSBmdW5jdGlvbiAodCkgewogICAgICBpZiAoZi5oYXNPd25Qcm9wZXJ0eSh0KSkgcmV0dXJuIHAuYXBwbHkodGhpcywgYXJndW1lbnRzKSwgdGhpczsKICAgICAgdmFyIGUgPSBpKGFyZ3VtZW50cyksCiAgICAgICAgICByID0gewogICAgICAgIHR5cGU6ICh2b2lkIDAgIT09IHRoaXMuZmxhZ3MuYmluYXJ5ID8gdGhpcy5mbGFncy5iaW5hcnkgOiB1KGUpKSA/IG4uQklOQVJZX0VWRU5UIDogbi5FVkVOVCwKICAgICAgICBkYXRhOiBlLAogICAgICAgIG9wdGlvbnM6IHt9CiAgICAgIH07CiAgICAgIHJldHVybiByLm9wdGlvbnMuY29tcHJlc3MgPSAhdGhpcy5mbGFncyB8fCAhMSAhPT0gdGhpcy5mbGFncy5jb21wcmVzcywgImZ1bmN0aW9uIiA9PSB0eXBlb2YgZVtlLmxlbmd0aCAtIDFdICYmIChjKCJlbWl0dGluZyBwYWNrZXQgd2l0aCBhY2sgaWQgJWQiLCB0aGlzLmlkcyksIHRoaXMuYWNrc1t0aGlzLmlkc10gPSBlLnBvcCgpLCByLmlkID0gdGhpcy5pZHMrKyksIHRoaXMuY29ubmVjdGVkID8gdGhpcy5wYWNrZXQocikgOiB0aGlzLnNlbmRCdWZmZXIucHVzaChyKSwgdGhpcy5mbGFncyA9IHt9LCB0aGlzOwogICAgfSwgbC5wcm90b3R5cGUucGFja2V0ID0gZnVuY3Rpb24gKHQpIHsKICAgICAgdC5uc3AgPSB0aGlzLm5zcCwgdGhpcy5pby5wYWNrZXQodCk7CiAgICB9LCBsLnByb3RvdHlwZS5vbm9wZW4gPSBmdW5jdGlvbiAoKSB7CiAgICAgIGlmIChjKCJ0cmFuc3BvcnQgaXMgb3BlbiAtIGNvbm5lY3RpbmciKSwgIi8iICE9PSB0aGlzLm5zcCkgaWYgKHRoaXMucXVlcnkpIHsKICAgICAgICB2YXIgdCA9ICJvYmplY3QiID09IF90eXBlb2YodGhpcy5xdWVyeSkgPyBoLmVuY29kZSh0aGlzLnF1ZXJ5KSA6IHRoaXMucXVlcnk7CiAgICAgICAgYygic2VuZGluZyBjb25uZWN0IHBhY2tldCB3aXRoIHF1ZXJ5ICVzIiwgdCksIHRoaXMucGFja2V0KHsKICAgICAgICAgIHR5cGU6IG4uQ09OTkVDVCwKICAgICAgICAgIHF1ZXJ5OiB0CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB0aGlzLnBhY2tldCh7CiAgICAgICAgdHlwZTogbi5DT05ORUNUCiAgICAgIH0pOwogICAgfSwgbC5wcm90b3R5cGUub25jbG9zZSA9IGZ1bmN0aW9uICh0KSB7CiAgICAgIGMoImNsb3NlICglcykiLCB0KSwgdGhpcy5jb25uZWN0ZWQgPSAhMSwgdGhpcy5kaXNjb25uZWN0ZWQgPSAhMCwgZGVsZXRlIHRoaXMuaWQsIHRoaXMuZW1pdCgiZGlzY29ubmVjdCIsIHQpOwogICAgfSwgbC5wcm90b3R5cGUub25wYWNrZXQgPSBmdW5jdGlvbiAodCkgewogICAgICB2YXIgZSA9IHQubnNwID09PSB0aGlzLm5zcCwKICAgICAgICAgIHIgPSB0LnR5cGUgPT09IG4uRVJST1IgJiYgIi8iID09PSB0Lm5zcDsKICAgICAgaWYgKGUgfHwgcikgc3dpdGNoICh0LnR5cGUpIHsKICAgICAgICBjYXNlIG4uQ09OTkVDVDoKICAgICAgICAgIHRoaXMub25jb25uZWN0KCk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSBuLkVWRU5UOgogICAgICAgIGNhc2Ugbi5CSU5BUllfRVZFTlQ6CiAgICAgICAgICB0aGlzLm9uZXZlbnQodCk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSBuLkFDSzoKICAgICAgICBjYXNlIG4uQklOQVJZX0FDSzoKICAgICAgICAgIHRoaXMub25hY2sodCk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSBuLkRJU0NPTk5FQ1Q6CiAgICAgICAgICB0aGlzLm9uZGlzY29ubmVjdCgpOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2Ugbi5FUlJPUjoKICAgICAgICAgIHRoaXMuZW1pdCgiZXJyb3IiLCB0LmRhdGEpOwogICAgICB9CiAgICB9LCBsLnByb3RvdHlwZS5vbmV2ZW50ID0gZnVuY3Rpb24gKHQpIHsKICAgICAgdmFyIGUgPSB0LmRhdGEgfHwgW107CiAgICAgIGMoImVtaXR0aW5nIGV2ZW50ICVqIiwgZSksIG51bGwgIT0gdC5pZCAmJiAoYygiYXR0YWNoaW5nIGFjayBjYWxsYmFjayB0byBldmVudCIpLCBlLnB1c2godGhpcy5hY2sodC5pZCkpKSwgdGhpcy5jb25uZWN0ZWQgPyBwLmFwcGx5KHRoaXMsIGUpIDogdGhpcy5yZWNlaXZlQnVmZmVyLnB1c2goZSk7CiAgICB9LCBsLnByb3RvdHlwZS5hY2sgPSBmdW5jdGlvbiAodCkgewogICAgICB2YXIgZSA9IHRoaXMsCiAgICAgICAgICByID0gITE7CiAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKCFyKSB7CiAgICAgICAgICByID0gITA7CiAgICAgICAgICB2YXIgbyA9IGkoYXJndW1lbnRzKTsKICAgICAgICAgIGMoInNlbmRpbmcgYWNrICVqIiwgbyksIGUucGFja2V0KHsKICAgICAgICAgICAgdHlwZTogdShvKSA/IG4uQklOQVJZX0FDSyA6IG4uQUNLLAogICAgICAgICAgICBpZDogdCwKICAgICAgICAgICAgZGF0YTogbwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9OwogICAgfSwgbC5wcm90b3R5cGUub25hY2sgPSBmdW5jdGlvbiAodCkgewogICAgICB2YXIgZSA9IHRoaXMuYWNrc1t0LmlkXTsKICAgICAgImZ1bmN0aW9uIiA9PSB0eXBlb2YgZSA/IChjKCJjYWxsaW5nIGFjayAlcyB3aXRoICVqIiwgdC5pZCwgdC5kYXRhKSwgZS5hcHBseSh0aGlzLCB0LmRhdGEpLCBkZWxldGUgdGhpcy5hY2tzW3QuaWRdKSA6IGMoImJhZCBhY2sgJXMiLCB0LmlkKTsKICAgIH0sIGwucHJvdG90eXBlLm9uY29ubmVjdCA9IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5jb25uZWN0ZWQgPSAhMCwgdGhpcy5kaXNjb25uZWN0ZWQgPSAhMSwgdGhpcy5lbWl0KCJjb25uZWN0IiksIHRoaXMuZW1pdEJ1ZmZlcmVkKCk7CiAgICB9LCBsLnByb3RvdHlwZS5lbWl0QnVmZmVyZWQgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciB0OwoKICAgICAgZm9yICh0ID0gMDsgdCA8IHRoaXMucmVjZWl2ZUJ1ZmZlci5sZW5ndGg7IHQrKykgewogICAgICAgIHAuYXBwbHkodGhpcywgdGhpcy5yZWNlaXZlQnVmZmVyW3RdKTsKICAgICAgfQoKICAgICAgZm9yICh0aGlzLnJlY2VpdmVCdWZmZXIgPSBbXSwgdCA9IDA7IHQgPCB0aGlzLnNlbmRCdWZmZXIubGVuZ3RoOyB0KyspIHsKICAgICAgICB0aGlzLnBhY2tldCh0aGlzLnNlbmRCdWZmZXJbdF0pOwogICAgICB9CgogICAgICB0aGlzLnNlbmRCdWZmZXIgPSBbXTsKICAgIH0sIGwucHJvdG90eXBlLm9uZGlzY29ubmVjdCA9IGZ1bmN0aW9uICgpIHsKICAgICAgYygic2VydmVyIGRpc2Nvbm5lY3QgKCVzKSIsIHRoaXMubnNwKSwgdGhpcy5kZXN0cm95KCksIHRoaXMub25jbG9zZSgiaW8gc2VydmVyIGRpc2Nvbm5lY3QiKTsKICAgIH0sIGwucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7CiAgICAgIGlmICh0aGlzLnN1YnMpIHsKICAgICAgICBmb3IgKHZhciB0ID0gMDsgdCA8IHRoaXMuc3Vicy5sZW5ndGg7IHQrKykgewogICAgICAgICAgdGhpcy5zdWJzW3RdLmRlc3Ryb3koKTsKICAgICAgICB9CgogICAgICAgIHRoaXMuc3VicyA9IG51bGw7CiAgICAgIH0KCiAgICAgIHRoaXMuaW8uZGVzdHJveSh0aGlzKTsKICAgIH0sIGwucHJvdG90eXBlLmNsb3NlID0gbC5wcm90b3R5cGUuZGlzY29ubmVjdCA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHRoaXMuY29ubmVjdGVkICYmIChjKCJwZXJmb3JtaW5nIGRpc2Nvbm5lY3QgKCVzKSIsIHRoaXMubnNwKSwgdGhpcy5wYWNrZXQoewogICAgICAgIHR5cGU6IG4uRElTQ09OTkVDVAogICAgICB9KSksIHRoaXMuZGVzdHJveSgpLCB0aGlzLmNvbm5lY3RlZCAmJiB0aGlzLm9uY2xvc2UoImlvIGNsaWVudCBkaXNjb25uZWN0IiksIHRoaXM7CiAgICB9LCBsLnByb3RvdHlwZS5jb21wcmVzcyA9IGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiB0aGlzLmZsYWdzLmNvbXByZXNzID0gdCwgdGhpczsKICAgIH0sIGwucHJvdG90eXBlLmJpbmFyeSA9IGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiB0aGlzLmZsYWdzLmJpbmFyeSA9IHQsIHRoaXM7CiAgICB9OwogIH0sIGZ1bmN0aW9uICh0LCBlKSB7CiAgICB0LmV4cG9ydHMgPSBmdW5jdGlvbiAodCwgZSwgcikgewogICAgICByZXR1cm4gdC5vbihlLCByKSwgewogICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uIGRlc3Ryb3koKSB7CiAgICAgICAgICB0LnJlbW92ZUxpc3RlbmVyKGUsIHIpOwogICAgICAgIH0KICAgICAgfTsKICAgIH07CiAgfSwgZnVuY3Rpb24gKHQsIGUpIHsKICAgIHZhciByID0gW10uc2xpY2U7CgogICAgdC5leHBvcnRzID0gZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgaWYgKCJzdHJpbmciID09IHR5cGVvZiBlICYmIChlID0gdFtlXSksICJmdW5jdGlvbiIgIT0gdHlwZW9mIGUpIHRocm93IG5ldyBFcnJvcigiYmluZCgpIHJlcXVpcmVzIGEgZnVuY3Rpb24iKTsKICAgICAgdmFyIG4gPSByLmNhbGwoYXJndW1lbnRzLCAyKTsKICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gZS5hcHBseSh0LCBuLmNvbmNhdChyLmNhbGwoYXJndW1lbnRzKSkpOwogICAgICB9OwogICAgfTsKICB9LCBmdW5jdGlvbiAodCwgZSwgcikgewogICAgdC5leHBvcnRzID0gcigxOSk7CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgIHZhciBuID0gcigyMCksCiAgICAgICAgbyA9IHIoMyksCiAgICAgICAgaSA9IHIoMTApLAogICAgICAgIHMgPSByKDApKCJzb2NrZXQuaW8tY2xpZW50Iik7CiAgICB0LmV4cG9ydHMgPSBlID0gYzsKICAgIHZhciBhID0gZS5tYW5hZ2VycyA9IHt9OwoKICAgIGZ1bmN0aW9uIGModCwgZSkgewogICAgICAib2JqZWN0IiA9PSBfdHlwZW9mKHQpICYmIChlID0gdCwgdCA9IHZvaWQgMCksIGUgPSBlIHx8IHt9OwogICAgICB2YXIgciwKICAgICAgICAgIG8gPSBuKHQpLAogICAgICAgICAgYyA9IG8uc291cmNlLAogICAgICAgICAgaCA9IG8uaWQsCiAgICAgICAgICB1ID0gby5wYXRoLAogICAgICAgICAgZiA9IGFbaF0gJiYgdSBpbiBhW2hdLm5zcHM7CiAgICAgIHJldHVybiBlLmZvcmNlTmV3IHx8IGVbImZvcmNlIG5ldyBjb25uZWN0aW9uIl0gfHwgITEgPT09IGUubXVsdGlwbGV4IHx8IGYgPyAocygiaWdub3Jpbmcgc29ja2V0IGNhY2hlIGZvciAlcyIsIGMpLCByID0gaShjLCBlKSkgOiAoYVtoXSB8fCAocygibmV3IGlvIGluc3RhbmNlIGZvciAlcyIsIGMpLCBhW2hdID0gaShjLCBlKSksIHIgPSBhW2hdKSwgby5xdWVyeSAmJiAhZS5xdWVyeSAmJiAoZS5xdWVyeSA9IG8ucXVlcnkpLCByLnNvY2tldChvLnBhdGgsIGUpOwogICAgfQoKICAgIGUucHJvdG9jb2wgPSBvLnByb3RvY29sLCBlLmNvbm5lY3QgPSBjLCBlLk1hbmFnZXIgPSByKDEwKSwgZS5Tb2NrZXQgPSByKDE1KTsKICB9LCBmdW5jdGlvbiAodCwgZSwgcikgewogICAgdmFyIG4gPSByKDYpLAogICAgICAgIG8gPSByKDApKCJzb2NrZXQuaW8tY2xpZW50OnVybCIpOwoKICAgIHQuZXhwb3J0cyA9IGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgIHZhciByID0gdDsKICAgICAgZSA9IGUgfHwgInVuZGVmaW5lZCIgIT0gdHlwZW9mIGxvY2F0aW9uICYmIGxvY2F0aW9uLCBudWxsID09IHQgJiYgKHQgPSBlLnByb3RvY29sICsgIi8vIiArIGUuaG9zdCk7CiAgICAgICJzdHJpbmciID09IHR5cGVvZiB0ICYmICgiLyIgPT09IHQuY2hhckF0KDApICYmICh0ID0gIi8iID09PSB0LmNoYXJBdCgxKSA/IGUucHJvdG9jb2wgKyB0IDogZS5ob3N0ICsgdCksIC9eKGh0dHBzP3x3c3M/KTpcL1wvLy50ZXN0KHQpIHx8IChvKCJwcm90b2NvbC1sZXNzIHVybCAlcyIsIHQpLCB0ID0gdm9pZCAwICE9PSBlID8gZS5wcm90b2NvbCArICIvLyIgKyB0IDogImh0dHBzOi8vIiArIHQpLCBvKCJwYXJzZSAlcyIsIHQpLCByID0gbih0KSk7CiAgICAgIHIucG9ydCB8fCAoL14oaHR0cHx3cykkLy50ZXN0KHIucHJvdG9jb2wpID8gci5wb3J0ID0gIjgwIiA6IC9eKGh0dHB8d3MpcyQvLnRlc3Qoci5wcm90b2NvbCkgJiYgKHIucG9ydCA9ICI0NDMiKSk7CiAgICAgIHIucGF0aCA9IHIucGF0aCB8fCAiLyI7CiAgICAgIHZhciBpID0gLTEgIT09IHIuaG9zdC5pbmRleE9mKCI6IikgPyAiWyIgKyByLmhvc3QgKyAiXSIgOiByLmhvc3Q7CiAgICAgIHJldHVybiByLmlkID0gci5wcm90b2NvbCArICI6Ly8iICsgaSArICI6IiArIHIucG9ydCwgci5ocmVmID0gci5wcm90b2NvbCArICI6Ly8iICsgaSArIChlICYmIGUucG9ydCA9PT0gci5wb3J0ID8gIiIgOiAiOiIgKyByLnBvcnQpLCByOwogICAgfTsKICB9LCBmdW5jdGlvbiAodCwgZSwgcikgewogICAgdmFyIG4gPSByKDcpLAogICAgICAgIG8gPSByKDgpLAogICAgICAgIGkgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLAogICAgICAgIHMgPSAiZnVuY3Rpb24iID09IHR5cGVvZiBCbG9iIHx8ICJ1bmRlZmluZWQiICE9IHR5cGVvZiBCbG9iICYmICJbb2JqZWN0IEJsb2JDb25zdHJ1Y3Rvcl0iID09PSBpLmNhbGwoQmxvYiksCiAgICAgICAgYSA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIEZpbGUgfHwgInVuZGVmaW5lZCIgIT0gdHlwZW9mIEZpbGUgJiYgIltvYmplY3QgRmlsZUNvbnN0cnVjdG9yXSIgPT09IGkuY2FsbChGaWxlKTsKICAgIGUuZGVjb25zdHJ1Y3RQYWNrZXQgPSBmdW5jdGlvbiAodCkgewogICAgICB2YXIgZSA9IFtdLAogICAgICAgICAgciA9IHQuZGF0YSwKICAgICAgICAgIGkgPSB0OwogICAgICByZXR1cm4gaS5kYXRhID0gZnVuY3Rpb24gdChlLCByKSB7CiAgICAgICAgaWYgKCFlKSByZXR1cm4gZTsKCiAgICAgICAgaWYgKG8oZSkpIHsKICAgICAgICAgIHZhciBpID0gewogICAgICAgICAgICBfcGxhY2Vob2xkZXI6ICEwLAogICAgICAgICAgICBudW06IHIubGVuZ3RoCiAgICAgICAgICB9OwogICAgICAgICAgcmV0dXJuIHIucHVzaChlKSwgaTsKICAgICAgICB9CgogICAgICAgIGlmIChuKGUpKSB7CiAgICAgICAgICBmb3IgKHZhciBzID0gbmV3IEFycmF5KGUubGVuZ3RoKSwgYSA9IDA7IGEgPCBlLmxlbmd0aDsgYSsrKSB7CiAgICAgICAgICAgIHNbYV0gPSB0KGVbYV0sIHIpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBzOwogICAgICAgIH0KCiAgICAgICAgaWYgKCJvYmplY3QiID09IF90eXBlb2YoZSkgJiYgIShlIGluc3RhbmNlb2YgRGF0ZSkpIHsKICAgICAgICAgIHMgPSB7fTsKCiAgICAgICAgICBmb3IgKHZhciBjIGluIGUpIHsKICAgICAgICAgICAgc1tjXSA9IHQoZVtjXSwgcik7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHM7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZTsKICAgICAgfShyLCBlKSwgaS5hdHRhY2htZW50cyA9IGUubGVuZ3RoLCB7CiAgICAgICAgcGFja2V0OiBpLAogICAgICAgIGJ1ZmZlcnM6IGUKICAgICAgfTsKICAgIH0sIGUucmVjb25zdHJ1Y3RQYWNrZXQgPSBmdW5jdGlvbiAodCwgZSkgewogICAgICByZXR1cm4gdC5kYXRhID0gZnVuY3Rpb24gdChlLCByKSB7CiAgICAgICAgaWYgKCFlKSByZXR1cm4gZTsKICAgICAgICBpZiAoZSAmJiBlLl9wbGFjZWhvbGRlcikgcmV0dXJuIHJbZS5udW1dOwogICAgICAgIGlmIChuKGUpKSBmb3IgKHZhciBvID0gMDsgbyA8IGUubGVuZ3RoOyBvKyspIHsKICAgICAgICAgIGVbb10gPSB0KGVbb10sIHIpOwogICAgICAgIH0gZWxzZSBpZiAoIm9iamVjdCIgPT0gX3R5cGVvZihlKSkgZm9yICh2YXIgaSBpbiBlKSB7CiAgICAgICAgICBlW2ldID0gdChlW2ldLCByKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGU7CiAgICAgIH0odC5kYXRhLCBlKSwgdC5hdHRhY2htZW50cyA9IHZvaWQgMCwgdDsKICAgIH0sIGUucmVtb3ZlQmxvYnMgPSBmdW5jdGlvbiAodCwgZSkgewogICAgICB2YXIgciA9IDAsCiAgICAgICAgICBpID0gdDsKICAgICAgIWZ1bmN0aW9uIHQoYywgaCwgdSkgewogICAgICAgIGlmICghYykgcmV0dXJuIGM7CgogICAgICAgIGlmIChzICYmIGMgaW5zdGFuY2VvZiBCbG9iIHx8IGEgJiYgYyBpbnN0YW5jZW9mIEZpbGUpIHsKICAgICAgICAgIHIrKzsKICAgICAgICAgIHZhciBmID0gbmV3IEZpbGVSZWFkZXIoKTsKICAgICAgICAgIGYub25sb2FkID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICB1ID8gdVtoXSA9IHRoaXMucmVzdWx0IDogaSA9IHRoaXMucmVzdWx0LCAtLXIgfHwgZShpKTsKICAgICAgICAgIH0sIGYucmVhZEFzQXJyYXlCdWZmZXIoYyk7CiAgICAgICAgfSBlbHNlIGlmIChuKGMpKSBmb3IgKHZhciBwID0gMDsgcCA8IGMubGVuZ3RoOyBwKyspIHsKICAgICAgICAgIHQoY1twXSwgcCwgYyk7CiAgICAgICAgfSBlbHNlIGlmICgib2JqZWN0IiA9PSBfdHlwZW9mKGMpICYmICFvKGMpKSBmb3IgKHZhciBsIGluIGMpIHsKICAgICAgICAgIHQoY1tsXSwgbCwgYyk7CiAgICAgICAgfQogICAgICB9KGkpLCByIHx8IGUoaSk7CiAgICB9OwogIH0sIGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgZS5ieXRlTGVuZ3RoID0gZnVuY3Rpb24gKHQpIHsKICAgICAgdmFyIGUgPSBoKHQpLAogICAgICAgICAgciA9IGVbMF0sCiAgICAgICAgICBuID0gZVsxXTsKICAgICAgcmV0dXJuIDMgKiAociArIG4pIC8gNCAtIG47CiAgICB9LCBlLnRvQnl0ZUFycmF5ID0gZnVuY3Rpb24gKHQpIHsKICAgICAgdmFyIGUsCiAgICAgICAgICByLAogICAgICAgICAgbiA9IGgodCksCiAgICAgICAgICBzID0gblswXSwKICAgICAgICAgIGEgPSBuWzFdLAogICAgICAgICAgYyA9IG5ldyBpKGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICAgICAgcmV0dXJuIDMgKiAoZSArIHIpIC8gNCAtIHI7CiAgICAgIH0oMCwgcywgYSkpLAogICAgICAgICAgdSA9IDAsCiAgICAgICAgICBmID0gYSA+IDAgPyBzIC0gNCA6IHM7CgogICAgICBmb3IgKHIgPSAwOyByIDwgZjsgciArPSA0KSB7CiAgICAgICAgZSA9IG9bdC5jaGFyQ29kZUF0KHIpXSA8PCAxOCB8IG9bdC5jaGFyQ29kZUF0KHIgKyAxKV0gPDwgMTIgfCBvW3QuY2hhckNvZGVBdChyICsgMildIDw8IDYgfCBvW3QuY2hhckNvZGVBdChyICsgMyldLCBjW3UrK10gPSBlID4+IDE2ICYgMjU1LCBjW3UrK10gPSBlID4+IDggJiAyNTUsIGNbdSsrXSA9IDI1NSAmIGU7CiAgICAgIH0KCiAgICAgIDIgPT09IGEgJiYgKGUgPSBvW3QuY2hhckNvZGVBdChyKV0gPDwgMiB8IG9bdC5jaGFyQ29kZUF0KHIgKyAxKV0gPj4gNCwgY1t1KytdID0gMjU1ICYgZSk7CiAgICAgIDEgPT09IGEgJiYgKGUgPSBvW3QuY2hhckNvZGVBdChyKV0gPDwgMTAgfCBvW3QuY2hhckNvZGVBdChyICsgMSldIDw8IDQgfCBvW3QuY2hhckNvZGVBdChyICsgMildID4+IDIsIGNbdSsrXSA9IGUgPj4gOCAmIDI1NSwgY1t1KytdID0gMjU1ICYgZSk7CiAgICAgIHJldHVybiBjOwogICAgfSwgZS5mcm9tQnl0ZUFycmF5ID0gZnVuY3Rpb24gKHQpIHsKICAgICAgZm9yICh2YXIgZSwgciA9IHQubGVuZ3RoLCBvID0gciAlIDMsIGkgPSBbXSwgcyA9IDAsIGEgPSByIC0gbzsgcyA8IGE7IHMgKz0gMTYzODMpIHsKICAgICAgICBpLnB1c2godSh0LCBzLCBzICsgMTYzODMgPiBhID8gYSA6IHMgKyAxNjM4MykpOwogICAgICB9CgogICAgICAxID09PSBvID8gKGUgPSB0W3IgLSAxXSwgaS5wdXNoKG5bZSA+PiAyXSArIG5bZSA8PCA0ICYgNjNdICsgIj09IikpIDogMiA9PT0gbyAmJiAoZSA9ICh0W3IgLSAyXSA8PCA4KSArIHRbciAtIDFdLCBpLnB1c2gobltlID4+IDEwXSArIG5bZSA+PiA0ICYgNjNdICsgbltlIDw8IDIgJiA2M10gKyAiPSIpKTsKICAgICAgcmV0dXJuIGkuam9pbigiIik7CiAgICB9OwoKICAgIGZvciAodmFyIG4gPSBbXSwgbyA9IFtdLCBpID0gInVuZGVmaW5lZCIgIT0gdHlwZW9mIFVpbnQ4QXJyYXkgPyBVaW50OEFycmF5IDogQXJyYXksIHMgPSAiQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODkrLyIsIGEgPSAwLCBjID0gcy5sZW5ndGg7IGEgPCBjOyArK2EpIHsKICAgICAgblthXSA9IHNbYV0sIG9bcy5jaGFyQ29kZUF0KGEpXSA9IGE7CiAgICB9CgogICAgZnVuY3Rpb24gaCh0KSB7CiAgICAgIHZhciBlID0gdC5sZW5ndGg7CiAgICAgIGlmIChlICUgNCA+IDApIHRocm93IG5ldyBFcnJvcigiSW52YWxpZCBzdHJpbmcuIExlbmd0aCBtdXN0IGJlIGEgbXVsdGlwbGUgb2YgNCIpOwogICAgICB2YXIgciA9IHQuaW5kZXhPZigiPSIpOwogICAgICByZXR1cm4gLTEgPT09IHIgJiYgKHIgPSBlKSwgW3IsIHIgPT09IGUgPyAwIDogNCAtIHIgJSA0XTsKICAgIH0KCiAgICBmdW5jdGlvbiB1KHQsIGUsIHIpIHsKICAgICAgZm9yICh2YXIgbywgaSwgcyA9IFtdLCBhID0gZTsgYSA8IHI7IGEgKz0gMykgewogICAgICAgIG8gPSAodFthXSA8PCAxNiAmIDE2NzExNjgwKSArICh0W2EgKyAxXSA8PCA4ICYgNjUyODApICsgKDI1NSAmIHRbYSArIDJdKSwgcy5wdXNoKG5bKGkgPSBvKSA+PiAxOCAmIDYzXSArIG5baSA+PiAxMiAmIDYzXSArIG5baSA+PiA2ICYgNjNdICsgbls2MyAmIGldKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHMuam9pbigiIik7CiAgICB9CgogICAgb1siLSIuY2hhckNvZGVBdCgwKV0gPSA2Miwgb1siXyIuY2hhckNvZGVBdCgwKV0gPSA2MzsKICB9LCBmdW5jdGlvbiAodCwgZSkgewogICAgZS5yZWFkID0gZnVuY3Rpb24gKHQsIGUsIHIsIG4sIG8pIHsKICAgICAgdmFyIGksCiAgICAgICAgICBzLAogICAgICAgICAgYSA9IDggKiBvIC0gbiAtIDEsCiAgICAgICAgICBjID0gKDEgPDwgYSkgLSAxLAogICAgICAgICAgaCA9IGMgPj4gMSwKICAgICAgICAgIHUgPSAtNywKICAgICAgICAgIGYgPSByID8gbyAtIDEgOiAwLAogICAgICAgICAgcCA9IHIgPyAtMSA6IDEsCiAgICAgICAgICBsID0gdFtlICsgZl07CgogICAgICBmb3IgKGYgKz0gcCwgaSA9IGwgJiAoMSA8PCAtdSkgLSAxLCBsID4+PSAtdSwgdSArPSBhOyB1ID4gMDsgaSA9IDI1NiAqIGkgKyB0W2UgKyBmXSwgZiArPSBwLCB1IC09IDgpIHsKICAgICAgICA7CiAgICAgIH0KCiAgICAgIGZvciAocyA9IGkgJiAoMSA8PCAtdSkgLSAxLCBpID4+PSAtdSwgdSArPSBuOyB1ID4gMDsgcyA9IDI1NiAqIHMgKyB0W2UgKyBmXSwgZiArPSBwLCB1IC09IDgpIHsKICAgICAgICA7CiAgICAgIH0KCiAgICAgIGlmICgwID09PSBpKSBpID0gMSAtIGg7ZWxzZSB7CiAgICAgICAgaWYgKGkgPT09IGMpIHJldHVybiBzID8gTmFOIDogMSAvIDAgKiAobCA/IC0xIDogMSk7CiAgICAgICAgcyArPSBNYXRoLnBvdygyLCBuKSwgaSAtPSBoOwogICAgICB9CiAgICAgIHJldHVybiAobCA/IC0xIDogMSkgKiBzICogTWF0aC5wb3coMiwgaSAtIG4pOwogICAgfSwgZS53cml0ZSA9IGZ1bmN0aW9uICh0LCBlLCByLCBuLCBvLCBpKSB7CiAgICAgIHZhciBzLAogICAgICAgICAgYSwKICAgICAgICAgIGMsCiAgICAgICAgICBoID0gOCAqIGkgLSBvIC0gMSwKICAgICAgICAgIHUgPSAoMSA8PCBoKSAtIDEsCiAgICAgICAgICBmID0gdSA+PiAxLAogICAgICAgICAgcCA9IDIzID09PSBvID8gTWF0aC5wb3coMiwgLTI0KSAtIE1hdGgucG93KDIsIC03NykgOiAwLAogICAgICAgICAgbCA9IG4gPyAwIDogaSAtIDEsCiAgICAgICAgICBkID0gbiA/IDEgOiAtMSwKICAgICAgICAgIHkgPSBlIDwgMCB8fCAwID09PSBlICYmIDEgLyBlIDwgMCA/IDEgOiAwOwoKICAgICAgZm9yIChlID0gTWF0aC5hYnMoZSksIGlzTmFOKGUpIHx8IGUgPT09IDEgLyAwID8gKGEgPSBpc05hTihlKSA/IDEgOiAwLCBzID0gdSkgOiAocyA9IE1hdGguZmxvb3IoTWF0aC5sb2coZSkgLyBNYXRoLkxOMiksIGUgKiAoYyA9IE1hdGgucG93KDIsIC1zKSkgPCAxICYmIChzLS0sIGMgKj0gMiksIChlICs9IHMgKyBmID49IDEgPyBwIC8gYyA6IHAgKiBNYXRoLnBvdygyLCAxIC0gZikpICogYyA+PSAyICYmIChzKyssIGMgLz0gMiksIHMgKyBmID49IHUgPyAoYSA9IDAsIHMgPSB1KSA6IHMgKyBmID49IDEgPyAoYSA9IChlICogYyAtIDEpICogTWF0aC5wb3coMiwgbyksIHMgKz0gZikgOiAoYSA9IGUgKiBNYXRoLnBvdygyLCBmIC0gMSkgKiBNYXRoLnBvdygyLCBvKSwgcyA9IDApKTsgbyA+PSA4OyB0W3IgKyBsXSA9IDI1NSAmIGEsIGwgKz0gZCwgYSAvPSAyNTYsIG8gLT0gOCkgewogICAgICAgIDsKICAgICAgfQoKICAgICAgZm9yIChzID0gcyA8PCBvIHwgYSwgaCArPSBvOyBoID4gMDsgdFtyICsgbF0gPSAyNTUgJiBzLCBsICs9IGQsIHMgLz0gMjU2LCBoIC09IDgpIHsKICAgICAgICA7CiAgICAgIH0KCiAgICAgIHRbciArIGwgLSBkXSB8PSAxMjggKiB5OwogICAgfTsKICB9LCBmdW5jdGlvbiAodCwgZSkgewogICAgdmFyIHIgPSB7fS50b1N0cmluZzsKCiAgICB0LmV4cG9ydHMgPSBBcnJheS5pc0FycmF5IHx8IGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiAiW29iamVjdCBBcnJheV0iID09IHIuY2FsbCh0KTsKICAgIH07CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgIHQuZXhwb3J0cyA9IHIoMjYpLCB0LmV4cG9ydHMucGFyc2VyID0gcigyKTsKICB9LCBmdW5jdGlvbiAodCwgZSwgcikgewogICAgdmFyIG4gPSByKDExKSwKICAgICAgICBvID0gcigxKSwKICAgICAgICBpID0gcigwKSgiZW5naW5lLmlvLWNsaWVudDpzb2NrZXQiKSwKICAgICAgICBzID0gcigxNCksCiAgICAgICAgYSA9IHIoMiksCiAgICAgICAgYyA9IHIoNiksCiAgICAgICAgaCA9IHIoNSk7CgogICAgZnVuY3Rpb24gdSh0LCBlKSB7CiAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiB1KSkgcmV0dXJuIG5ldyB1KHQsIGUpOwogICAgICBlID0gZSB8fCB7fSwgdCAmJiAib2JqZWN0IiA9PSBfdHlwZW9mKHQpICYmIChlID0gdCwgdCA9IG51bGwpLCB0ID8gKHQgPSBjKHQpLCBlLmhvc3RuYW1lID0gdC5ob3N0LCBlLnNlY3VyZSA9ICJodHRwcyIgPT09IHQucHJvdG9jb2wgfHwgIndzcyIgPT09IHQucHJvdG9jb2wsIGUucG9ydCA9IHQucG9ydCwgdC5xdWVyeSAmJiAoZS5xdWVyeSA9IHQucXVlcnkpKSA6IGUuaG9zdCAmJiAoZS5ob3N0bmFtZSA9IGMoZS5ob3N0KS5ob3N0KSwgdGhpcy5zZWN1cmUgPSBudWxsICE9IGUuc2VjdXJlID8gZS5zZWN1cmUgOiAidW5kZWZpbmVkIiAhPSB0eXBlb2YgbG9jYXRpb24gJiYgImh0dHBzOiIgPT09IGxvY2F0aW9uLnByb3RvY29sLCBlLmhvc3RuYW1lICYmICFlLnBvcnQgJiYgKGUucG9ydCA9IHRoaXMuc2VjdXJlID8gIjQ0MyIgOiAiODAiKSwgdGhpcy5hZ2VudCA9IGUuYWdlbnQgfHwgITEsIHRoaXMuaG9zdG5hbWUgPSBlLmhvc3RuYW1lIHx8ICgidW5kZWZpbmVkIiAhPSB0eXBlb2YgbG9jYXRpb24gPyBsb2NhdGlvbi5ob3N0bmFtZSA6ICJsb2NhbGhvc3QiKSwgdGhpcy5wb3J0ID0gZS5wb3J0IHx8ICgidW5kZWZpbmVkIiAhPSB0eXBlb2YgbG9jYXRpb24gJiYgbG9jYXRpb24ucG9ydCA/IGxvY2F0aW9uLnBvcnQgOiB0aGlzLnNlY3VyZSA/IDQ0MyA6IDgwKSwgdGhpcy5xdWVyeSA9IGUucXVlcnkgfHwge30sICJzdHJpbmciID09IHR5cGVvZiB0aGlzLnF1ZXJ5ICYmICh0aGlzLnF1ZXJ5ID0gaC5kZWNvZGUodGhpcy5xdWVyeSkpLCB0aGlzLnVwZ3JhZGUgPSAhMSAhPT0gZS51cGdyYWRlLCB0aGlzLnBhdGggPSAoZS5wYXRoIHx8ICIvZW5naW5lLmlvIikucmVwbGFjZSgvXC8kLywgIiIpICsgIi8iLCB0aGlzLmZvcmNlSlNPTlAgPSAhIWUuZm9yY2VKU09OUCwgdGhpcy5qc29ucCA9ICExICE9PSBlLmpzb25wLCB0aGlzLmZvcmNlQmFzZTY0ID0gISFlLmZvcmNlQmFzZTY0LCB0aGlzLmVuYWJsZXNYRFIgPSAhIWUuZW5hYmxlc1hEUiwgdGhpcy53aXRoQ3JlZGVudGlhbHMgPSAhMSAhPT0gZS53aXRoQ3JlZGVudGlhbHMsIHRoaXMudGltZXN0YW1wUGFyYW0gPSBlLnRpbWVzdGFtcFBhcmFtIHx8ICJ0IiwgdGhpcy50aW1lc3RhbXBSZXF1ZXN0cyA9IGUudGltZXN0YW1wUmVxdWVzdHMsIHRoaXMudHJhbnNwb3J0cyA9IGUudHJhbnNwb3J0cyB8fCBbIndlYnNvY2tldCJdLCB0aGlzLnRyYW5zcG9ydE9wdGlvbnMgPSBlLnRyYW5zcG9ydE9wdGlvbnMgfHwge30sIHRoaXMucmVhZHlTdGF0ZSA9ICIiLCB0aGlzLndyaXRlQnVmZmVyID0gW10sIHRoaXMucHJldkJ1ZmZlckxlbiA9IDAsIHRoaXMucG9saWN5UG9ydCA9IGUucG9saWN5UG9ydCB8fCA4NDMsIHRoaXMucmVtZW1iZXJVcGdyYWRlID0gZS5yZW1lbWJlclVwZ3JhZGUgfHwgITEsIHRoaXMuYmluYXJ5VHlwZSA9IG51bGwsIHRoaXMub25seUJpbmFyeVVwZ3JhZGVzID0gZS5vbmx5QmluYXJ5VXBncmFkZXMsIHRoaXMucGVyTWVzc2FnZURlZmxhdGUgPSAhMSAhPT0gZS5wZXJNZXNzYWdlRGVmbGF0ZSAmJiAoZS5wZXJNZXNzYWdlRGVmbGF0ZSB8fCB7fSksICEwID09PSB0aGlzLnBlck1lc3NhZ2VEZWZsYXRlICYmICh0aGlzLnBlck1lc3NhZ2VEZWZsYXRlID0ge30pLCB0aGlzLnBlck1lc3NhZ2VEZWZsYXRlICYmIG51bGwgPT0gdGhpcy5wZXJNZXNzYWdlRGVmbGF0ZS50aHJlc2hvbGQgJiYgKHRoaXMucGVyTWVzc2FnZURlZmxhdGUudGhyZXNob2xkID0gMTAyNCksIHRoaXMucGZ4ID0gZS5wZnggfHwgbnVsbCwgdGhpcy5rZXkgPSBlLmtleSB8fCBudWxsLCB0aGlzLnBhc3NwaHJhc2UgPSBlLnBhc3NwaHJhc2UgfHwgbnVsbCwgdGhpcy5jZXJ0ID0gZS5jZXJ0IHx8IG51bGwsIHRoaXMuY2EgPSBlLmNhIHx8IG51bGwsIHRoaXMuY2lwaGVycyA9IGUuY2lwaGVycyB8fCBudWxsLCB0aGlzLnJlamVjdFVuYXV0aG9yaXplZCA9IHZvaWQgMCA9PT0gZS5yZWplY3RVbmF1dGhvcml6ZWQgfHwgZS5yZWplY3RVbmF1dGhvcml6ZWQsIHRoaXMuZm9yY2VOb2RlID0gISFlLmZvcmNlTm9kZSwgdGhpcy5pc1JlYWN0TmF0aXZlID0gInVuZGVmaW5lZCIgIT0gdHlwZW9mIG5hdmlnYXRvciAmJiAic3RyaW5nIiA9PSB0eXBlb2YgbmF2aWdhdG9yLnByb2R1Y3QgJiYgInJlYWN0bmF0aXZlIiA9PT0gbmF2aWdhdG9yLnByb2R1Y3QudG9Mb3dlckNhc2UoKSwgKCJ1bmRlZmluZWQiID09IHR5cGVvZiBzZWxmIHx8IHRoaXMuaXNSZWFjdE5hdGl2ZSkgJiYgKGUuZXh0cmFIZWFkZXJzICYmIE9iamVjdC5rZXlzKGUuZXh0cmFIZWFkZXJzKS5sZW5ndGggPiAwICYmICh0aGlzLmV4dHJhSGVhZGVycyA9IGUuZXh0cmFIZWFkZXJzKSwgZS5sb2NhbEFkZHJlc3MgJiYgKHRoaXMubG9jYWxBZGRyZXNzID0gZS5sb2NhbEFkZHJlc3MpKSwgdGhpcy5pZCA9IG51bGwsIHRoaXMudXBncmFkZXMgPSBudWxsLCB0aGlzLnBpbmdJbnRlcnZhbCA9IG51bGwsIHRoaXMucGluZ1RpbWVvdXQgPSBudWxsLCB0aGlzLnBpbmdJbnRlcnZhbFRpbWVyID0gbnVsbCwgdGhpcy5waW5nVGltZW91dFRpbWVyID0gbnVsbCwgdGhpcy5vcGVuKCk7CiAgICB9CgogICAgdC5leHBvcnRzID0gdSwgdS5wcmlvcldlYnNvY2tldFN1Y2Nlc3MgPSAhMSwgbyh1LnByb3RvdHlwZSksIHUucHJvdG9jb2wgPSBhLnByb3RvY29sLCB1LlNvY2tldCA9IHUsIHUuVHJhbnNwb3J0ID0gcigxMiksIHUudHJhbnNwb3J0cyA9IHIoMTEpLCB1LnBhcnNlciA9IHIoMiksIHUucHJvdG90eXBlLmNyZWF0ZVRyYW5zcG9ydCA9IGZ1bmN0aW9uICh0KSB7CiAgICAgIGkoJ2NyZWF0aW5nIHRyYW5zcG9ydCAiJXMiJywgdCk7CgogICAgICB2YXIgZSA9IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgdmFyIGUgPSB7fTsKCiAgICAgICAgZm9yICh2YXIgciBpbiB0KSB7CiAgICAgICAgICB0Lmhhc093blByb3BlcnR5KHIpICYmIChlW3JdID0gdFtyXSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZTsKICAgICAgfSh0aGlzLnF1ZXJ5KTsKCiAgICAgIGUuRUlPID0gYS5wcm90b2NvbCwgZS50cmFuc3BvcnQgPSB0OwogICAgICB2YXIgciA9IHRoaXMudHJhbnNwb3J0T3B0aW9uc1t0XSB8fCB7fTsKICAgICAgcmV0dXJuIHRoaXMuaWQgJiYgKGUuc2lkID0gdGhpcy5pZCksIG5ldyBuW3RdKHsKICAgICAgICBxdWVyeTogZSwKICAgICAgICBzb2NrZXQ6IHRoaXMsCiAgICAgICAgYWdlbnQ6IHIuYWdlbnQgfHwgdGhpcy5hZ2VudCwKICAgICAgICBob3N0bmFtZTogci5ob3N0bmFtZSB8fCB0aGlzLmhvc3RuYW1lLAogICAgICAgIHBvcnQ6IHIucG9ydCB8fCB0aGlzLnBvcnQsCiAgICAgICAgc2VjdXJlOiByLnNlY3VyZSB8fCB0aGlzLnNlY3VyZSwKICAgICAgICBwYXRoOiByLnBhdGggfHwgdGhpcy5wYXRoLAogICAgICAgIGZvcmNlSlNPTlA6IHIuZm9yY2VKU09OUCB8fCB0aGlzLmZvcmNlSlNPTlAsCiAgICAgICAganNvbnA6IHIuanNvbnAgfHwgdGhpcy5qc29ucCwKICAgICAgICBmb3JjZUJhc2U2NDogci5mb3JjZUJhc2U2NCB8fCB0aGlzLmZvcmNlQmFzZTY0LAogICAgICAgIGVuYWJsZXNYRFI6IHIuZW5hYmxlc1hEUiB8fCB0aGlzLmVuYWJsZXNYRFIsCiAgICAgICAgd2l0aENyZWRlbnRpYWxzOiByLndpdGhDcmVkZW50aWFscyB8fCB0aGlzLndpdGhDcmVkZW50aWFscywKICAgICAgICB0aW1lc3RhbXBSZXF1ZXN0czogci50aW1lc3RhbXBSZXF1ZXN0cyB8fCB0aGlzLnRpbWVzdGFtcFJlcXVlc3RzLAogICAgICAgIHRpbWVzdGFtcFBhcmFtOiByLnRpbWVzdGFtcFBhcmFtIHx8IHRoaXMudGltZXN0YW1wUGFyYW0sCiAgICAgICAgcG9saWN5UG9ydDogci5wb2xpY3lQb3J0IHx8IHRoaXMucG9saWN5UG9ydCwKICAgICAgICBwZng6IHIucGZ4IHx8IHRoaXMucGZ4LAogICAgICAgIGtleTogci5rZXkgfHwgdGhpcy5rZXksCiAgICAgICAgcGFzc3BocmFzZTogci5wYXNzcGhyYXNlIHx8IHRoaXMucGFzc3BocmFzZSwKICAgICAgICBjZXJ0OiByLmNlcnQgfHwgdGhpcy5jZXJ0LAogICAgICAgIGNhOiByLmNhIHx8IHRoaXMuY2EsCiAgICAgICAgY2lwaGVyczogci5jaXBoZXJzIHx8IHRoaXMuY2lwaGVycywKICAgICAgICByZWplY3RVbmF1dGhvcml6ZWQ6IHIucmVqZWN0VW5hdXRob3JpemVkIHx8IHRoaXMucmVqZWN0VW5hdXRob3JpemVkLAogICAgICAgIHBlck1lc3NhZ2VEZWZsYXRlOiByLnBlck1lc3NhZ2VEZWZsYXRlIHx8IHRoaXMucGVyTWVzc2FnZURlZmxhdGUsCiAgICAgICAgZXh0cmFIZWFkZXJzOiByLmV4dHJhSGVhZGVycyB8fCB0aGlzLmV4dHJhSGVhZGVycywKICAgICAgICBmb3JjZU5vZGU6IHIuZm9yY2VOb2RlIHx8IHRoaXMuZm9yY2VOb2RlLAogICAgICAgIGxvY2FsQWRkcmVzczogci5sb2NhbEFkZHJlc3MgfHwgdGhpcy5sb2NhbEFkZHJlc3MsCiAgICAgICAgcmVxdWVzdFRpbWVvdXQ6IHIucmVxdWVzdFRpbWVvdXQgfHwgdGhpcy5yZXF1ZXN0VGltZW91dCwKICAgICAgICBwcm90b2NvbHM6IHIucHJvdG9jb2xzIHx8IHZvaWQgMCwKICAgICAgICBpc1JlYWN0TmF0aXZlOiB0aGlzLmlzUmVhY3ROYXRpdmUKICAgICAgfSk7CiAgICB9LCB1LnByb3RvdHlwZS5vcGVuID0gZnVuY3Rpb24gKCkgewogICAgICB2YXIgdDsKICAgICAgaWYgKHRoaXMucmVtZW1iZXJVcGdyYWRlICYmIHUucHJpb3JXZWJzb2NrZXRTdWNjZXNzICYmIC0xICE9PSB0aGlzLnRyYW5zcG9ydHMuaW5kZXhPZigid2Vic29ja2V0IikpIHQgPSAid2Vic29ja2V0IjtlbHNlIHsKICAgICAgICBpZiAoMCA9PT0gdGhpcy50cmFuc3BvcnRzLmxlbmd0aCkgewogICAgICAgICAgdmFyIGUgPSB0aGlzOwogICAgICAgICAgcmV0dXJuIHZvaWQgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGUuZW1pdCgiZXJyb3IiLCAiTm8gdHJhbnNwb3J0cyBhdmFpbGFibGUiKTsKICAgICAgICAgIH0sIDApOwogICAgICAgIH0KCiAgICAgICAgdCA9IHRoaXMudHJhbnNwb3J0c1swXTsKICAgICAgfQogICAgICB0aGlzLnJlYWR5U3RhdGUgPSAib3BlbmluZyI7CgogICAgICB0cnkgewogICAgICAgIHQgPSB0aGlzLmNyZWF0ZVRyYW5zcG9ydCh0KTsKICAgICAgfSBjYXRjaCAodCkgewogICAgICAgIHJldHVybiB0aGlzLnRyYW5zcG9ydHMuc2hpZnQoKSwgdm9pZCB0aGlzLm9wZW4oKTsKICAgICAgfQoKICAgICAgdC5vcGVuKCksIHRoaXMuc2V0VHJhbnNwb3J0KHQpOwogICAgfSwgdS5wcm90b3R5cGUuc2V0VHJhbnNwb3J0ID0gZnVuY3Rpb24gKHQpIHsKICAgICAgaSgic2V0dGluZyB0cmFuc3BvcnQgJXMiLCB0Lm5hbWUpOwogICAgICB2YXIgZSA9IHRoaXM7CiAgICAgIHRoaXMudHJhbnNwb3J0ICYmIChpKCJjbGVhcmluZyBleGlzdGluZyB0cmFuc3BvcnQgJXMiLCB0aGlzLnRyYW5zcG9ydC5uYW1lKSwgdGhpcy50cmFuc3BvcnQucmVtb3ZlQWxsTGlzdGVuZXJzKCkpLCB0aGlzLnRyYW5zcG9ydCA9IHQsIHQub24oImRyYWluIiwgZnVuY3Rpb24gKCkgewogICAgICAgIGUub25EcmFpbigpOwogICAgICB9KS5vbigicGFja2V0IiwgZnVuY3Rpb24gKHQpIHsKICAgICAgICBlLm9uUGFja2V0KHQpOwogICAgICB9KS5vbigiZXJyb3IiLCBmdW5jdGlvbiAodCkgewogICAgICAgIGUub25FcnJvcih0KTsKICAgICAgfSkub24oImNsb3NlIiwgZnVuY3Rpb24gKCkgewogICAgICAgIGUub25DbG9zZSgidHJhbnNwb3J0IGNsb3NlIik7CiAgICAgIH0pOwogICAgfSwgdS5wcm90b3R5cGUucHJvYmUgPSBmdW5jdGlvbiAodCkgewogICAgICBpKCdwcm9iaW5nIHRyYW5zcG9ydCAiJXMiJywgdCk7CiAgICAgIHZhciBlID0gdGhpcy5jcmVhdGVUcmFuc3BvcnQodCwgewogICAgICAgIHByb2JlOiAxCiAgICAgIH0pLAogICAgICAgICAgciA9ICExLAogICAgICAgICAgbiA9IHRoaXM7CgogICAgICBmdW5jdGlvbiBvKCkgewogICAgICAgIGlmIChuLm9ubHlCaW5hcnlVcGdyYWRlcykgewogICAgICAgICAgdmFyIG8gPSAhdGhpcy5zdXBwb3J0c0JpbmFyeSAmJiBuLnRyYW5zcG9ydC5zdXBwb3J0c0JpbmFyeTsKICAgICAgICAgIHIgPSByIHx8IG87CiAgICAgICAgfQoKICAgICAgICByIHx8IChpKCdwcm9iZSB0cmFuc3BvcnQgIiVzIiBvcGVuZWQnLCB0KSwgZS5zZW5kKFt7CiAgICAgICAgICB0eXBlOiAicGluZyIsCiAgICAgICAgICBkYXRhOiAicHJvYmUiCiAgICAgICAgfV0pLCBlLm9uY2UoInBhY2tldCIsIGZ1bmN0aW9uIChvKSB7CiAgICAgICAgICBpZiAoIXIpIGlmICgicG9uZyIgPT09IG8udHlwZSAmJiAicHJvYmUiID09PSBvLmRhdGEpIHsKICAgICAgICAgICAgaWYgKGkoJ3Byb2JlIHRyYW5zcG9ydCAiJXMiIHBvbmcnLCB0KSwgbi51cGdyYWRpbmcgPSAhMCwgbi5lbWl0KCJ1cGdyYWRpbmciLCBlKSwgIWUpIHJldHVybjsKICAgICAgICAgICAgdS5wcmlvcldlYnNvY2tldFN1Y2Nlc3MgPSAid2Vic29ja2V0IiA9PT0gZS5uYW1lLCBpKCdwYXVzaW5nIGN1cnJlbnQgdHJhbnNwb3J0ICIlcyInLCBuLnRyYW5zcG9ydC5uYW1lKSwgbi50cmFuc3BvcnQucGF1c2UoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHIgfHwgImNsb3NlZCIgIT09IG4ucmVhZHlTdGF0ZSAmJiAoaSgiY2hhbmdpbmcgdHJhbnNwb3J0IGFuZCBzZW5kaW5nIHVwZ3JhZGUgcGFja2V0IiksIHAoKSwgbi5zZXRUcmFuc3BvcnQoZSksIGUuc2VuZChbewogICAgICAgICAgICAgICAgdHlwZTogInVwZ3JhZGUiCiAgICAgICAgICAgICAgfV0pLCBuLmVtaXQoInVwZ3JhZGUiLCBlKSwgZSA9IG51bGwsIG4udXBncmFkaW5nID0gITEsIG4uZmx1c2goKSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaSgncHJvYmUgdHJhbnNwb3J0ICIlcyIgZmFpbGVkJywgdCk7CiAgICAgICAgICAgIHZhciBzID0gbmV3IEVycm9yKCJwcm9iZSBlcnJvciIpOwogICAgICAgICAgICBzLnRyYW5zcG9ydCA9IGUubmFtZSwgbi5lbWl0KCJ1cGdyYWRlRXJyb3IiLCBzKTsKICAgICAgICAgIH0KICAgICAgICB9KSk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIHMoKSB7CiAgICAgICAgciB8fCAociA9ICEwLCBwKCksIGUuY2xvc2UoKSwgZSA9IG51bGwpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBhKHIpIHsKICAgICAgICB2YXIgbyA9IG5ldyBFcnJvcigicHJvYmUgZXJyb3I6ICIgKyByKTsKICAgICAgICBvLnRyYW5zcG9ydCA9IGUubmFtZSwgcygpLCBpKCdwcm9iZSB0cmFuc3BvcnQgIiVzIiBmYWlsZWQgYmVjYXVzZSBvZiBlcnJvcjogJXMnLCB0LCByKSwgbi5lbWl0KCJ1cGdyYWRlRXJyb3IiLCBvKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gYygpIHsKICAgICAgICBhKCJ0cmFuc3BvcnQgY2xvc2VkIik7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGgoKSB7CiAgICAgICAgYSgic29ja2V0IGNsb3NlZCIpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBmKHQpIHsKICAgICAgICBlICYmIHQubmFtZSAhPT0gZS5uYW1lICYmIChpKCciJXMiIHdvcmtzIC0gYWJvcnRpbmcgIiVzIicsIHQubmFtZSwgZS5uYW1lKSwgcygpKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gcCgpIHsKICAgICAgICBlLnJlbW92ZUxpc3RlbmVyKCJvcGVuIiwgbyksIGUucmVtb3ZlTGlzdGVuZXIoImVycm9yIiwgYSksIGUucmVtb3ZlTGlzdGVuZXIoImNsb3NlIiwgYyksIG4ucmVtb3ZlTGlzdGVuZXIoImNsb3NlIiwgaCksIG4ucmVtb3ZlTGlzdGVuZXIoInVwZ3JhZGluZyIsIGYpOwogICAgICB9CgogICAgICB1LnByaW9yV2Vic29ja2V0U3VjY2VzcyA9ICExLCBlLm9uY2UoIm9wZW4iLCBvKSwgZS5vbmNlKCJlcnJvciIsIGEpLCBlLm9uY2UoImNsb3NlIiwgYyksIHRoaXMub25jZSgiY2xvc2UiLCBoKSwgdGhpcy5vbmNlKCJ1cGdyYWRpbmciLCBmKSwgZS5vcGVuKCk7CiAgICB9LCB1LnByb3RvdHlwZS5vbk9wZW4gPSBmdW5jdGlvbiAoKSB7CiAgICAgIGlmIChpKCJzb2NrZXQgb3BlbiIpLCB0aGlzLnJlYWR5U3RhdGUgPSAib3BlbiIsIHUucHJpb3JXZWJzb2NrZXRTdWNjZXNzID0gIndlYnNvY2tldCIgPT09IHRoaXMudHJhbnNwb3J0Lm5hbWUsIHRoaXMuZW1pdCgib3BlbiIpLCB0aGlzLmZsdXNoKCksICJvcGVuIiA9PT0gdGhpcy5yZWFkeVN0YXRlICYmIHRoaXMudXBncmFkZSAmJiB0aGlzLnRyYW5zcG9ydC5wYXVzZSkgewogICAgICAgIGkoInN0YXJ0aW5nIHVwZ3JhZGUgcHJvYmVzIik7CgogICAgICAgIGZvciAodmFyIHQgPSAwLCBlID0gdGhpcy51cGdyYWRlcy5sZW5ndGg7IHQgPCBlOyB0KyspIHsKICAgICAgICAgIHRoaXMucHJvYmUodGhpcy51cGdyYWRlc1t0XSk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB1LnByb3RvdHlwZS5vblBhY2tldCA9IGZ1bmN0aW9uICh0KSB7CiAgICAgIGlmICgib3BlbmluZyIgPT09IHRoaXMucmVhZHlTdGF0ZSB8fCAib3BlbiIgPT09IHRoaXMucmVhZHlTdGF0ZSB8fCAiY2xvc2luZyIgPT09IHRoaXMucmVhZHlTdGF0ZSkgc3dpdGNoIChpKCdzb2NrZXQgcmVjZWl2ZTogdHlwZSAiJXMiLCBkYXRhICIlcyInLCB0LnR5cGUsIHQuZGF0YSksIHRoaXMuZW1pdCgicGFja2V0IiwgdCksIHRoaXMuZW1pdCgiaGVhcnRiZWF0IiksIHQudHlwZSkgewogICAgICAgIGNhc2UgIm9wZW4iOgogICAgICAgICAgdGhpcy5vbkhhbmRzaGFrZShKU09OLnBhcnNlKHQuZGF0YSkpOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgInBvbmciOgogICAgICAgICAgdGhpcy5zZXRQaW5nKCksIHRoaXMuZW1pdCgicG9uZyIpOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgImVycm9yIjoKICAgICAgICAgIHZhciBlID0gbmV3IEVycm9yKCJzZXJ2ZXIgZXJyb3IiKTsKICAgICAgICAgIGUuY29kZSA9IHQuZGF0YSwgdGhpcy5vbkVycm9yKGUpOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgIm1lc3NhZ2UiOgogICAgICAgICAgdGhpcy5lbWl0KCJkYXRhIiwgdC5kYXRhKSwgdGhpcy5lbWl0KCJtZXNzYWdlIiwgdC5kYXRhKTsKICAgICAgfSBlbHNlIGkoJ3BhY2tldCByZWNlaXZlZCB3aXRoIHNvY2tldCByZWFkeVN0YXRlICIlcyInLCB0aGlzLnJlYWR5U3RhdGUpOwogICAgfSwgdS5wcm90b3R5cGUub25IYW5kc2hha2UgPSBmdW5jdGlvbiAodCkgewogICAgICB0aGlzLmVtaXQoImhhbmRzaGFrZSIsIHQpLCB0aGlzLmlkID0gdC5zaWQsIHRoaXMudHJhbnNwb3J0LnF1ZXJ5LnNpZCA9IHQuc2lkLCB0aGlzLnVwZ3JhZGVzID0gdGhpcy5maWx0ZXJVcGdyYWRlcyh0LnVwZ3JhZGVzKSwgdGhpcy5waW5nSW50ZXJ2YWwgPSB0LnBpbmdJbnRlcnZhbCwgdGhpcy5waW5nVGltZW91dCA9IHQucGluZ1RpbWVvdXQsIHRoaXMub25PcGVuKCksICJjbG9zZWQiICE9PSB0aGlzLnJlYWR5U3RhdGUgJiYgKHRoaXMuc2V0UGluZygpLCB0aGlzLnJlbW92ZUxpc3RlbmVyKCJoZWFydGJlYXQiLCB0aGlzLm9uSGVhcnRiZWF0KSwgdGhpcy5vbigiaGVhcnRiZWF0IiwgdGhpcy5vbkhlYXJ0YmVhdCkpOwogICAgfSwgdS5wcm90b3R5cGUub25IZWFydGJlYXQgPSBmdW5jdGlvbiAodCkgewogICAgICBjbGVhclRpbWVvdXQodGhpcy5waW5nVGltZW91dFRpbWVyKTsKICAgICAgdmFyIGUgPSB0aGlzOwogICAgICBlLnBpbmdUaW1lb3V0VGltZXIgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAiY2xvc2VkIiAhPT0gZS5yZWFkeVN0YXRlICYmIGUub25DbG9zZSgicGluZyB0aW1lb3V0Iik7CiAgICAgIH0sIHQgfHwgZS5waW5nSW50ZXJ2YWwgKyBlLnBpbmdUaW1lb3V0KTsKICAgIH0sIHUucHJvdG90eXBlLnNldFBpbmcgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciB0ID0gdGhpczsKICAgICAgY2xlYXJUaW1lb3V0KHQucGluZ0ludGVydmFsVGltZXIpLCB0LnBpbmdJbnRlcnZhbFRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgaSgid3JpdGluZyBwaW5nIHBhY2tldCAtIGV4cGVjdGluZyBwb25nIHdpdGhpbiAlc21zIiwgdC5waW5nVGltZW91dCksIHQucGluZygpLCB0Lm9uSGVhcnRiZWF0KHQucGluZ1RpbWVvdXQpOwogICAgICB9LCB0LnBpbmdJbnRlcnZhbCk7CiAgICB9LCB1LnByb3RvdHlwZS5waW5nID0gZnVuY3Rpb24gKCkgewogICAgICB2YXIgdCA9IHRoaXM7CiAgICAgIHRoaXMuc2VuZFBhY2tldCgicGluZyIsIGZ1bmN0aW9uICgpIHsKICAgICAgICB0LmVtaXQoInBpbmciKTsKICAgICAgfSk7CiAgICB9LCB1LnByb3RvdHlwZS5vbkRyYWluID0gZnVuY3Rpb24gKCkgewogICAgICB0aGlzLndyaXRlQnVmZmVyLnNwbGljZSgwLCB0aGlzLnByZXZCdWZmZXJMZW4pLCB0aGlzLnByZXZCdWZmZXJMZW4gPSAwLCAwID09PSB0aGlzLndyaXRlQnVmZmVyLmxlbmd0aCA/IHRoaXMuZW1pdCgiZHJhaW4iKSA6IHRoaXMuZmx1c2goKTsKICAgIH0sIHUucHJvdG90eXBlLmZsdXNoID0gZnVuY3Rpb24gKCkgewogICAgICAiY2xvc2VkIiAhPT0gdGhpcy5yZWFkeVN0YXRlICYmIHRoaXMudHJhbnNwb3J0LndyaXRhYmxlICYmICF0aGlzLnVwZ3JhZGluZyAmJiB0aGlzLndyaXRlQnVmZmVyLmxlbmd0aCAmJiAoaSgiZmx1c2hpbmcgJWQgcGFja2V0cyBpbiBzb2NrZXQiLCB0aGlzLndyaXRlQnVmZmVyLmxlbmd0aCksIHRoaXMudHJhbnNwb3J0LnNlbmQodGhpcy53cml0ZUJ1ZmZlciksIHRoaXMucHJldkJ1ZmZlckxlbiA9IHRoaXMud3JpdGVCdWZmZXIubGVuZ3RoLCB0aGlzLmVtaXQoImZsdXNoIikpOwogICAgfSwgdS5wcm90b3R5cGUud3JpdGUgPSB1LnByb3RvdHlwZS5zZW5kID0gZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgICAgcmV0dXJuIHRoaXMuc2VuZFBhY2tldCgibWVzc2FnZSIsIHQsIGUsIHIpLCB0aGlzOwogICAgfSwgdS5wcm90b3R5cGUuc2VuZFBhY2tldCA9IGZ1bmN0aW9uICh0LCBlLCByLCBuKSB7CiAgICAgIGlmICgiZnVuY3Rpb24iID09IHR5cGVvZiBlICYmIChuID0gZSwgZSA9IHZvaWQgMCksICJmdW5jdGlvbiIgPT0gdHlwZW9mIHIgJiYgKG4gPSByLCByID0gbnVsbCksICJjbG9zaW5nIiAhPT0gdGhpcy5yZWFkeVN0YXRlICYmICJjbG9zZWQiICE9PSB0aGlzLnJlYWR5U3RhdGUpIHsKICAgICAgICAociA9IHIgfHwge30pLmNvbXByZXNzID0gITEgIT09IHIuY29tcHJlc3M7CiAgICAgICAgdmFyIG8gPSB7CiAgICAgICAgICB0eXBlOiB0LAogICAgICAgICAgZGF0YTogZSwKICAgICAgICAgIG9wdGlvbnM6IHIKICAgICAgICB9OwogICAgICAgIHRoaXMuZW1pdCgicGFja2V0Q3JlYXRlIiwgbyksIHRoaXMud3JpdGVCdWZmZXIucHVzaChvKSwgbiAmJiB0aGlzLm9uY2UoImZsdXNoIiwgbiksIHRoaXMuZmx1c2goKTsKICAgICAgfQogICAgfSwgdS5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbiAoKSB7CiAgICAgIGlmICgib3BlbmluZyIgPT09IHRoaXMucmVhZHlTdGF0ZSB8fCAib3BlbiIgPT09IHRoaXMucmVhZHlTdGF0ZSkgewogICAgICAgIHRoaXMucmVhZHlTdGF0ZSA9ICJjbG9zaW5nIjsKICAgICAgICB2YXIgdCA9IHRoaXM7CiAgICAgICAgdGhpcy53cml0ZUJ1ZmZlci5sZW5ndGggPyB0aGlzLm9uY2UoImRyYWluIiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgdGhpcy51cGdyYWRpbmcgPyBuKCkgOiBlKCk7CiAgICAgICAgfSkgOiB0aGlzLnVwZ3JhZGluZyA/IG4oKSA6IGUoKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gZSgpIHsKICAgICAgICB0Lm9uQ2xvc2UoImZvcmNlZCBjbG9zZSIpLCBpKCJzb2NrZXQgY2xvc2luZyAtIHRlbGxpbmcgdHJhbnNwb3J0IHRvIGNsb3NlIiksIHQudHJhbnNwb3J0LmNsb3NlKCk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIHIoKSB7CiAgICAgICAgdC5yZW1vdmVMaXN0ZW5lcigidXBncmFkZSIsIHIpLCB0LnJlbW92ZUxpc3RlbmVyKCJ1cGdyYWRlRXJyb3IiLCByKSwgZSgpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBuKCkgewogICAgICAgIHQub25jZSgidXBncmFkZSIsIHIpLCB0Lm9uY2UoInVwZ3JhZGVFcnJvciIsIHIpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0sIHUucHJvdG90eXBlLm9uRXJyb3IgPSBmdW5jdGlvbiAodCkgewogICAgICBpKCJzb2NrZXQgZXJyb3IgJWoiLCB0KSwgdS5wcmlvcldlYnNvY2tldFN1Y2Nlc3MgPSAhMSwgdGhpcy5lbWl0KCJlcnJvciIsIHQpLCB0aGlzLm9uQ2xvc2UoInRyYW5zcG9ydCBlcnJvciIsIHQpOwogICAgfSwgdS5wcm90b3R5cGUub25DbG9zZSA9IGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgIGlmICgib3BlbmluZyIgPT09IHRoaXMucmVhZHlTdGF0ZSB8fCAib3BlbiIgPT09IHRoaXMucmVhZHlTdGF0ZSB8fCAiY2xvc2luZyIgPT09IHRoaXMucmVhZHlTdGF0ZSkgewogICAgICAgIGkoJ3NvY2tldCBjbG9zZSB3aXRoIHJlYXNvbjogIiVzIicsIHQpOwogICAgICAgIGNsZWFyVGltZW91dCh0aGlzLnBpbmdJbnRlcnZhbFRpbWVyKSwgY2xlYXJUaW1lb3V0KHRoaXMucGluZ1RpbWVvdXRUaW1lciksIHRoaXMudHJhbnNwb3J0LnJlbW92ZUFsbExpc3RlbmVycygiY2xvc2UiKSwgdGhpcy50cmFuc3BvcnQuY2xvc2UoKSwgdGhpcy50cmFuc3BvcnQucmVtb3ZlQWxsTGlzdGVuZXJzKCksIHRoaXMucmVhZHlTdGF0ZSA9ICJjbG9zZWQiLCB0aGlzLmlkID0gbnVsbCwgdGhpcy5lbWl0KCJjbG9zZSIsIHQsIGUpLCB0aGlzLndyaXRlQnVmZmVyID0gW10sIHRoaXMucHJldkJ1ZmZlckxlbiA9IDA7CiAgICAgIH0KICAgIH0sIHUucHJvdG90eXBlLmZpbHRlclVwZ3JhZGVzID0gZnVuY3Rpb24gKHQpIHsKICAgICAgZm9yICh2YXIgZSA9IFtdLCByID0gMCwgbiA9IHQubGVuZ3RoOyByIDwgbjsgcisrKSB7CiAgICAgICAgfnModGhpcy50cmFuc3BvcnRzLCB0W3JdKSAmJiBlLnB1c2godFtyXSk7CiAgICAgIH0KCiAgICAgIHJldHVybiBlOwogICAgfTsKICB9LCBmdW5jdGlvbiAodCwgZSwgcikgewogICAgKGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciBuLAogICAgICAgICAgbywKICAgICAgICAgIGkgPSByKDEyKSwKICAgICAgICAgIHMgPSByKDIpLAogICAgICAgICAgYSA9IHIoNSksCiAgICAgICAgICBjID0gcigzNSksCiAgICAgICAgICBoID0gcigzNiksCiAgICAgICAgICB1ID0gcigwKSgiZW5naW5lLmlvLWNsaWVudDp3ZWJzb2NrZXQiKTsKICAgICAgaWYgKCJ1bmRlZmluZWQiICE9IHR5cGVvZiBXZWJTb2NrZXQgPyBuID0gV2ViU29ja2V0IDogInVuZGVmaW5lZCIgIT0gdHlwZW9mIHNlbGYgJiYgKG4gPSBzZWxmLldlYlNvY2tldCB8fCBzZWxmLk1veldlYlNvY2tldCksICJ1bmRlZmluZWQiID09IHR5cGVvZiB3aW5kb3cpIHRyeSB7CiAgICAgICAgbyA9IHIoMzcpOwogICAgICB9IGNhdGNoICh0KSB7fQogICAgICB2YXIgZiA9IG4gfHwgbzsKCiAgICAgIGZ1bmN0aW9uIHAodCkgewogICAgICAgIHQgJiYgdC5mb3JjZUJhc2U2NCAmJiAodGhpcy5zdXBwb3J0c0JpbmFyeSA9ICExKSwgdGhpcy5wZXJNZXNzYWdlRGVmbGF0ZSA9IHQucGVyTWVzc2FnZURlZmxhdGUsIHRoaXMudXNpbmdCcm93c2VyV2ViU29ja2V0ID0gbiAmJiAhdC5mb3JjZU5vZGUsIHRoaXMucHJvdG9jb2xzID0gdC5wcm90b2NvbHMsIHRoaXMudXNpbmdCcm93c2VyV2ViU29ja2V0IHx8IChmID0gbyksIGkuY2FsbCh0aGlzLCB0KTsKICAgICAgfQoKICAgICAgdC5leHBvcnRzID0gcCwgYyhwLCBpKSwgcC5wcm90b3R5cGUubmFtZSA9ICJ3ZWJzb2NrZXQiLCBwLnByb3RvdHlwZS5zdXBwb3J0c0JpbmFyeSA9ICEwLCBwLnByb3RvdHlwZS5kb09wZW4gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKHRoaXMuY2hlY2soKSkgewogICAgICAgICAgdmFyIHQgPSB0aGlzLnVyaSgpLAogICAgICAgICAgICAgIGUgPSB0aGlzLnByb3RvY29scywKICAgICAgICAgICAgICByID0gewogICAgICAgICAgICBhZ2VudDogdGhpcy5hZ2VudCwKICAgICAgICAgICAgcGVyTWVzc2FnZURlZmxhdGU6IHRoaXMucGVyTWVzc2FnZURlZmxhdGUKICAgICAgICAgIH07CiAgICAgICAgICByLnBmeCA9IHRoaXMucGZ4LCByLmtleSA9IHRoaXMua2V5LCByLnBhc3NwaHJhc2UgPSB0aGlzLnBhc3NwaHJhc2UsIHIuY2VydCA9IHRoaXMuY2VydCwgci5jYSA9IHRoaXMuY2EsIHIuY2lwaGVycyA9IHRoaXMuY2lwaGVycywgci5yZWplY3RVbmF1dGhvcml6ZWQgPSB0aGlzLnJlamVjdFVuYXV0aG9yaXplZCwgdGhpcy5leHRyYUhlYWRlcnMgJiYgKHIuaGVhZGVycyA9IHRoaXMuZXh0cmFIZWFkZXJzKSwgdGhpcy5sb2NhbEFkZHJlc3MgJiYgKHIubG9jYWxBZGRyZXNzID0gdGhpcy5sb2NhbEFkZHJlc3MpOwoKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIHRoaXMud3MgPSB0aGlzLnVzaW5nQnJvd3NlcldlYlNvY2tldCAmJiAhdGhpcy5pc1JlYWN0TmF0aXZlID8gZSA/IG5ldyBmKHQsIGUpIDogbmV3IGYodCkgOiBuZXcgZih0LCBlLCByKTsKICAgICAgICAgIH0gY2F0Y2ggKHQpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZW1pdCgiZXJyb3IiLCB0KTsKICAgICAgICAgIH0KCiAgICAgICAgICB2b2lkIDAgPT09IHRoaXMud3MuYmluYXJ5VHlwZSAmJiAodGhpcy5zdXBwb3J0c0JpbmFyeSA9ICExKSwgdGhpcy53cy5zdXBwb3J0cyAmJiB0aGlzLndzLnN1cHBvcnRzLmJpbmFyeSA/ICh0aGlzLnN1cHBvcnRzQmluYXJ5ID0gITAsIHRoaXMud3MuYmluYXJ5VHlwZSA9ICJub2RlYnVmZmVyIikgOiB0aGlzLndzLmJpbmFyeVR5cGUgPSAiYXJyYXlidWZmZXIiLCB0aGlzLmFkZEV2ZW50TGlzdGVuZXJzKCk7CiAgICAgICAgfQogICAgICB9LCBwLnByb3RvdHlwZS5hZGRFdmVudExpc3RlbmVycyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgdCA9IHRoaXM7CiAgICAgICAgdGhpcy53cy5vbm9wZW4gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB0Lm9uT3BlbigpOwogICAgICAgIH0sIHRoaXMud3Mub25jbG9zZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHQub25DbG9zZSgpOwogICAgICAgIH0sIHRoaXMud3Mub25tZXNzYWdlID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIHQub25EYXRhKGUuZGF0YSk7CiAgICAgICAgfSwgdGhpcy53cy5vbmVycm9yID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIHQub25FcnJvcigid2Vic29ja2V0IGVycm9yIiwgZSk7CiAgICAgICAgfTsKICAgICAgfSwgcC5wcm90b3R5cGUud3JpdGUgPSBmdW5jdGlvbiAodCkgewogICAgICAgIHZhciByID0gdGhpczsKICAgICAgICB0aGlzLndyaXRhYmxlID0gITE7CgogICAgICAgIGZvciAodmFyIG4gPSB0Lmxlbmd0aCwgbyA9IDAsIGkgPSBuOyBvIDwgaTsgbysrKSB7CiAgICAgICAgICAhZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgcy5lbmNvZGVQYWNrZXQodCwgci5zdXBwb3J0c0JpbmFyeSwgZnVuY3Rpb24gKG8pIHsKICAgICAgICAgICAgICBpZiAoIXIudXNpbmdCcm93c2VyV2ViU29ja2V0KSB7CiAgICAgICAgICAgICAgICB2YXIgaSA9IHt9OwogICAgICAgICAgICAgICAgaWYgKHQub3B0aW9ucyAmJiAoaS5jb21wcmVzcyA9IHQub3B0aW9ucy5jb21wcmVzcyksIHIucGVyTWVzc2FnZURlZmxhdGUpICgic3RyaW5nIiA9PSB0eXBlb2YgbyA/IGUuYnl0ZUxlbmd0aChvKSA6IG8ubGVuZ3RoKSA8IHIucGVyTWVzc2FnZURlZmxhdGUudGhyZXNob2xkICYmIChpLmNvbXByZXNzID0gITEpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHIudXNpbmdCcm93c2VyV2ViU29ja2V0ID8gci53cy5zZW5kKG8pIDogci53cy5zZW5kKG8sIGkpOwogICAgICAgICAgICAgIH0gY2F0Y2ggKHQpIHsKICAgICAgICAgICAgICAgIHUoIndlYnNvY2tldCBjbG9zZWQgYmVmb3JlIG9uY2xvc2UgZXZlbnQiKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIC0tbiB8fCBhKCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSh0W29dKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGEoKSB7CiAgICAgICAgICByLmVtaXQoImZsdXNoIiksIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICByLndyaXRhYmxlID0gITAsIHIuZW1pdCgiZHJhaW4iKTsKICAgICAgICAgIH0sIDApOwogICAgICAgIH0KICAgICAgfSwgcC5wcm90b3R5cGUub25DbG9zZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBpLnByb3RvdHlwZS5vbkNsb3NlLmNhbGwodGhpcyk7CiAgICAgIH0sIHAucHJvdG90eXBlLmRvQ2xvc2UgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdm9pZCAwICE9PSB0aGlzLndzICYmIHRoaXMud3MuY2xvc2UoKTsKICAgICAgfSwgcC5wcm90b3R5cGUudXJpID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciB0ID0gdGhpcy5xdWVyeSB8fCB7fSwKICAgICAgICAgICAgZSA9IHRoaXMuc2VjdXJlID8gIndzcyIgOiAid3MiLAogICAgICAgICAgICByID0gIiI7CiAgICAgICAgcmV0dXJuIHRoaXMucG9ydCAmJiAoIndzcyIgPT09IGUgJiYgNDQzICE9PSBOdW1iZXIodGhpcy5wb3J0KSB8fCAid3MiID09PSBlICYmIDgwICE9PSBOdW1iZXIodGhpcy5wb3J0KSkgJiYgKHIgPSAiOiIgKyB0aGlzLnBvcnQpLCB0aGlzLnRpbWVzdGFtcFJlcXVlc3RzICYmICh0W3RoaXMudGltZXN0YW1wUGFyYW1dID0gaCgpKSwgdGhpcy5zdXBwb3J0c0JpbmFyeSB8fCAodC5iNjQgPSAxKSwgKHQgPSBhLmVuY29kZSh0KSkubGVuZ3RoICYmICh0ID0gIj8iICsgdCksIGUgKyAiOi8vIiArICgtMSAhPT0gdGhpcy5ob3N0bmFtZS5pbmRleE9mKCI6IikgPyAiWyIgKyB0aGlzLmhvc3RuYW1lICsgIl0iIDogdGhpcy5ob3N0bmFtZSkgKyByICsgdGhpcy5wYXRoICsgdDsKICAgICAgfSwgcC5wcm90b3R5cGUuY2hlY2sgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuICEoIWYgfHwgIl9faW5pdGlhbGl6ZSIgaW4gZiAmJiB0aGlzLm5hbWUgPT09IHAucHJvdG90eXBlLm5hbWUpOwogICAgICB9OwogICAgfSkuY2FsbCh0aGlzLCByKDQpLkJ1ZmZlcik7CiAgfSwgZnVuY3Rpb24gKHQsIGUpIHsKICAgIHQuZXhwb3J0cyA9IE9iamVjdC5rZXlzIHx8IGZ1bmN0aW9uICh0KSB7CiAgICAgIHZhciBlID0gW10sCiAgICAgICAgICByID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eTsKCiAgICAgIGZvciAodmFyIG4gaW4gdCkgewogICAgICAgIHIuY2FsbCh0LCBuKSAmJiBlLnB1c2gobik7CiAgICAgIH0KCiAgICAgIHJldHVybiBlOwogICAgfTsKICB9LCBmdW5jdGlvbiAodCwgZSkgewogICAgdmFyIHIgPSB7fS50b1N0cmluZzsKCiAgICB0LmV4cG9ydHMgPSBBcnJheS5pc0FycmF5IHx8IGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiAiW29iamVjdCBBcnJheV0iID09IHIuY2FsbCh0KTsKICAgIH07CiAgfSwgZnVuY3Rpb24gKHQsIGUpIHsKICAgIHQuZXhwb3J0cyA9IGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICAgIHZhciBuID0gdC5ieXRlTGVuZ3RoOwogICAgICBpZiAoZSA9IGUgfHwgMCwgciA9IHIgfHwgbiwgdC5zbGljZSkgcmV0dXJuIHQuc2xpY2UoZSwgcik7CiAgICAgIGlmIChlIDwgMCAmJiAoZSArPSBuKSwgciA8IDAgJiYgKHIgKz0gbiksIHIgPiBuICYmIChyID0gbiksIGUgPj0gbiB8fCBlID49IHIgfHwgMCA9PT0gbikgcmV0dXJuIG5ldyBBcnJheUJ1ZmZlcigwKTsKCiAgICAgIGZvciAodmFyIG8gPSBuZXcgVWludDhBcnJheSh0KSwgaSA9IG5ldyBVaW50OEFycmF5KHIgLSBlKSwgcyA9IGUsIGEgPSAwOyBzIDwgcjsgcysrLCBhKyspIHsKICAgICAgICBpW2FdID0gb1tzXTsKICAgICAgfQoKICAgICAgcmV0dXJuIGkuYnVmZmVyOwogICAgfTsKICB9LCBmdW5jdGlvbiAodCwgZSkgewogICAgZnVuY3Rpb24gcigpIHt9CgogICAgdC5leHBvcnRzID0gZnVuY3Rpb24gKHQsIGUsIG4pIHsKICAgICAgdmFyIG8gPSAhMTsKICAgICAgcmV0dXJuIG4gPSBuIHx8IHIsIGkuY291bnQgPSB0LCAwID09PSB0ID8gZSgpIDogaTsKCiAgICAgIGZ1bmN0aW9uIGkodCwgcikgewogICAgICAgIGlmIChpLmNvdW50IDw9IDApIHRocm93IG5ldyBFcnJvcigiYWZ0ZXIgY2FsbGVkIHRvbyBtYW55IHRpbWVzIik7CiAgICAgICAgLS1pLmNvdW50LCB0ID8gKG8gPSAhMCwgZSh0KSwgZSA9IG4pIDogMCAhPT0gaS5jb3VudCB8fCBvIHx8IGUobnVsbCwgcik7CiAgICAgIH0KICAgIH07CiAgfSwgZnVuY3Rpb24gKHQsIGUpIHsKICAgIC8qISBodHRwczovL210aHMuYmUvdXRmOGpzIHYyLjEuMiBieSBAbWF0aGlhcyAqLwogICAgdmFyIHIsCiAgICAgICAgbiwKICAgICAgICBvLAogICAgICAgIGkgPSBTdHJpbmcuZnJvbUNoYXJDb2RlOwoKICAgIGZ1bmN0aW9uIHModCkgewogICAgICBmb3IgKHZhciBlLCByLCBuID0gW10sIG8gPSAwLCBpID0gdC5sZW5ndGg7IG8gPCBpOykgewogICAgICAgIChlID0gdC5jaGFyQ29kZUF0KG8rKykpID49IDU1Mjk2ICYmIGUgPD0gNTYzMTkgJiYgbyA8IGkgPyA1NjMyMCA9PSAoNjQ1MTIgJiAociA9IHQuY2hhckNvZGVBdChvKyspKSkgPyBuLnB1c2goKCgxMDIzICYgZSkgPDwgMTApICsgKDEwMjMgJiByKSArIDY1NTM2KSA6IChuLnB1c2goZSksIG8tLSkgOiBuLnB1c2goZSk7CiAgICAgIH0KCiAgICAgIHJldHVybiBuOwogICAgfQoKICAgIGZ1bmN0aW9uIGEodCwgZSkgewogICAgICBpZiAodCA+PSA1NTI5NiAmJiB0IDw9IDU3MzQzKSB7CiAgICAgICAgaWYgKGUpIHRocm93IEVycm9yKCJMb25lIHN1cnJvZ2F0ZSBVKyIgKyB0LnRvU3RyaW5nKDE2KS50b1VwcGVyQ2FzZSgpICsgIiBpcyBub3QgYSBzY2FsYXIgdmFsdWUiKTsKICAgICAgICByZXR1cm4gITE7CiAgICAgIH0KCiAgICAgIHJldHVybiAhMDsKICAgIH0KCiAgICBmdW5jdGlvbiBjKHQsIGUpIHsKICAgICAgcmV0dXJuIGkodCA+PiBlICYgNjMgfCAxMjgpOwogICAgfQoKICAgIGZ1bmN0aW9uIGgodCwgZSkgewogICAgICBpZiAoMCA9PSAoNDI5NDk2NzE2OCAmIHQpKSByZXR1cm4gaSh0KTsKICAgICAgdmFyIHIgPSAiIjsKICAgICAgcmV0dXJuIDAgPT0gKDQyOTQ5NjUyNDggJiB0KSA/IHIgPSBpKHQgPj4gNiAmIDMxIHwgMTkyKSA6IDAgPT0gKDQyOTQ5MDE3NjAgJiB0KSA/IChhKHQsIGUpIHx8ICh0ID0gNjU1MzMpLCByID0gaSh0ID4+IDEyICYgMTUgfCAyMjQpLCByICs9IGModCwgNikpIDogMCA9PSAoNDI5Mjg3MDE0NCAmIHQpICYmIChyID0gaSh0ID4+IDE4ICYgNyB8IDI0MCksIHIgKz0gYyh0LCAxMiksIHIgKz0gYyh0LCA2KSksIHIgKz0gaSg2MyAmIHQgfCAxMjgpOwogICAgfQoKICAgIGZ1bmN0aW9uIHUoKSB7CiAgICAgIGlmIChvID49IG4pIHRocm93IEVycm9yKCJJbnZhbGlkIGJ5dGUgaW5kZXgiKTsKICAgICAgdmFyIHQgPSAyNTUgJiByW29dOwogICAgICBpZiAobysrLCAxMjggPT0gKDE5MiAmIHQpKSByZXR1cm4gNjMgJiB0OwogICAgICB0aHJvdyBFcnJvcigiSW52YWxpZCBjb250aW51YXRpb24gYnl0ZSIpOwogICAgfQoKICAgIGZ1bmN0aW9uIGYodCkgewogICAgICB2YXIgZSwgaTsKICAgICAgaWYgKG8gPiBuKSB0aHJvdyBFcnJvcigiSW52YWxpZCBieXRlIGluZGV4Iik7CiAgICAgIGlmIChvID09IG4pIHJldHVybiAhMTsKICAgICAgaWYgKGUgPSAyNTUgJiByW29dLCBvKyssIDAgPT0gKDEyOCAmIGUpKSByZXR1cm4gZTsKCiAgICAgIGlmICgxOTIgPT0gKDIyNCAmIGUpKSB7CiAgICAgICAgaWYgKChpID0gKDMxICYgZSkgPDwgNiB8IHUoKSkgPj0gMTI4KSByZXR1cm4gaTsKICAgICAgICB0aHJvdyBFcnJvcigiSW52YWxpZCBjb250aW51YXRpb24gYnl0ZSIpOwogICAgICB9CgogICAgICBpZiAoMjI0ID09ICgyNDAgJiBlKSkgewogICAgICAgIGlmICgoaSA9ICgxNSAmIGUpIDw8IDEyIHwgdSgpIDw8IDYgfCB1KCkpID49IDIwNDgpIHJldHVybiBhKGksIHQpID8gaSA6IDY1NTMzOwogICAgICAgIHRocm93IEVycm9yKCJJbnZhbGlkIGNvbnRpbnVhdGlvbiBieXRlIik7CiAgICAgIH0KCiAgICAgIGlmICgyNDAgPT0gKDI0OCAmIGUpICYmIChpID0gKDcgJiBlKSA8PCAxOCB8IHUoKSA8PCAxMiB8IHUoKSA8PCA2IHwgdSgpKSA+PSA2NTUzNiAmJiBpIDw9IDExMTQxMTEpIHJldHVybiBpOwogICAgICB0aHJvdyBFcnJvcigiSW52YWxpZCBVVEYtOCBkZXRlY3RlZCIpOwogICAgfQoKICAgIHQuZXhwb3J0cyA9IHsKICAgICAgdmVyc2lvbjogIjIuMS4yIiwKICAgICAgZW5jb2RlOiBmdW5jdGlvbiBlbmNvZGUodCwgZSkgewogICAgICAgIGZvciAodmFyIHIgPSAhMSAhPT0gKGUgPSBlIHx8IHt9KS5zdHJpY3QsIG4gPSBzKHQpLCBvID0gbi5sZW5ndGgsIGkgPSAtMSwgYSA9ICIiOyArK2kgPCBvOykgewogICAgICAgICAgYSArPSBoKG5baV0sIHIpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGE7CiAgICAgIH0sCiAgICAgIGRlY29kZTogZnVuY3Rpb24gZGVjb2RlKHQsIGUpIHsKICAgICAgICB2YXIgYSA9ICExICE9PSAoZSA9IGUgfHwge30pLnN0cmljdDsKICAgICAgICByID0gcyh0KSwgbiA9IHIubGVuZ3RoLCBvID0gMDsKCiAgICAgICAgZm9yICh2YXIgYywgaCA9IFtdOyAhMSAhPT0gKGMgPSBmKGEpKTspIHsKICAgICAgICAgIGgucHVzaChjKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBmdW5jdGlvbiAodCkgewogICAgICAgICAgZm9yICh2YXIgZSwgciA9IHQubGVuZ3RoLCBuID0gLTEsIG8gPSAiIjsgKytuIDwgcjspIHsKICAgICAgICAgICAgKGUgPSB0W25dKSA+IDY1NTM1ICYmIChvICs9IGkoKGUgLT0gNjU1MzYpID4+PiAxMCAmIDEwMjMgfCA1NTI5NiksIGUgPSA1NjMyMCB8IDEwMjMgJiBlKSwgbyArPSBpKGUpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBvOwogICAgICAgIH0oaCk7CiAgICAgIH0KICAgIH07CiAgfSwgZnVuY3Rpb24gKHQsIGUpIHsKICAgICFmdW5jdGlvbiAoKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKCiAgICAgIGZvciAodmFyIHQgPSAiQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODkrLyIsIHIgPSBuZXcgVWludDhBcnJheSgyNTYpLCBuID0gMDsgbiA8IHQubGVuZ3RoOyBuKyspIHsKICAgICAgICByW3QuY2hhckNvZGVBdChuKV0gPSBuOwogICAgICB9CgogICAgICBlLmVuY29kZSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdmFyIHIsCiAgICAgICAgICAgIG4gPSBuZXcgVWludDhBcnJheShlKSwKICAgICAgICAgICAgbyA9IG4ubGVuZ3RoLAogICAgICAgICAgICBpID0gIiI7CgogICAgICAgIGZvciAociA9IDA7IHIgPCBvOyByICs9IDMpIHsKICAgICAgICAgIGkgKz0gdFtuW3JdID4+IDJdLCBpICs9IHRbKDMgJiBuW3JdKSA8PCA0IHwgbltyICsgMV0gPj4gNF0sIGkgKz0gdFsoMTUgJiBuW3IgKyAxXSkgPDwgMiB8IG5bciArIDJdID4+IDZdLCBpICs9IHRbNjMgJiBuW3IgKyAyXV07CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbyAlIDMgPT0gMiA/IGkgPSBpLnN1YnN0cmluZygwLCBpLmxlbmd0aCAtIDEpICsgIj0iIDogbyAlIDMgPT0gMSAmJiAoaSA9IGkuc3Vic3RyaW5nKDAsIGkubGVuZ3RoIC0gMikgKyAiPT0iKSwgaTsKICAgICAgfSwgZS5kZWNvZGUgPSBmdW5jdGlvbiAodCkgewogICAgICAgIHZhciBlLAogICAgICAgICAgICBuLAogICAgICAgICAgICBvLAogICAgICAgICAgICBpLAogICAgICAgICAgICBzLAogICAgICAgICAgICBhID0gLjc1ICogdC5sZW5ndGgsCiAgICAgICAgICAgIGMgPSB0Lmxlbmd0aCwKICAgICAgICAgICAgaCA9IDA7CiAgICAgICAgIj0iID09PSB0W3QubGVuZ3RoIC0gMV0gJiYgKGEtLSwgIj0iID09PSB0W3QubGVuZ3RoIC0gMl0gJiYgYS0tKTsKICAgICAgICB2YXIgdSA9IG5ldyBBcnJheUJ1ZmZlcihhKSwKICAgICAgICAgICAgZiA9IG5ldyBVaW50OEFycmF5KHUpOwoKICAgICAgICBmb3IgKGUgPSAwOyBlIDwgYzsgZSArPSA0KSB7CiAgICAgICAgICBuID0gclt0LmNoYXJDb2RlQXQoZSldLCBvID0gclt0LmNoYXJDb2RlQXQoZSArIDEpXSwgaSA9IHJbdC5jaGFyQ29kZUF0KGUgKyAyKV0sIHMgPSByW3QuY2hhckNvZGVBdChlICsgMyldLCBmW2grK10gPSBuIDw8IDIgfCBvID4+IDQsIGZbaCsrXSA9ICgxNSAmIG8pIDw8IDQgfCBpID4+IDIsIGZbaCsrXSA9ICgzICYgaSkgPDwgNiB8IDYzICYgczsKICAgICAgICB9CgogICAgICAgIHJldHVybiB1OwogICAgICB9OwogICAgfSgpOwogIH0sIGZ1bmN0aW9uICh0LCBlKSB7CiAgICB2YXIgciA9IHZvaWQgMCAhPT0gciA/IHIgOiAidW5kZWZpbmVkIiAhPSB0eXBlb2YgV2ViS2l0QmxvYkJ1aWxkZXIgPyBXZWJLaXRCbG9iQnVpbGRlciA6ICJ1bmRlZmluZWQiICE9IHR5cGVvZiBNU0Jsb2JCdWlsZGVyID8gTVNCbG9iQnVpbGRlciA6ICJ1bmRlZmluZWQiICE9IHR5cGVvZiBNb3pCbG9iQnVpbGRlciAmJiBNb3pCbG9iQnVpbGRlciwKICAgICAgICBuID0gZnVuY3Rpb24gKCkgewogICAgICB0cnkgewogICAgICAgIHJldHVybiAyID09PSBuZXcgQmxvYihbImhpIl0pLnNpemU7CiAgICAgIH0gY2F0Y2ggKHQpIHsKICAgICAgICByZXR1cm4gITE7CiAgICAgIH0KICAgIH0oKSwKICAgICAgICBvID0gbiAmJiBmdW5jdGlvbiAoKSB7CiAgICAgIHRyeSB7CiAgICAgICAgcmV0dXJuIDIgPT09IG5ldyBCbG9iKFtuZXcgVWludDhBcnJheShbMSwgMl0pXSkuc2l6ZTsKICAgICAgfSBjYXRjaCAodCkgewogICAgICAgIHJldHVybiAhMTsKICAgICAgfQogICAgfSgpLAogICAgICAgIGkgPSByICYmIHIucHJvdG90eXBlLmFwcGVuZCAmJiByLnByb3RvdHlwZS5nZXRCbG9iOwoKICAgIGZ1bmN0aW9uIHModCkgewogICAgICByZXR1cm4gdC5tYXAoZnVuY3Rpb24gKHQpIHsKICAgICAgICBpZiAodC5idWZmZXIgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlcikgewogICAgICAgICAgdmFyIGUgPSB0LmJ1ZmZlcjsKCiAgICAgICAgICBpZiAodC5ieXRlTGVuZ3RoICE9PSBlLmJ5dGVMZW5ndGgpIHsKICAgICAgICAgICAgdmFyIHIgPSBuZXcgVWludDhBcnJheSh0LmJ5dGVMZW5ndGgpOwogICAgICAgICAgICByLnNldChuZXcgVWludDhBcnJheShlLCB0LmJ5dGVPZmZzZXQsIHQuYnl0ZUxlbmd0aCkpLCBlID0gci5idWZmZXI7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIGU7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdDsKICAgICAgfSk7CiAgICB9CgogICAgZnVuY3Rpb24gYSh0LCBlKSB7CiAgICAgIGUgPSBlIHx8IHt9OwogICAgICB2YXIgbiA9IG5ldyByKCk7CiAgICAgIHJldHVybiBzKHQpLmZvckVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgICBuLmFwcGVuZCh0KTsKICAgICAgfSksIGUudHlwZSA/IG4uZ2V0QmxvYihlLnR5cGUpIDogbi5nZXRCbG9iKCk7CiAgICB9CgogICAgZnVuY3Rpb24gYyh0LCBlKSB7CiAgICAgIHJldHVybiBuZXcgQmxvYihzKHQpLCBlIHx8IHt9KTsKICAgIH0KCiAgICAidW5kZWZpbmVkIiAhPSB0eXBlb2YgQmxvYiAmJiAoYS5wcm90b3R5cGUgPSBCbG9iLnByb3RvdHlwZSwgYy5wcm90b3R5cGUgPSBCbG9iLnByb3RvdHlwZSksIHQuZXhwb3J0cyA9IG4gPyBvID8gQmxvYiA6IGMgOiBpID8gYSA6IHZvaWQgMDsKICB9LCBmdW5jdGlvbiAodCwgZSkgewogICAgdC5leHBvcnRzID0gZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgdmFyIHIgPSBmdW5jdGlvbiByKCkge307CgogICAgICByLnByb3RvdHlwZSA9IGUucHJvdG90eXBlLCB0LnByb3RvdHlwZSA9IG5ldyByKCksIHQucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gdDsKICAgIH07CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgbiwKICAgICAgICBvID0gIjAxMjM0NTY3ODlBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWmFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6LV8iLnNwbGl0KCIiKSwKICAgICAgICBpID0ge30sCiAgICAgICAgcyA9IDAsCiAgICAgICAgYSA9IDA7CgogICAgZnVuY3Rpb24gYyh0KSB7CiAgICAgIHZhciBlID0gIiI7CgogICAgICBkbyB7CiAgICAgICAgZSA9IG9bdCAlIDY0XSArIGUsIHQgPSBNYXRoLmZsb29yKHQgLyA2NCk7CiAgICAgIH0gd2hpbGUgKHQgPiAwKTsKCiAgICAgIHJldHVybiBlOwogICAgfQoKICAgIGZ1bmN0aW9uIGgoKSB7CiAgICAgIHZhciB0ID0gYygrbmV3IERhdGUoKSk7CiAgICAgIHJldHVybiB0ICE9PSBuID8gKHMgPSAwLCBuID0gdCkgOiB0ICsgIi4iICsgYyhzKyspOwogICAgfQoKICAgIGZvciAoOyBhIDwgNjQ7IGErKykgewogICAgICBpW29bYV1dID0gYTsKICAgIH0KCiAgICBoLmVuY29kZSA9IGMsIGguZGVjb2RlID0gZnVuY3Rpb24gKHQpIHsKICAgICAgdmFyIGUgPSAwOwoKICAgICAgZm9yIChhID0gMDsgYSA8IHQubGVuZ3RoOyBhKyspIHsKICAgICAgICBlID0gNjQgKiBlICsgaVt0LmNoYXJBdChhKV07CiAgICAgIH0KCiAgICAgIHJldHVybiBlOwogICAgfSwgdC5leHBvcnRzID0gaDsKICB9LCBmdW5jdGlvbiAodCwgZSwgcikgewogICAgdmFyIG4gPSByKDM4KSwKICAgICAgICBfciA9IHIoMzkpLAogICAgICAgIG8gPSBfci5VUkwsCiAgICAgICAgX3IyID0gcig0NiksCiAgICAgICAgaSA9IF9yMi5hZGRFdmVudExpc3RlbmVyLAogICAgICAgIHMgPSBfcjIucmVtb3ZlRXZlbnRMaXN0ZW5lciwKICAgICAgICBhID0gcig0NyksCiAgICAgICAgYyA9IHIoMCkoInd4LXdzOnd4LXdzIiksCiAgICAgICAgaCA9IFsibm9kZWJ1ZmZlciIsICJhcnJheWJ1ZmZlciJdLAogICAgICAgIHUgPSBbIkNPTk5FQ1RJTkciLCAiT1BFTiIsICJDTE9TSU5HIiwgIkNMT1NFRCJdOwoKICAgIHZhciBmID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfbikgewogICAgICAidXNlIHN0cmljdCI7CgogICAgICBfaW5oZXJpdHMoZiwgX24pOwoKICAgICAgdmFyIF9zdXBlciA9IF9jcmVhdGVTdXBlcihmKTsKCiAgICAgIGZ1bmN0aW9uIGYodCwgZSwgcikgewogICAgICAgIHZhciBfdGhpczsKCiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIGYpOwoKICAgICAgICBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMpLCBjKCJjb25zdHJ1Y3RvcjogIiwgdCwgZSwgciksIF90aGlzLnJlYWR5U3RhdGUgPSBmLkNPTk5FQ1RJTkcsIF90aGlzLnByb3RvY29sID0gIiIsIF90aGlzLl9jbG9zZUNvZGUgPSAxMDA2LCBfdGhpcy5fY2xvc2VNZXNzYWdlID0gIiIsIF90aGlzLl9iaW5hcnlUeXBlID0gaFswXSwgX3RoaXMuX3NvY2tldCA9IG51bGwsIF90aGlzLnN1cHBvcnRzID0gewogICAgICAgICAgYmluYXJ5OiAhMAogICAgICAgIH0sIG51bGwgIT09IHQgJiYgKF90aGlzLl9idWZmZXJlZEFtb3VudCA9IDAsIF90aGlzLl9yZWRpcmVjdHMgPSAwLCAib2JqZWN0IiA9PSBfdHlwZW9mKGUpICYmIG51bGwgIT09IGUgJiYgKHIgPSBlLCBlID0gdm9pZCAwKSwgZnVuY3Rpb24gKHQsIGUsIHIsIG4pIHsKICAgICAgICAgIHZhciBvID0gX29iamVjdFNwcmVhZCh7CiAgICAgICAgICAgIG1heFBheWxvYWQ6IDEwNDg1NzYwMCwKICAgICAgICAgICAgcGVyTWVzc2FnZURlZmxhdGU6ICEwCiAgICAgICAgICB9LCBuKTsKCiAgICAgICAgICBjKCJpbml0QXNDbGllbnQ6IG9wdHM6ICIsIG8pLCB0LnVybCA9IGU7CgogICAgICAgICAgdmFyIGkgPSBmdW5jdGlvbiAodCwgZSkgewogICAgICAgICAgICBjKCJzdGFydCBjcmVhdGUgY29ubjogIiwgdCk7CiAgICAgICAgICAgIHZhciByID0gd3guY29ubmVjdFNvY2tldCh0KTsKICAgICAgICAgICAgaWYgKHIpIHJldHVybiByOwogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIG9uQ2xvc2U6IHd4Lm9uU29ja2V0Q2xvc2UsCiAgICAgICAgICAgICAgb25PcGVuOiB3eC5vblNvY2tldE9wZW4sCiAgICAgICAgICAgICAgb25FcnJvcjogd3gub25Tb2NrZXRFcnJvciwKICAgICAgICAgICAgICBvbk1lc3NhZ2U6IHd4Lm9uU29ja2V0TWVzc2FnZSwKICAgICAgICAgICAgICBzZW5kOiB3eC5zZW5kU29ja2V0TWVzc2FnZSwKICAgICAgICAgICAgICBjbG9zZTogd3guY2xvc2VTb2NrZXQKICAgICAgICAgICAgfTsKICAgICAgICAgIH0oewogICAgICAgICAgICB1cmw6IHQudXJsLAogICAgICAgICAgICBoZWFkZXI6IG8uaGVhZGVycywKICAgICAgICAgICAgcHJvdG9jb2xzOiByLAogICAgICAgICAgICBwZXJNZXNzYWdlRGVmbGF0ZTogISFvLnBlck1lc3NhZ2VEZWZsYXRlLAogICAgICAgICAgICB0Y3BOb0RlbGF5OiAhIW8udGNwTm9EZWxheQogICAgICAgICAgfSk7CgogICAgICAgICAgdC5zZXRTb2NrZXQoaSk7CiAgICAgICAgfShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgdCwgZSwgcikpOwogICAgICAgIHJldHVybiBfdGhpczsKICAgICAgfQoKICAgICAgX2NyZWF0ZUNsYXNzKGYsIFt7CiAgICAgICAga2V5OiAic2V0U29ja2V0IiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gc2V0U29ja2V0KHQsIGUpIHsKICAgICAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgICAgIHRoaXMuX3NvY2tldCA9IHQsIHRoaXMuX3NlbmRlciA9IG5ldyBhKHQpLCBjKCJzZXQgc29ja2V0OiBzb2NrZXQgPSIsIHQsICIsIGhlYWQgPSIsIGUsICIsIHRoaXM6ICIsIHRoaXMpLCB0aGlzLl9zb2NrZXQub25PcGVuKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIGMoInNvY2tldCBvbm9wZW46ICIsIHQpLCBfdGhpczIucmVhZHlTdGF0ZSA9IGYuT1BFTiwgX3RoaXMyLmVtaXQoIm9wZW4iLCB0KTsKICAgICAgICAgIH0pLCB0aGlzLl9zb2NrZXQub25DbG9zZShmdW5jdGlvbiAodCkgewogICAgICAgICAgICBjKCJzb2NrZXQgb25jbG9zZTogIiwgdCksIF90aGlzMi5fY2xvc2VDb2RlID0gdC5jb2RlLCBfdGhpczIuX2Nsb3NlTWVzc2FnZSA9IHQucmVhc29uLCBfdGhpczIuZW1pdENsb3NlKCk7CiAgICAgICAgICB9KSwgdGhpcy5fc29ja2V0Lm9uRXJyb3IoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgYygic29ja2V0IG9uZXJyb3I6ICIsIHQpLCBfdGhpczIuZW1pdCgiZXJyb3IiLCB0KTsKICAgICAgICAgIH0pLCB0aGlzLl9zb2NrZXQub25NZXNzYWdlKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIGMoInNvY2tldCBvbm1lc3NhZ2U6ICIsIHQsIF90aGlzMiksIF90aGlzMi5lbWl0KCJtZXNzYWdlIiwgdC5kYXRhKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImVtaXRDbG9zZSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGVtaXRDbG9zZSgpIHsKICAgICAgICAgIHRoaXMucmVhZHlTdGF0ZSA9IGYuQ0xPU0VELCB0aGlzLnJlbW92ZUV2ZW50TGlzdGVuZXIoKSwgdGhpcy5lbWl0KCJjbG9zZSIsIHRoaXMuX2Nsb3NlQ29kZSwgdGhpcy5fY2xvc2VNZXNzYWdlKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJzZW5kIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gc2VuZCh0LCBlLCByKSB7CiAgICAgICAgICBpZiAoYygic29ja2V0IHNlbmQgbXNnOiAiLCB0LCB0aGlzLnJlYWR5U3RhdGUsICIsIHNlbmRlcjogIiwgdGhpcy5fc2VuZGVyKSwgdGhpcy5yZWFkeVN0YXRlID09PSBmLkNPTk5FQ1RJTkcpIHRocm93IG5ldyBFcnJvcigiV2ViU29ja2V0IGlzIG5vdCBvcGVuOiByZWFkeVN0YXRlIDAgKENPTk5FQ1RJTkcpIik7CiAgICAgICAgICBpZiAoIm51bWJlciIgPT0gdHlwZW9mIHQgJiYgKHQgPSB0LnRvU3RyaW5nKCkpLCB0aGlzLnJlYWR5U3RhdGUgPT09IGYuT1BFTikgdGhpcy5fc2VuZGVyLnNlbmQodCwgZSwgcik7ZWxzZSBpZiAocikgewogICAgICAgICAgICByKG5ldyBFcnJvcigiV2ViU29ja2V0IGlzIG5vdCBvcGVuOiByZWFkeVN0YXRlICIuY29uY2F0KHRoaXMucmVhZHlTdGF0ZSwgIiAiKSArICIoIi5jb25jYXQodVt0aGlzLnJlYWR5U3RhdGVdLCAiKSIpKSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiY2xvc2UiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBjbG9zZSh0LCBlKSB7CiAgICAgICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgICAgICBpZiAoYygiY2xvc2luZyBjb25uZWN0aW9uOiAiLCB0aGlzLnJlYWR5U3RhdGUpLCB0aGlzLnJlYWR5U3RhdGUgIT09IGYuQ0xPU0VEKSB7CiAgICAgICAgICAgIGlmICh0aGlzLnJlYWR5U3RhdGUgPT09IGYuQ09OTkVDVElORykgewogICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiV2ViU29ja2V0IHdhcyBjbG9zZWQgYmVmb3JlIHRoZSBjb25uZWN0aW9uIHdhcyBlc3RhYmxpc2hlZCIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLnJlYWR5U3RhdGUgIT09IGYuQ0xPU0lORyAmJiAodGhpcy5yZWFkeVN0YXRlID0gZi5DTE9TSU5HLCB0aGlzLl9zb2NrZXQuY2xvc2UoewogICAgICAgICAgICAgIGNvZGU6IHQsCiAgICAgICAgICAgICAgcmVhc29uOiBlLAogICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIHN1Y2Nlc3MoKSB7CiAgICAgICAgICAgICAgICBjKCJjb25uZWN0aW9uIGNsb3NlZC4uLiIpLCBfdGhpczMucmVhZHlTdGF0ZSA9IGYuQ0xPU0VELCBfdGhpczMuX3NvY2tldCA9IG51bGw7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiQ09OTkVDVElORyIsCiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICByZXR1cm4gZi5DT05ORUNUSU5HOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogIkNMT1NJTkciLAogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgcmV0dXJuIGYuQ0xPU0lORzsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJDTE9TRUQiLAogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgcmV0dXJuIGYuQ0xPU0VEOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogIk9QRU4iLAogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgcmV0dXJuIGYuT1BFTjsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJidWZmZXJlZEFtb3VudCIsCiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5fc29ja2V0ID8gKHRoaXMuX3NvY2tldC5idWZmZXJTaXplIHx8IDApICsgdGhpcy5fc2VuZGVyLl9idWZmZXJlZEJ5dGVzIDogdGhpcy5fYnVmZmVyZWRBbW91bnQ7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiYmluYXJ5VHlwZSIsCiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5fYmluYXJ5VHlwZTsKICAgICAgICB9LAogICAgICAgIHNldDogZnVuY3Rpb24gc2V0KHQpIHsKICAgICAgICAgIGMoInNldCBiaW5hcnlUeXBlOiAiLCB0KSwgaC5pbmNsdWRlcyh0KSAmJiAodGhpcy5fYmluYXJ5VHlwZSA9IHQpOwogICAgICAgIH0KICAgICAgfV0pOwoKICAgICAgcmV0dXJuIGY7CiAgICB9KG4pOwoKICAgIHUuZm9yRWFjaChmdW5jdGlvbiAodCwgZSkgewogICAgICBmW3RdID0gZTsKICAgIH0pLCBbIm9wZW4iLCAiZXJyb3IiLCAiY2xvc2UiLCAibWVzc2FnZSJdLmZvckVhY2goZnVuY3Rpb24gKHQpIHsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGYucHJvdG90eXBlLCAib24iLmNvbmNhdCh0KSwgewogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgdmFyIGUgPSB0aGlzLmxpc3RlbmVycyh0KTsKCiAgICAgICAgICBmb3IgKHZhciBfdCA9IDA7IF90IDwgZS5sZW5ndGg7IF90KyspIHsKICAgICAgICAgICAgaWYgKGVbX3RdLl9saXN0ZW5lcikgcmV0dXJuIGVbX3RdLl9saXN0ZW5lcjsKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHNldDogZnVuY3Rpb24gc2V0KGUpIHsKICAgICAgICAgIHZhciByID0gdGhpcy5saXN0ZW5lcnModCk7CgogICAgICAgICAgZm9yICh2YXIgX2UgPSAwOyBfZSA8IHIubGVuZ3RoOyBfZSsrKSB7CiAgICAgICAgICAgIHJbX2VdLl9saXN0ZW5lciAmJiB0aGlzLnJlbW92ZUxpc3RlbmVyKHQsIHJbX2VdKTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLmFkZEV2ZW50TGlzdGVuZXIodCwgZSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0pLCBmLnByb3RvdHlwZS5hZGRFdmVudExpc3RlbmVyID0gaSwgZi5wcm90b3R5cGUucmVtb3ZlRXZlbnRMaXN0ZW5lciA9IHMsIHQuZXhwb3J0cyA9IGY7CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgbiwKICAgICAgICBvID0gIm9iamVjdCIgPT0gKHR5cGVvZiBSZWZsZWN0ID09PSAidW5kZWZpbmVkIiA/ICJ1bmRlZmluZWQiIDogX3R5cGVvZihSZWZsZWN0KSkgPyBSZWZsZWN0IDogbnVsbCwKICAgICAgICBpID0gbyAmJiAiZnVuY3Rpb24iID09IHR5cGVvZiBvLmFwcGx5ID8gby5hcHBseSA6IGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICAgIHJldHVybiBGdW5jdGlvbi5wcm90b3R5cGUuYXBwbHkuY2FsbCh0LCBlLCByKTsKICAgIH07CiAgICBuID0gbyAmJiAiZnVuY3Rpb24iID09IHR5cGVvZiBvLm93bktleXMgPyBvLm93bktleXMgOiBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzID8gZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKHQpLmNvbmNhdChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKHQpKTsKICAgIH0gOiBmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXModCk7CiAgICB9OwoKICAgIHZhciBzID0gTnVtYmVyLmlzTmFOIHx8IGZ1bmN0aW9uICh0KSB7CiAgICAgIHJldHVybiB0ICE9IHQ7CiAgICB9OwoKICAgIGZ1bmN0aW9uIGEoKSB7CiAgICAgIGEuaW5pdC5jYWxsKHRoaXMpOwogICAgfQoKICAgIHQuZXhwb3J0cyA9IGEsIGEuRXZlbnRFbWl0dGVyID0gYSwgYS5wcm90b3R5cGUuX2V2ZW50cyA9IHZvaWQgMCwgYS5wcm90b3R5cGUuX2V2ZW50c0NvdW50ID0gMCwgYS5wcm90b3R5cGUuX21heExpc3RlbmVycyA9IHZvaWQgMDsKICAgIHZhciBjID0gMTA7CgogICAgZnVuY3Rpb24gaCh0KSB7CiAgICAgIGlmICgiZnVuY3Rpb24iICE9IHR5cGVvZiB0KSB0aHJvdyBuZXcgVHlwZUVycm9yKCdUaGUgImxpc3RlbmVyIiBhcmd1bWVudCBtdXN0IGJlIG9mIHR5cGUgRnVuY3Rpb24uIFJlY2VpdmVkIHR5cGUgJyArIF90eXBlb2YodCkpOwogICAgfQoKICAgIGZ1bmN0aW9uIHUodCkgewogICAgICByZXR1cm4gdm9pZCAwID09PSB0Ll9tYXhMaXN0ZW5lcnMgPyBhLmRlZmF1bHRNYXhMaXN0ZW5lcnMgOiB0Ll9tYXhMaXN0ZW5lcnM7CiAgICB9CgogICAgZnVuY3Rpb24gZih0LCBlLCByLCBuKSB7CiAgICAgIHZhciBvLCBpLCBzLCBhOwogICAgICBpZiAoaChyKSwgdm9pZCAwID09PSAoaSA9IHQuX2V2ZW50cykgPyAoaSA9IHQuX2V2ZW50cyA9IE9iamVjdC5jcmVhdGUobnVsbCksIHQuX2V2ZW50c0NvdW50ID0gMCkgOiAodm9pZCAwICE9PSBpLm5ld0xpc3RlbmVyICYmICh0LmVtaXQoIm5ld0xpc3RlbmVyIiwgZSwgci5saXN0ZW5lciA/IHIubGlzdGVuZXIgOiByKSwgaSA9IHQuX2V2ZW50cyksIHMgPSBpW2VdKSwgdm9pZCAwID09PSBzKSBzID0gaVtlXSA9IHIsICsrdC5fZXZlbnRzQ291bnQ7ZWxzZSBpZiAoImZ1bmN0aW9uIiA9PSB0eXBlb2YgcyA/IHMgPSBpW2VdID0gbiA/IFtyLCBzXSA6IFtzLCByXSA6IG4gPyBzLnVuc2hpZnQocikgOiBzLnB1c2gociksIChvID0gdSh0KSkgPiAwICYmIHMubGVuZ3RoID4gbyAmJiAhcy53YXJuZWQpIHsKICAgICAgICBzLndhcm5lZCA9ICEwOwogICAgICAgIHZhciBjID0gbmV3IEVycm9yKCJQb3NzaWJsZSBFdmVudEVtaXR0ZXIgbWVtb3J5IGxlYWsgZGV0ZWN0ZWQuICIgKyBzLmxlbmd0aCArICIgIiArIFN0cmluZyhlKSArICIgbGlzdGVuZXJzIGFkZGVkLiBVc2UgZW1pdHRlci5zZXRNYXhMaXN0ZW5lcnMoKSB0byBpbmNyZWFzZSBsaW1pdCIpOwogICAgICAgIGMubmFtZSA9ICJNYXhMaXN0ZW5lcnNFeGNlZWRlZFdhcm5pbmciLCBjLmVtaXR0ZXIgPSB0LCBjLnR5cGUgPSBlLCBjLmNvdW50ID0gcy5sZW5ndGgsIGEgPSBjLCBjb25zb2xlICYmIGNvbnNvbGUud2FybiAmJiBjb25zb2xlLndhcm4oYSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHQ7CiAgICB9CgogICAgZnVuY3Rpb24gcCgpIHsKICAgICAgaWYgKCF0aGlzLmZpcmVkKSByZXR1cm4gdGhpcy50YXJnZXQucmVtb3ZlTGlzdGVuZXIodGhpcy50eXBlLCB0aGlzLndyYXBGbiksIHRoaXMuZmlyZWQgPSAhMCwgMCA9PT0gYXJndW1lbnRzLmxlbmd0aCA/IHRoaXMubGlzdGVuZXIuY2FsbCh0aGlzLnRhcmdldCkgOiB0aGlzLmxpc3RlbmVyLmFwcGx5KHRoaXMudGFyZ2V0LCBhcmd1bWVudHMpOwogICAgfQoKICAgIGZ1bmN0aW9uIGwodCwgZSwgcikgewogICAgICB2YXIgbiA9IHsKICAgICAgICBmaXJlZDogITEsCiAgICAgICAgd3JhcEZuOiB2b2lkIDAsCiAgICAgICAgdGFyZ2V0OiB0LAogICAgICAgIHR5cGU6IGUsCiAgICAgICAgbGlzdGVuZXI6IHIKICAgICAgfSwKICAgICAgICAgIG8gPSBwLmJpbmQobik7CiAgICAgIHJldHVybiBvLmxpc3RlbmVyID0gciwgbi53cmFwRm4gPSBvLCBvOwogICAgfQoKICAgIGZ1bmN0aW9uIGQodCwgZSwgcikgewogICAgICB2YXIgbiA9IHQuX2V2ZW50czsKICAgICAgaWYgKHZvaWQgMCA9PT0gbikgcmV0dXJuIFtdOwogICAgICB2YXIgbyA9IG5bZV07CiAgICAgIHJldHVybiB2b2lkIDAgPT09IG8gPyBbXSA6ICJmdW5jdGlvbiIgPT0gdHlwZW9mIG8gPyByID8gW28ubGlzdGVuZXIgfHwgb10gOiBbb10gOiByID8gZnVuY3Rpb24gKHQpIHsKICAgICAgICBmb3IgKHZhciBlID0gbmV3IEFycmF5KHQubGVuZ3RoKSwgciA9IDA7IHIgPCBlLmxlbmd0aDsgKytyKSB7CiAgICAgICAgICBlW3JdID0gdFtyXS5saXN0ZW5lciB8fCB0W3JdOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGU7CiAgICAgIH0obykgOiBnKG8sIG8ubGVuZ3RoKTsKICAgIH0KCiAgICBmdW5jdGlvbiB5KHQpIHsKICAgICAgdmFyIGUgPSB0aGlzLl9ldmVudHM7CgogICAgICBpZiAodm9pZCAwICE9PSBlKSB7CiAgICAgICAgdmFyIHIgPSBlW3RdOwogICAgICAgIGlmICgiZnVuY3Rpb24iID09IHR5cGVvZiByKSByZXR1cm4gMTsKICAgICAgICBpZiAodm9pZCAwICE9PSByKSByZXR1cm4gci5sZW5ndGg7CiAgICAgIH0KCiAgICAgIHJldHVybiAwOwogICAgfQoKICAgIGZ1bmN0aW9uIGcodCwgZSkgewogICAgICBmb3IgKHZhciByID0gbmV3IEFycmF5KGUpLCBuID0gMDsgbiA8IGU7ICsrbikgewogICAgICAgIHJbbl0gPSB0W25dOwogICAgICB9CgogICAgICByZXR1cm4gcjsKICAgIH0KCiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoYSwgImRlZmF1bHRNYXhMaXN0ZW5lcnMiLCB7CiAgICAgIGVudW1lcmFibGU6ICEwLAogICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICByZXR1cm4gYzsKICAgICAgfSwKICAgICAgc2V0OiBmdW5jdGlvbiBzZXQodCkgewogICAgICAgIGlmICgibnVtYmVyIiAhPSB0eXBlb2YgdCB8fCB0IDwgMCB8fCBzKHQpKSB0aHJvdyBuZXcgUmFuZ2VFcnJvcignVGhlIHZhbHVlIG9mICJkZWZhdWx0TWF4TGlzdGVuZXJzIiBpcyBvdXQgb2YgcmFuZ2UuIEl0IG11c3QgYmUgYSBub24tbmVnYXRpdmUgbnVtYmVyLiBSZWNlaXZlZCAnICsgdCArICIuIik7CiAgICAgICAgYyA9IHQ7CiAgICAgIH0KICAgIH0pLCBhLmluaXQgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHZvaWQgMCAhPT0gdGhpcy5fZXZlbnRzICYmIHRoaXMuX2V2ZW50cyAhPT0gT2JqZWN0LmdldFByb3RvdHlwZU9mKHRoaXMpLl9ldmVudHMgfHwgKHRoaXMuX2V2ZW50cyA9IE9iamVjdC5jcmVhdGUobnVsbCksIHRoaXMuX2V2ZW50c0NvdW50ID0gMCksIHRoaXMuX21heExpc3RlbmVycyA9IHRoaXMuX21heExpc3RlbmVycyB8fCB2b2lkIDA7CiAgICB9LCBhLnByb3RvdHlwZS5zZXRNYXhMaXN0ZW5lcnMgPSBmdW5jdGlvbiAodCkgewogICAgICBpZiAoIm51bWJlciIgIT0gdHlwZW9mIHQgfHwgdCA8IDAgfHwgcyh0KSkgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ1RoZSB2YWx1ZSBvZiAibiIgaXMgb3V0IG9mIHJhbmdlLiBJdCBtdXN0IGJlIGEgbm9uLW5lZ2F0aXZlIG51bWJlci4gUmVjZWl2ZWQgJyArIHQgKyAiLiIpOwogICAgICByZXR1cm4gdGhpcy5fbWF4TGlzdGVuZXJzID0gdCwgdGhpczsKICAgIH0sIGEucHJvdG90eXBlLmdldE1heExpc3RlbmVycyA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHUodGhpcyk7CiAgICB9LCBhLnByb3RvdHlwZS5lbWl0ID0gZnVuY3Rpb24gKHQpIHsKICAgICAgZm9yICh2YXIgZSA9IFtdLCByID0gMTsgciA8IGFyZ3VtZW50cy5sZW5ndGg7IHIrKykgewogICAgICAgIGUucHVzaChhcmd1bWVudHNbcl0pOwogICAgICB9CgogICAgICB2YXIgbiA9ICJlcnJvciIgPT09IHQsCiAgICAgICAgICBvID0gdGhpcy5fZXZlbnRzOwogICAgICBpZiAodm9pZCAwICE9PSBvKSBuID0gbiAmJiB2b2lkIDAgPT09IG8uZXJyb3I7ZWxzZSBpZiAoIW4pIHJldHVybiAhMTsKCiAgICAgIGlmIChuKSB7CiAgICAgICAgdmFyIHM7CiAgICAgICAgaWYgKGUubGVuZ3RoID4gMCAmJiAocyA9IGVbMF0pLCBzIGluc3RhbmNlb2YgRXJyb3IpIHRocm93IHM7CiAgICAgICAgdmFyIGEgPSBuZXcgRXJyb3IoIlVuaGFuZGxlZCBlcnJvci4iICsgKHMgPyAiICgiICsgcy5tZXNzYWdlICsgIikiIDogIiIpKTsKICAgICAgICB0aHJvdyBhLmNvbnRleHQgPSBzLCBhOwogICAgICB9CgogICAgICB2YXIgYyA9IG9bdF07CiAgICAgIGlmICh2b2lkIDAgPT09IGMpIHJldHVybiAhMTsKICAgICAgaWYgKCJmdW5jdGlvbiIgPT0gdHlwZW9mIGMpIGkoYywgdGhpcywgZSk7ZWxzZSB7CiAgICAgICAgdmFyIGggPSBjLmxlbmd0aCwKICAgICAgICAgICAgdSA9IGcoYywgaCk7CgogICAgICAgIGZvciAociA9IDA7IHIgPCBoOyArK3IpIHsKICAgICAgICAgIGkodVtyXSwgdGhpcywgZSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiAhMDsKICAgIH0sIGEucHJvdG90eXBlLmFkZExpc3RlbmVyID0gZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgcmV0dXJuIGYodGhpcywgdCwgZSwgITEpOwogICAgfSwgYS5wcm90b3R5cGUub24gPSBhLnByb3RvdHlwZS5hZGRMaXN0ZW5lciwgYS5wcm90b3R5cGUucHJlcGVuZExpc3RlbmVyID0gZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgcmV0dXJuIGYodGhpcywgdCwgZSwgITApOwogICAgfSwgYS5wcm90b3R5cGUub25jZSA9IGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgIHJldHVybiBoKGUpLCB0aGlzLm9uKHQsIGwodGhpcywgdCwgZSkpLCB0aGlzOwogICAgfSwgYS5wcm90b3R5cGUucHJlcGVuZE9uY2VMaXN0ZW5lciA9IGZ1bmN0aW9uICh0LCBlKSB7CiAgICAgIHJldHVybiBoKGUpLCB0aGlzLnByZXBlbmRMaXN0ZW5lcih0LCBsKHRoaXMsIHQsIGUpKSwgdGhpczsKICAgIH0sIGEucHJvdG90eXBlLnJlbW92ZUxpc3RlbmVyID0gZnVuY3Rpb24gKHQsIGUpIHsKICAgICAgdmFyIHIsIG4sIG8sIGksIHM7CiAgICAgIGlmIChoKGUpLCB2b2lkIDAgPT09IChuID0gdGhpcy5fZXZlbnRzKSkgcmV0dXJuIHRoaXM7CiAgICAgIGlmICh2b2lkIDAgPT09IChyID0gblt0XSkpIHJldHVybiB0aGlzOwogICAgICBpZiAociA9PT0gZSB8fCByLmxpc3RlbmVyID09PSBlKSAwID09IC0tdGhpcy5fZXZlbnRzQ291bnQgPyB0aGlzLl9ldmVudHMgPSBPYmplY3QuY3JlYXRlKG51bGwpIDogKGRlbGV0ZSBuW3RdLCBuLnJlbW92ZUxpc3RlbmVyICYmIHRoaXMuZW1pdCgicmVtb3ZlTGlzdGVuZXIiLCB0LCByLmxpc3RlbmVyIHx8IGUpKTtlbHNlIGlmICgiZnVuY3Rpb24iICE9IHR5cGVvZiByKSB7CiAgICAgICAgZm9yIChvID0gLTEsIGkgPSByLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgICAgICBpZiAocltpXSA9PT0gZSB8fCByW2ldLmxpc3RlbmVyID09PSBlKSB7CiAgICAgICAgICAgIHMgPSByW2ldLmxpc3RlbmVyLCBvID0gaTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAobyA8IDApIHJldHVybiB0aGlzOwogICAgICAgIDAgPT09IG8gPyByLnNoaWZ0KCkgOiBmdW5jdGlvbiAodCwgZSkgewogICAgICAgICAgZm9yICg7IGUgKyAxIDwgdC5sZW5ndGg7IGUrKykgewogICAgICAgICAgICB0W2VdID0gdFtlICsgMV07CiAgICAgICAgICB9CgogICAgICAgICAgdC5wb3AoKTsKICAgICAgICB9KHIsIG8pLCAxID09PSByLmxlbmd0aCAmJiAoblt0XSA9IHJbMF0pLCB2b2lkIDAgIT09IG4ucmVtb3ZlTGlzdGVuZXIgJiYgdGhpcy5lbWl0KCJyZW1vdmVMaXN0ZW5lciIsIHQsIHMgfHwgZSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LCBhLnByb3RvdHlwZS5vZmYgPSBhLnByb3RvdHlwZS5yZW1vdmVMaXN0ZW5lciwgYS5wcm90b3R5cGUucmVtb3ZlQWxsTGlzdGVuZXJzID0gZnVuY3Rpb24gKHQpIHsKICAgICAgdmFyIGUsIHIsIG47CiAgICAgIGlmICh2b2lkIDAgPT09IChyID0gdGhpcy5fZXZlbnRzKSkgcmV0dXJuIHRoaXM7CiAgICAgIGlmICh2b2lkIDAgPT09IHIucmVtb3ZlTGlzdGVuZXIpIHJldHVybiAwID09PSBhcmd1bWVudHMubGVuZ3RoID8gKHRoaXMuX2V2ZW50cyA9IE9iamVjdC5jcmVhdGUobnVsbCksIHRoaXMuX2V2ZW50c0NvdW50ID0gMCkgOiB2b2lkIDAgIT09IHJbdF0gJiYgKDAgPT0gLS10aGlzLl9ldmVudHNDb3VudCA/IHRoaXMuX2V2ZW50cyA9IE9iamVjdC5jcmVhdGUobnVsbCkgOiBkZWxldGUgclt0XSksIHRoaXM7CgogICAgICBpZiAoMCA9PT0gYXJndW1lbnRzLmxlbmd0aCkgewogICAgICAgIHZhciBvLAogICAgICAgICAgICBpID0gT2JqZWN0LmtleXMocik7CgogICAgICAgIGZvciAobiA9IDA7IG4gPCBpLmxlbmd0aDsgKytuKSB7CiAgICAgICAgICAicmVtb3ZlTGlzdGVuZXIiICE9PSAobyA9IGlbbl0pICYmIHRoaXMucmVtb3ZlQWxsTGlzdGVuZXJzKG8pOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRoaXMucmVtb3ZlQWxsTGlzdGVuZXJzKCJyZW1vdmVMaXN0ZW5lciIpLCB0aGlzLl9ldmVudHMgPSBPYmplY3QuY3JlYXRlKG51bGwpLCB0aGlzLl9ldmVudHNDb3VudCA9IDAsIHRoaXM7CiAgICAgIH0KCiAgICAgIGlmICgiZnVuY3Rpb24iID09IHR5cGVvZiAoZSA9IHJbdF0pKSB0aGlzLnJlbW92ZUxpc3RlbmVyKHQsIGUpO2Vsc2UgaWYgKHZvaWQgMCAhPT0gZSkgZm9yIChuID0gZS5sZW5ndGggLSAxOyBuID49IDA7IG4tLSkgewogICAgICAgIHRoaXMucmVtb3ZlTGlzdGVuZXIodCwgZVtuXSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LCBhLnByb3RvdHlwZS5saXN0ZW5lcnMgPSBmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gZCh0aGlzLCB0LCAhMCk7CiAgICB9LCBhLnByb3RvdHlwZS5yYXdMaXN0ZW5lcnMgPSBmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gZCh0aGlzLCB0LCAhMSk7CiAgICB9LCBhLmxpc3RlbmVyQ291bnQgPSBmdW5jdGlvbiAodCwgZSkgewogICAgICByZXR1cm4gImZ1bmN0aW9uIiA9PSB0eXBlb2YgdC5saXN0ZW5lckNvdW50ID8gdC5saXN0ZW5lckNvdW50KGUpIDogeS5jYWxsKHQsIGUpOwogICAgfSwgYS5wcm90b3R5cGUubGlzdGVuZXJDb3VudCA9IHksIGEucHJvdG90eXBlLmV2ZW50TmFtZXMgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiB0aGlzLl9ldmVudHNDb3VudCA+IDAgPyBuKHRoaXMuX2V2ZW50cykgOiBbXTsKICAgIH07CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgbiA9IHIoNDApLAogICAgICAgIG8gPSByKDQyKTsKCiAgICBmdW5jdGlvbiBpKCkgewogICAgICB0aGlzLnByb3RvY29sID0gbnVsbCwgdGhpcy5zbGFzaGVzID0gbnVsbCwgdGhpcy5hdXRoID0gbnVsbCwgdGhpcy5ob3N0ID0gbnVsbCwgdGhpcy5wb3J0ID0gbnVsbCwgdGhpcy5ob3N0bmFtZSA9IG51bGwsIHRoaXMuaGFzaCA9IG51bGwsIHRoaXMuc2VhcmNoID0gbnVsbCwgdGhpcy5xdWVyeSA9IG51bGwsIHRoaXMucGF0aG5hbWUgPSBudWxsLCB0aGlzLnBhdGggPSBudWxsLCB0aGlzLmhyZWYgPSBudWxsOwogICAgfQoKICAgIGUucGFyc2UgPSBiLCBlLnJlc29sdmUgPSBmdW5jdGlvbiAodCwgZSkgewogICAgICByZXR1cm4gYih0LCAhMSwgITApLnJlc29sdmUoZSk7CiAgICB9LCBlLnJlc29sdmVPYmplY3QgPSBmdW5jdGlvbiAodCwgZSkgewogICAgICByZXR1cm4gdCA/IGIodCwgITEsICEwKS5yZXNvbHZlT2JqZWN0KGUpIDogZTsKICAgIH0sIGUuZm9ybWF0ID0gZnVuY3Rpb24gKHQpIHsKICAgICAgby5pc1N0cmluZyh0KSAmJiAodCA9IGIodCkpOwogICAgICByZXR1cm4gdCBpbnN0YW5jZW9mIGkgPyB0LmZvcm1hdCgpIDogaS5wcm90b3R5cGUuZm9ybWF0LmNhbGwodCk7CiAgICB9LCBlLlVybCA9IGk7CiAgICB2YXIgcyA9IC9eKFthLXowLTkuKy1dKzopL2ksCiAgICAgICAgYSA9IC86WzAtOV0qJC8sCiAgICAgICAgYyA9IC9eKFwvXC8/KD8hXC8pW15cP1xzXSopKFw/W15cc10qKT8kLywKICAgICAgICBoID0gWyJ7IiwgIn0iLCAifCIsICJcXCIsICJeIiwgImAiXS5jb25jYXQoWyI8IiwgIj4iLCAnIicsICJgIiwgIiAiLCAiXHIiLCAiXG4iLCAiXHQiXSksCiAgICAgICAgdSA9IFsiJyJdLmNvbmNhdChoKSwKICAgICAgICBmID0gWyIlIiwgIi8iLCAiPyIsICI7IiwgIiMiXS5jb25jYXQodSksCiAgICAgICAgcCA9IFsiLyIsICI/IiwgIiMiXSwKICAgICAgICBsID0gL15bK2EtejAtOUEtWl8tXXswLDYzfSQvLAogICAgICAgIGQgPSAvXihbK2EtejAtOUEtWl8tXXswLDYzfSkoLiopJC8sCiAgICAgICAgeSA9IHsKICAgICAgamF2YXNjcmlwdDogITAsCiAgICAgICJqYXZhc2NyaXB0OiI6ICEwCiAgICB9LAogICAgICAgIGcgPSB7CiAgICAgIGphdmFzY3JpcHQ6ICEwLAogICAgICAiamF2YXNjcmlwdDoiOiAhMAogICAgfSwKICAgICAgICB2ID0gewogICAgICBodHRwOiAhMCwKICAgICAgaHR0cHM6ICEwLAogICAgICBmdHA6ICEwLAogICAgICBnb3BoZXI6ICEwLAogICAgICBmaWxlOiAhMCwKICAgICAgImh0dHA6IjogITAsCiAgICAgICJodHRwczoiOiAhMCwKICAgICAgImZ0cDoiOiAhMCwKICAgICAgImdvcGhlcjoiOiAhMCwKICAgICAgImZpbGU6IjogITAKICAgIH0sCiAgICAgICAgbSA9IHIoNDMpOwoKICAgIGZ1bmN0aW9uIGIodCwgZSwgcikgewogICAgICBpZiAodCAmJiBvLmlzT2JqZWN0KHQpICYmIHQgaW5zdGFuY2VvZiBpKSByZXR1cm4gdDsKICAgICAgdmFyIG4gPSBuZXcgaSgpOwogICAgICByZXR1cm4gbi5wYXJzZSh0LCBlLCByKSwgbjsKICAgIH0KCiAgICBpLnByb3RvdHlwZS5wYXJzZSA9IGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICAgIGlmICghby5pc1N0cmluZyh0KSkgdGhyb3cgbmV3IFR5cGVFcnJvcigiUGFyYW1ldGVyICd1cmwnIG11c3QgYmUgYSBzdHJpbmcsIG5vdCAiICsgX3R5cGVvZih0KSk7CiAgICAgIHZhciBpID0gdC5pbmRleE9mKCI/IiksCiAgICAgICAgICBhID0gLTEgIT09IGkgJiYgaSA8IHQuaW5kZXhPZigiIyIpID8gIj8iIDogIiMiLAogICAgICAgICAgaCA9IHQuc3BsaXQoYSk7CiAgICAgIGhbMF0gPSBoWzBdLnJlcGxhY2UoL1xcL2csICIvIik7CiAgICAgIHZhciBiID0gdCA9IGguam9pbihhKTsKCiAgICAgIGlmIChiID0gYi50cmltKCksICFyICYmIDEgPT09IHQuc3BsaXQoIiMiKS5sZW5ndGgpIHsKICAgICAgICB2YXIgdyA9IGMuZXhlYyhiKTsKICAgICAgICBpZiAodykgcmV0dXJuIHRoaXMucGF0aCA9IGIsIHRoaXMuaHJlZiA9IGIsIHRoaXMucGF0aG5hbWUgPSB3WzFdLCB3WzJdID8gKHRoaXMuc2VhcmNoID0gd1syXSwgdGhpcy5xdWVyeSA9IGUgPyBtLnBhcnNlKHRoaXMuc2VhcmNoLnN1YnN0cigxKSkgOiB0aGlzLnNlYXJjaC5zdWJzdHIoMSkpIDogZSAmJiAodGhpcy5zZWFyY2ggPSAiIiwgdGhpcy5xdWVyeSA9IHt9KSwgdGhpczsKICAgICAgfQoKICAgICAgdmFyIEEgPSBzLmV4ZWMoYik7CgogICAgICBpZiAoQSkgewogICAgICAgIHZhciBrID0gKEEgPSBBWzBdKS50b0xvd2VyQ2FzZSgpOwogICAgICAgIHRoaXMucHJvdG9jb2wgPSBrLCBiID0gYi5zdWJzdHIoQS5sZW5ndGgpOwogICAgICB9CgogICAgICBpZiAociB8fCBBIHx8IGIubWF0Y2goL15cL1wvW15AXC9dK0BbXkBcL10rLykpIHsKICAgICAgICB2YXIgXyA9ICIvLyIgPT09IGIuc3Vic3RyKDAsIDIpOwoKICAgICAgICAhXyB8fCBBICYmIGdbQV0gfHwgKGIgPSBiLnN1YnN0cigyKSwgdGhpcy5zbGFzaGVzID0gITApOwogICAgICB9CgogICAgICBpZiAoIWdbQV0gJiYgKF8gfHwgQSAmJiAhdltBXSkpIHsKICAgICAgICBmb3IgKHZhciBFLCBCLCBTID0gLTEsIEMgPSAwOyBDIDwgcC5sZW5ndGg7IEMrKykgewogICAgICAgICAgLTEgIT09IChSID0gYi5pbmRleE9mKHBbQ10pKSAmJiAoLTEgPT09IFMgfHwgUiA8IFMpICYmIChTID0gUik7CiAgICAgICAgfQoKICAgICAgICAtMSAhPT0gKEIgPSAtMSA9PT0gUyA/IGIubGFzdEluZGV4T2YoIkAiKSA6IGIubGFzdEluZGV4T2YoIkAiLCBTKSkgJiYgKEUgPSBiLnNsaWNlKDAsIEIpLCBiID0gYi5zbGljZShCICsgMSksIHRoaXMuYXV0aCA9IGRlY29kZVVSSUNvbXBvbmVudChFKSksIFMgPSAtMTsKCiAgICAgICAgZm9yIChDID0gMDsgQyA8IGYubGVuZ3RoOyBDKyspIHsKICAgICAgICAgIHZhciBSOwogICAgICAgICAgLTEgIT09IChSID0gYi5pbmRleE9mKGZbQ10pKSAmJiAoLTEgPT09IFMgfHwgUiA8IFMpICYmIChTID0gUik7CiAgICAgICAgfQoKICAgICAgICAtMSA9PT0gUyAmJiAoUyA9IGIubGVuZ3RoKSwgdGhpcy5ob3N0ID0gYi5zbGljZSgwLCBTKSwgYiA9IGIuc2xpY2UoUyksIHRoaXMucGFyc2VIb3N0KCksIHRoaXMuaG9zdG5hbWUgPSB0aGlzLmhvc3RuYW1lIHx8ICIiOwogICAgICAgIHZhciBPID0gIlsiID09PSB0aGlzLmhvc3RuYW1lWzBdICYmICJdIiA9PT0gdGhpcy5ob3N0bmFtZVt0aGlzLmhvc3RuYW1lLmxlbmd0aCAtIDFdOwogICAgICAgIGlmICghTykgZm9yICh2YXIgeCA9IHRoaXMuaG9zdG5hbWUuc3BsaXQoL1wuLyksIFAgPSAoQyA9IDAsIHgubGVuZ3RoKTsgQyA8IFA7IEMrKykgewogICAgICAgICAgdmFyIFQgPSB4W0NdOwoKICAgICAgICAgIGlmIChUICYmICFULm1hdGNoKGwpKSB7CiAgICAgICAgICAgIGZvciAodmFyIE4gPSAiIiwgTCA9IDAsIGogPSBULmxlbmd0aDsgTCA8IGo7IEwrKykgewogICAgICAgICAgICAgIFQuY2hhckNvZGVBdChMKSA+IDEyNyA/IE4gKz0gIngiIDogTiArPSBUW0xdOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoIU4ubWF0Y2gobCkpIHsKICAgICAgICAgICAgICB2YXIgSSA9IHguc2xpY2UoMCwgQyksCiAgICAgICAgICAgICAgICAgIFUgPSB4LnNsaWNlKEMgKyAxKSwKICAgICAgICAgICAgICAgICAgTSA9IFQubWF0Y2goZCk7CiAgICAgICAgICAgICAgTSAmJiAoSS5wdXNoKE1bMV0pLCBVLnVuc2hpZnQoTVsyXSkpLCBVLmxlbmd0aCAmJiAoYiA9ICIvIiArIFUuam9pbigiLiIpICsgYiksIHRoaXMuaG9zdG5hbWUgPSBJLmpvaW4oIi4iKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB0aGlzLmhvc3RuYW1lLmxlbmd0aCA+IDI1NSA/IHRoaXMuaG9zdG5hbWUgPSAiIiA6IHRoaXMuaG9zdG5hbWUgPSB0aGlzLmhvc3RuYW1lLnRvTG93ZXJDYXNlKCksIE8gfHwgKHRoaXMuaG9zdG5hbWUgPSBuLnRvQVNDSUkodGhpcy5ob3N0bmFtZSkpOwogICAgICAgIHZhciBEID0gdGhpcy5wb3J0ID8gIjoiICsgdGhpcy5wb3J0IDogIiIsCiAgICAgICAgICAgIHEgPSB0aGlzLmhvc3RuYW1lIHx8ICIiOwogICAgICAgIHRoaXMuaG9zdCA9IHEgKyBELCB0aGlzLmhyZWYgKz0gdGhpcy5ob3N0LCBPICYmICh0aGlzLmhvc3RuYW1lID0gdGhpcy5ob3N0bmFtZS5zdWJzdHIoMSwgdGhpcy5ob3N0bmFtZS5sZW5ndGggLSAyKSwgIi8iICE9PSBiWzBdICYmIChiID0gIi8iICsgYikpOwogICAgICB9CgogICAgICBpZiAoIXlba10pIGZvciAoQyA9IDAsIFAgPSB1Lmxlbmd0aDsgQyA8IFA7IEMrKykgewogICAgICAgIHZhciBZID0gdVtDXTsKCiAgICAgICAgaWYgKC0xICE9PSBiLmluZGV4T2YoWSkpIHsKICAgICAgICAgIHZhciBGID0gZW5jb2RlVVJJQ29tcG9uZW50KFkpOwogICAgICAgICAgRiA9PT0gWSAmJiAoRiA9IGVzY2FwZShZKSksIGIgPSBiLnNwbGl0KFkpLmpvaW4oRik7CiAgICAgICAgfQogICAgICB9CiAgICAgIHZhciB6ID0gYi5pbmRleE9mKCIjIik7CiAgICAgIC0xICE9PSB6ICYmICh0aGlzLmhhc2ggPSBiLnN1YnN0cih6KSwgYiA9IGIuc2xpY2UoMCwgeikpOwogICAgICB2YXIgVyA9IGIuaW5kZXhPZigiPyIpOwoKICAgICAgaWYgKC0xICE9PSBXID8gKHRoaXMuc2VhcmNoID0gYi5zdWJzdHIoVyksIHRoaXMucXVlcnkgPSBiLnN1YnN0cihXICsgMSksIGUgJiYgKHRoaXMucXVlcnkgPSBtLnBhcnNlKHRoaXMucXVlcnkpKSwgYiA9IGIuc2xpY2UoMCwgVykpIDogZSAmJiAodGhpcy5zZWFyY2ggPSAiIiwgdGhpcy5xdWVyeSA9IHt9KSwgYiAmJiAodGhpcy5wYXRobmFtZSA9IGIpLCB2W2tdICYmIHRoaXMuaG9zdG5hbWUgJiYgIXRoaXMucGF0aG5hbWUgJiYgKHRoaXMucGF0aG5hbWUgPSAiLyIpLCB0aGlzLnBhdGhuYW1lIHx8IHRoaXMuc2VhcmNoKSB7CiAgICAgICAgRCA9IHRoaXMucGF0aG5hbWUgfHwgIiI7CiAgICAgICAgdmFyIEggPSB0aGlzLnNlYXJjaCB8fCAiIjsKICAgICAgICB0aGlzLnBhdGggPSBEICsgSDsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXMuaHJlZiA9IHRoaXMuZm9ybWF0KCksIHRoaXM7CiAgICB9LCBpLnByb3RvdHlwZS5mb3JtYXQgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciB0ID0gdGhpcy5hdXRoIHx8ICIiOwogICAgICB0ICYmICh0ID0gKHQgPSBlbmNvZGVVUklDb21wb25lbnQodCkpLnJlcGxhY2UoLyUzQS9pLCAiOiIpLCB0ICs9ICJAIik7CiAgICAgIHZhciBlID0gdGhpcy5wcm90b2NvbCB8fCAiIiwKICAgICAgICAgIHIgPSB0aGlzLnBhdGhuYW1lIHx8ICIiLAogICAgICAgICAgbiA9IHRoaXMuaGFzaCB8fCAiIiwKICAgICAgICAgIGkgPSAhMSwKICAgICAgICAgIHMgPSAiIjsKICAgICAgdGhpcy5ob3N0ID8gaSA9IHQgKyB0aGlzLmhvc3QgOiB0aGlzLmhvc3RuYW1lICYmIChpID0gdCArICgtMSA9PT0gdGhpcy5ob3N0bmFtZS5pbmRleE9mKCI6IikgPyB0aGlzLmhvc3RuYW1lIDogIlsiICsgdGhpcy5ob3N0bmFtZSArICJdIiksIHRoaXMucG9ydCAmJiAoaSArPSAiOiIgKyB0aGlzLnBvcnQpKSwgdGhpcy5xdWVyeSAmJiBvLmlzT2JqZWN0KHRoaXMucXVlcnkpICYmIE9iamVjdC5rZXlzKHRoaXMucXVlcnkpLmxlbmd0aCAmJiAocyA9IG0uc3RyaW5naWZ5KHRoaXMucXVlcnkpKTsKICAgICAgdmFyIGEgPSB0aGlzLnNlYXJjaCB8fCBzICYmICI/IiArIHMgfHwgIiI7CiAgICAgIHJldHVybiBlICYmICI6IiAhPT0gZS5zdWJzdHIoLTEpICYmIChlICs9ICI6IiksIHRoaXMuc2xhc2hlcyB8fCAoIWUgfHwgdltlXSkgJiYgITEgIT09IGkgPyAoaSA9ICIvLyIgKyAoaSB8fCAiIiksIHIgJiYgIi8iICE9PSByLmNoYXJBdCgwKSAmJiAociA9ICIvIiArIHIpKSA6IGkgfHwgKGkgPSAiIiksIG4gJiYgIiMiICE9PSBuLmNoYXJBdCgwKSAmJiAobiA9ICIjIiArIG4pLCBhICYmICI/IiAhPT0gYS5jaGFyQXQoMCkgJiYgKGEgPSAiPyIgKyBhKSwgZSArIGkgKyAociA9IHIucmVwbGFjZSgvWz8jXS9nLCBmdW5jdGlvbiAodCkgewogICAgICAgIHJldHVybiBlbmNvZGVVUklDb21wb25lbnQodCk7CiAgICAgIH0pKSArIChhID0gYS5yZXBsYWNlKCIjIiwgIiUyMyIpKSArIG47CiAgICB9LCBpLnByb3RvdHlwZS5yZXNvbHZlID0gZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIHRoaXMucmVzb2x2ZU9iamVjdChiKHQsICExLCAhMCkpLmZvcm1hdCgpOwogICAgfSwgaS5wcm90b3R5cGUucmVzb2x2ZU9iamVjdCA9IGZ1bmN0aW9uICh0KSB7CiAgICAgIGlmIChvLmlzU3RyaW5nKHQpKSB7CiAgICAgICAgdmFyIGUgPSBuZXcgaSgpOwogICAgICAgIGUucGFyc2UodCwgITEsICEwKSwgdCA9IGU7CiAgICAgIH0KCiAgICAgIGZvciAodmFyIHIgPSBuZXcgaSgpLCBuID0gT2JqZWN0LmtleXModGhpcyksIHMgPSAwOyBzIDwgbi5sZW5ndGg7IHMrKykgewogICAgICAgIHZhciBhID0gbltzXTsKICAgICAgICByW2FdID0gdGhpc1thXTsKICAgICAgfQoKICAgICAgaWYgKHIuaGFzaCA9IHQuaGFzaCwgIiIgPT09IHQuaHJlZikgcmV0dXJuIHIuaHJlZiA9IHIuZm9ybWF0KCksIHI7CgogICAgICBpZiAodC5zbGFzaGVzICYmICF0LnByb3RvY29sKSB7CiAgICAgICAgZm9yICh2YXIgYyA9IE9iamVjdC5rZXlzKHQpLCBoID0gMDsgaCA8IGMubGVuZ3RoOyBoKyspIHsKICAgICAgICAgIHZhciB1ID0gY1toXTsKICAgICAgICAgICJwcm90b2NvbCIgIT09IHUgJiYgKHJbdV0gPSB0W3VdKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB2W3IucHJvdG9jb2xdICYmIHIuaG9zdG5hbWUgJiYgIXIucGF0aG5hbWUgJiYgKHIucGF0aCA9IHIucGF0aG5hbWUgPSAiLyIpLCByLmhyZWYgPSByLmZvcm1hdCgpLCByOwogICAgICB9CgogICAgICBpZiAodC5wcm90b2NvbCAmJiB0LnByb3RvY29sICE9PSByLnByb3RvY29sKSB7CiAgICAgICAgaWYgKCF2W3QucHJvdG9jb2xdKSB7CiAgICAgICAgICBmb3IgKHZhciBmID0gT2JqZWN0LmtleXModCksIHAgPSAwOyBwIDwgZi5sZW5ndGg7IHArKykgewogICAgICAgICAgICB2YXIgbCA9IGZbcF07CiAgICAgICAgICAgIHJbbF0gPSB0W2xdOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiByLmhyZWYgPSByLmZvcm1hdCgpLCByOwogICAgICAgIH0KCiAgICAgICAgaWYgKHIucHJvdG9jb2wgPSB0LnByb3RvY29sLCB0Lmhvc3QgfHwgZ1t0LnByb3RvY29sXSkgci5wYXRobmFtZSA9IHQucGF0aG5hbWU7ZWxzZSB7CiAgICAgICAgICBmb3IgKHZhciBkID0gKHQucGF0aG5hbWUgfHwgIiIpLnNwbGl0KCIvIik7IGQubGVuZ3RoICYmICEodC5ob3N0ID0gZC5zaGlmdCgpKTspIHsKICAgICAgICAgICAgOwogICAgICAgICAgfQoKICAgICAgICAgIHQuaG9zdCB8fCAodC5ob3N0ID0gIiIpLCB0Lmhvc3RuYW1lIHx8ICh0Lmhvc3RuYW1lID0gIiIpLCAiIiAhPT0gZFswXSAmJiBkLnVuc2hpZnQoIiIpLCBkLmxlbmd0aCA8IDIgJiYgZC51bnNoaWZ0KCIiKSwgci5wYXRobmFtZSA9IGQuam9pbigiLyIpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHIuc2VhcmNoID0gdC5zZWFyY2gsIHIucXVlcnkgPSB0LnF1ZXJ5LCByLmhvc3QgPSB0Lmhvc3QgfHwgIiIsIHIuYXV0aCA9IHQuYXV0aCwgci5ob3N0bmFtZSA9IHQuaG9zdG5hbWUgfHwgdC5ob3N0LCByLnBvcnQgPSB0LnBvcnQsIHIucGF0aG5hbWUgfHwgci5zZWFyY2gpIHsKICAgICAgICAgIHZhciB5ID0gci5wYXRobmFtZSB8fCAiIiwKICAgICAgICAgICAgICBtID0gci5zZWFyY2ggfHwgIiI7CiAgICAgICAgICByLnBhdGggPSB5ICsgbTsKICAgICAgICB9CgogICAgICAgIHJldHVybiByLnNsYXNoZXMgPSByLnNsYXNoZXMgfHwgdC5zbGFzaGVzLCByLmhyZWYgPSByLmZvcm1hdCgpLCByOwogICAgICB9CgogICAgICB2YXIgYiA9IHIucGF0aG5hbWUgJiYgIi8iID09PSByLnBhdGhuYW1lLmNoYXJBdCgwKSwKICAgICAgICAgIHcgPSB0Lmhvc3QgfHwgdC5wYXRobmFtZSAmJiAiLyIgPT09IHQucGF0aG5hbWUuY2hhckF0KDApLAogICAgICAgICAgQSA9IHcgfHwgYiB8fCByLmhvc3QgJiYgdC5wYXRobmFtZSwKICAgICAgICAgIGsgPSBBLAogICAgICAgICAgXyA9IHIucGF0aG5hbWUgJiYgci5wYXRobmFtZS5zcGxpdCgiLyIpIHx8IFtdLAogICAgICAgICAgRSA9IChkID0gdC5wYXRobmFtZSAmJiB0LnBhdGhuYW1lLnNwbGl0KCIvIikgfHwgW10sIHIucHJvdG9jb2wgJiYgIXZbci5wcm90b2NvbF0pOwoKICAgICAgaWYgKEUgJiYgKHIuaG9zdG5hbWUgPSAiIiwgci5wb3J0ID0gbnVsbCwgci5ob3N0ICYmICgiIiA9PT0gX1swXSA/IF9bMF0gPSByLmhvc3QgOiBfLnVuc2hpZnQoci5ob3N0KSksIHIuaG9zdCA9ICIiLCB0LnByb3RvY29sICYmICh0Lmhvc3RuYW1lID0gbnVsbCwgdC5wb3J0ID0gbnVsbCwgdC5ob3N0ICYmICgiIiA9PT0gZFswXSA/IGRbMF0gPSB0Lmhvc3QgOiBkLnVuc2hpZnQodC5ob3N0KSksIHQuaG9zdCA9IG51bGwpLCBBID0gQSAmJiAoIiIgPT09IGRbMF0gfHwgIiIgPT09IF9bMF0pKSwgdykgci5ob3N0ID0gdC5ob3N0IHx8ICIiID09PSB0Lmhvc3QgPyB0Lmhvc3QgOiByLmhvc3QsIHIuaG9zdG5hbWUgPSB0Lmhvc3RuYW1lIHx8ICIiID09PSB0Lmhvc3RuYW1lID8gdC5ob3N0bmFtZSA6IHIuaG9zdG5hbWUsIHIuc2VhcmNoID0gdC5zZWFyY2gsIHIucXVlcnkgPSB0LnF1ZXJ5LCBfID0gZDtlbHNlIGlmIChkLmxlbmd0aCkgXyB8fCAoXyA9IFtdKSwgXy5wb3AoKSwgXyA9IF8uY29uY2F0KGQpLCByLnNlYXJjaCA9IHQuc2VhcmNoLCByLnF1ZXJ5ID0gdC5xdWVyeTtlbHNlIGlmICghby5pc051bGxPclVuZGVmaW5lZCh0LnNlYXJjaCkpIHsKICAgICAgICBpZiAoRSkgci5ob3N0bmFtZSA9IHIuaG9zdCA9IF8uc2hpZnQoKSwgKE8gPSAhIShyLmhvc3QgJiYgci5ob3N0LmluZGV4T2YoIkAiKSA+IDApICYmIHIuaG9zdC5zcGxpdCgiQCIpKSAmJiAoci5hdXRoID0gTy5zaGlmdCgpLCByLmhvc3QgPSByLmhvc3RuYW1lID0gTy5zaGlmdCgpKTsKICAgICAgICByZXR1cm4gci5zZWFyY2ggPSB0LnNlYXJjaCwgci5xdWVyeSA9IHQucXVlcnksIG8uaXNOdWxsKHIucGF0aG5hbWUpICYmIG8uaXNOdWxsKHIuc2VhcmNoKSB8fCAoci5wYXRoID0gKHIucGF0aG5hbWUgPyByLnBhdGhuYW1lIDogIiIpICsgKHIuc2VhcmNoID8gci5zZWFyY2ggOiAiIikpLCByLmhyZWYgPSByLmZvcm1hdCgpLCByOwogICAgICB9CiAgICAgIGlmICghXy5sZW5ndGgpIHJldHVybiByLnBhdGhuYW1lID0gbnVsbCwgci5zZWFyY2ggPyByLnBhdGggPSAiLyIgKyByLnNlYXJjaCA6IHIucGF0aCA9IG51bGwsIHIuaHJlZiA9IHIuZm9ybWF0KCksIHI7CgogICAgICBmb3IgKHZhciBCID0gXy5zbGljZSgtMSlbMF0sIFMgPSAoci5ob3N0IHx8IHQuaG9zdCB8fCBfLmxlbmd0aCA+IDEpICYmICgiLiIgPT09IEIgfHwgIi4uIiA9PT0gQikgfHwgIiIgPT09IEIsIEMgPSAwLCBSID0gXy5sZW5ndGg7IFIgPj0gMDsgUi0tKSB7CiAgICAgICAgIi4iID09PSAoQiA9IF9bUl0pID8gXy5zcGxpY2UoUiwgMSkgOiAiLi4iID09PSBCID8gKF8uc3BsaWNlKFIsIDEpLCBDKyspIDogQyAmJiAoXy5zcGxpY2UoUiwgMSksIEMtLSk7CiAgICAgIH0KCiAgICAgIGlmICghQSAmJiAhaykgZm9yICg7IEMtLTsgQykgewogICAgICAgIF8udW5zaGlmdCgiLi4iKTsKICAgICAgfQogICAgICAhQSB8fCAiIiA9PT0gX1swXSB8fCBfWzBdICYmICIvIiA9PT0gX1swXS5jaGFyQXQoMCkgfHwgXy51bnNoaWZ0KCIiKSwgUyAmJiAiLyIgIT09IF8uam9pbigiLyIpLnN1YnN0cigtMSkgJiYgXy5wdXNoKCIiKTsKCiAgICAgIHZhciBPLAogICAgICAgICAgeCA9ICIiID09PSBfWzBdIHx8IF9bMF0gJiYgIi8iID09PSBfWzBdLmNoYXJBdCgwKTsKCiAgICAgIEUgJiYgKHIuaG9zdG5hbWUgPSByLmhvc3QgPSB4ID8gIiIgOiBfLmxlbmd0aCA/IF8uc2hpZnQoKSA6ICIiLCAoTyA9ICEhKHIuaG9zdCAmJiByLmhvc3QuaW5kZXhPZigiQCIpID4gMCkgJiYgci5ob3N0LnNwbGl0KCJAIikpICYmIChyLmF1dGggPSBPLnNoaWZ0KCksIHIuaG9zdCA9IHIuaG9zdG5hbWUgPSBPLnNoaWZ0KCkpKTsKICAgICAgcmV0dXJuIChBID0gQSB8fCByLmhvc3QgJiYgXy5sZW5ndGgpICYmICF4ICYmIF8udW5zaGlmdCgiIiksIF8ubGVuZ3RoID8gci5wYXRobmFtZSA9IF8uam9pbigiLyIpIDogKHIucGF0aG5hbWUgPSBudWxsLCByLnBhdGggPSBudWxsKSwgby5pc051bGwoci5wYXRobmFtZSkgJiYgby5pc051bGwoci5zZWFyY2gpIHx8IChyLnBhdGggPSAoci5wYXRobmFtZSA/IHIucGF0aG5hbWUgOiAiIikgKyAoci5zZWFyY2ggPyByLnNlYXJjaCA6ICIiKSksIHIuYXV0aCA9IHQuYXV0aCB8fCByLmF1dGgsIHIuc2xhc2hlcyA9IHIuc2xhc2hlcyB8fCB0LnNsYXNoZXMsIHIuaHJlZiA9IHIuZm9ybWF0KCksIHI7CiAgICB9LCBpLnByb3RvdHlwZS5wYXJzZUhvc3QgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciB0ID0gdGhpcy5ob3N0LAogICAgICAgICAgZSA9IGEuZXhlYyh0KTsKICAgICAgZSAmJiAoIjoiICE9PSAoZSA9IGVbMF0pICYmICh0aGlzLnBvcnQgPSBlLnN1YnN0cigxKSksIHQgPSB0LnN1YnN0cigwLCB0Lmxlbmd0aCAtIGUubGVuZ3RoKSksIHQgJiYgKHRoaXMuaG9zdG5hbWUgPSB0KTsKICAgIH07CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgIChmdW5jdGlvbiAodCwgbikgewogICAgICB2YXIgbzsKICAgICAgLyohIGh0dHBzOi8vbXRocy5iZS9wdW55Y29kZSB2MS40LjEgYnkgQG1hdGhpYXMgKi8KCiAgICAgICFmdW5jdGlvbiAoaSkgewogICAgICAgIGUgJiYgZS5ub2RlVHlwZSwgdCAmJiB0Lm5vZGVUeXBlOwogICAgICAgIHZhciBzID0gIm9iamVjdCIgPT0gX3R5cGVvZihuKSAmJiBuOwogICAgICAgIHMuZ2xvYmFsICE9PSBzICYmIHMud2luZG93ICE9PSBzICYmIHMuc2VsZjsKICAgICAgICB2YXIgYSwKICAgICAgICAgICAgYyA9IDIxNDc0ODM2NDcsCiAgICAgICAgICAgIGggPSAvXnhuLS0vLAogICAgICAgICAgICB1ID0gL1teXHgyMC1ceDdFXS8sCiAgICAgICAgICAgIGYgPSAvW1x4MkVcdTMwMDJcdUZGMEVcdUZGNjFdL2csCiAgICAgICAgICAgIHAgPSB7CiAgICAgICAgICBvdmVyZmxvdzogIk92ZXJmbG93OiBpbnB1dCBuZWVkcyB3aWRlciBpbnRlZ2VycyB0byBwcm9jZXNzIiwKICAgICAgICAgICJub3QtYmFzaWMiOiAiSWxsZWdhbCBpbnB1dCA+PSAweDgwIChub3QgYSBiYXNpYyBjb2RlIHBvaW50KSIsCiAgICAgICAgICAiaW52YWxpZC1pbnB1dCI6ICJJbnZhbGlkIGlucHV0IgogICAgICAgIH0sCiAgICAgICAgICAgIGwgPSBNYXRoLmZsb29yLAogICAgICAgICAgICBkID0gU3RyaW5nLmZyb21DaGFyQ29kZTsKCiAgICAgICAgZnVuY3Rpb24geSh0KSB7CiAgICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcihwW3RdKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGcodCwgZSkgewogICAgICAgICAgZm9yICh2YXIgciA9IHQubGVuZ3RoLCBuID0gW107IHItLTspIHsKICAgICAgICAgICAgbltyXSA9IGUodFtyXSk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIG47CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiB2KHQsIGUpIHsKICAgICAgICAgIHZhciByID0gdC5zcGxpdCgiQCIpLAogICAgICAgICAgICAgIG4gPSAiIjsKICAgICAgICAgIHJldHVybiByLmxlbmd0aCA+IDEgJiYgKG4gPSByWzBdICsgIkAiLCB0ID0gclsxXSksIG4gKyBnKCh0ID0gdC5yZXBsYWNlKGYsICIuIikpLnNwbGl0KCIuIiksIGUpLmpvaW4oIi4iKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIG0odCkgewogICAgICAgICAgZm9yICh2YXIgZSwgciwgbiA9IFtdLCBvID0gMCwgaSA9IHQubGVuZ3RoOyBvIDwgaTspIHsKICAgICAgICAgICAgKGUgPSB0LmNoYXJDb2RlQXQobysrKSkgPj0gNTUyOTYgJiYgZSA8PSA1NjMxOSAmJiBvIDwgaSA/IDU2MzIwID09ICg2NDUxMiAmIChyID0gdC5jaGFyQ29kZUF0KG8rKykpKSA/IG4ucHVzaCgoKDEwMjMgJiBlKSA8PCAxMCkgKyAoMTAyMyAmIHIpICsgNjU1MzYpIDogKG4ucHVzaChlKSwgby0tKSA6IG4ucHVzaChlKTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gbjsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGIodCkgewogICAgICAgICAgcmV0dXJuIGcodCwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgdmFyIGUgPSAiIjsKICAgICAgICAgICAgcmV0dXJuIHQgPiA2NTUzNSAmJiAoZSArPSBkKCh0IC09IDY1NTM2KSA+Pj4gMTAgJiAxMDIzIHwgNTUyOTYpLCB0ID0gNTYzMjAgfCAxMDIzICYgdCksIGUgKz0gZCh0KTsKICAgICAgICAgIH0pLmpvaW4oIiIpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gdyh0LCBlKSB7CiAgICAgICAgICByZXR1cm4gdCArIDIyICsgNzUgKiAodCA8IDI2KSAtICgoMCAhPSBlKSA8PCA1KTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIEEodCwgZSwgcikgewogICAgICAgICAgdmFyIG4gPSAwOwoKICAgICAgICAgIGZvciAodCA9IHIgPyBsKHQgLyA3MDApIDogdCA+PiAxLCB0ICs9IGwodCAvIGUpOyB0ID4gNDU1OyBuICs9IDM2KSB7CiAgICAgICAgICAgIHQgPSBsKHQgLyAzNSk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIGwobiArIDM2ICogdCAvICh0ICsgMzgpKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGsodCkgewogICAgICAgICAgdmFyIGUsCiAgICAgICAgICAgICAgciwKICAgICAgICAgICAgICBuLAogICAgICAgICAgICAgIG8sCiAgICAgICAgICAgICAgaSwKICAgICAgICAgICAgICBzLAogICAgICAgICAgICAgIGEsCiAgICAgICAgICAgICAgaCwKICAgICAgICAgICAgICB1LAogICAgICAgICAgICAgIGYsCiAgICAgICAgICAgICAgcCwKICAgICAgICAgICAgICBkID0gW10sCiAgICAgICAgICAgICAgZyA9IHQubGVuZ3RoLAogICAgICAgICAgICAgIHYgPSAwLAogICAgICAgICAgICAgIG0gPSAxMjgsCiAgICAgICAgICAgICAgdyA9IDcyOwoKICAgICAgICAgIGZvciAoKHIgPSB0Lmxhc3RJbmRleE9mKCItIikpIDwgMCAmJiAociA9IDApLCBuID0gMDsgbiA8IHI7ICsrbikgewogICAgICAgICAgICB0LmNoYXJDb2RlQXQobikgPj0gMTI4ICYmIHkoIm5vdC1iYXNpYyIpLCBkLnB1c2godC5jaGFyQ29kZUF0KG4pKTsKICAgICAgICAgIH0KCiAgICAgICAgICBmb3IgKG8gPSByID4gMCA/IHIgKyAxIDogMDsgbyA8IGc7KSB7CiAgICAgICAgICAgIGZvciAoaSA9IHYsIHMgPSAxLCBhID0gMzY7IG8gPj0gZyAmJiB5KCJpbnZhbGlkLWlucHV0IiksICgoaCA9IChwID0gdC5jaGFyQ29kZUF0KG8rKykpIC0gNDggPCAxMCA/IHAgLSAyMiA6IHAgLSA2NSA8IDI2ID8gcCAtIDY1IDogcCAtIDk3IDwgMjYgPyBwIC0gOTcgOiAzNikgPj0gMzYgfHwgaCA+IGwoKGMgLSB2KSAvIHMpKSAmJiB5KCJvdmVyZmxvdyIpLCB2ICs9IGggKiBzLCAhKGggPCAodSA9IGEgPD0gdyA/IDEgOiBhID49IHcgKyAyNiA/IDI2IDogYSAtIHcpKTsgYSArPSAzNikgewogICAgICAgICAgICAgIHMgPiBsKGMgLyAoZiA9IDM2IC0gdSkpICYmIHkoIm92ZXJmbG93IiksIHMgKj0gZjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdyA9IEEodiAtIGksIGUgPSBkLmxlbmd0aCArIDEsIDAgPT0gaSksIGwodiAvIGUpID4gYyAtIG0gJiYgeSgib3ZlcmZsb3ciKSwgbSArPSBsKHYgLyBlKSwgdiAlPSBlLCBkLnNwbGljZSh2KyssIDAsIG0pOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBiKGQpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gXyh0KSB7CiAgICAgICAgICB2YXIgZSwKICAgICAgICAgICAgICByLAogICAgICAgICAgICAgIG4sCiAgICAgICAgICAgICAgbywKICAgICAgICAgICAgICBpLAogICAgICAgICAgICAgIHMsCiAgICAgICAgICAgICAgYSwKICAgICAgICAgICAgICBoLAogICAgICAgICAgICAgIHUsCiAgICAgICAgICAgICAgZiwKICAgICAgICAgICAgICBwLAogICAgICAgICAgICAgIGcsCiAgICAgICAgICAgICAgdiwKICAgICAgICAgICAgICBiLAogICAgICAgICAgICAgIGssCiAgICAgICAgICAgICAgXyA9IFtdOwoKICAgICAgICAgIGZvciAoZyA9ICh0ID0gbSh0KSkubGVuZ3RoLCBlID0gMTI4LCByID0gMCwgaSA9IDcyLCBzID0gMDsgcyA8IGc7ICsrcykgewogICAgICAgICAgICAocCA9IHRbc10pIDwgMTI4ICYmIF8ucHVzaChkKHApKTsKICAgICAgICAgIH0KCiAgICAgICAgICBmb3IgKG4gPSBvID0gXy5sZW5ndGgsIG8gJiYgXy5wdXNoKCItIik7IG4gPCBnOykgewogICAgICAgICAgICBmb3IgKGEgPSBjLCBzID0gMDsgcyA8IGc7ICsrcykgewogICAgICAgICAgICAgIChwID0gdFtzXSkgPj0gZSAmJiBwIDwgYSAmJiAoYSA9IHApOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmb3IgKGEgLSBlID4gbCgoYyAtIHIpIC8gKHYgPSBuICsgMSkpICYmIHkoIm92ZXJmbG93IiksIHIgKz0gKGEgLSBlKSAqIHYsIGUgPSBhLCBzID0gMDsgcyA8IGc7ICsrcykgewogICAgICAgICAgICAgIGlmICgocCA9IHRbc10pIDwgZSAmJiArK3IgPiBjICYmIHkoIm92ZXJmbG93IiksIHAgPT0gZSkgewogICAgICAgICAgICAgICAgZm9yIChoID0gciwgdSA9IDM2OyAhKGggPCAoZiA9IHUgPD0gaSA/IDEgOiB1ID49IGkgKyAyNiA/IDI2IDogdSAtIGkpKTsgdSArPSAzNikgewogICAgICAgICAgICAgICAgICBrID0gaCAtIGYsIGIgPSAzNiAtIGYsIF8ucHVzaChkKHcoZiArIGsgJSBiLCAwKSkpLCBoID0gbChrIC8gYik7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgXy5wdXNoKGQodyhoLCAwKSkpLCBpID0gQShyLCB2LCBuID09IG8pLCByID0gMCwgKytuOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgKytyLCArK2U7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIF8uam9pbigiIik7CiAgICAgICAgfQoKICAgICAgICBhID0gewogICAgICAgICAgdmVyc2lvbjogIjEuNC4xIiwKICAgICAgICAgIHVjczI6IHsKICAgICAgICAgICAgZGVjb2RlOiBtLAogICAgICAgICAgICBlbmNvZGU6IGIKICAgICAgICAgIH0sCiAgICAgICAgICBkZWNvZGU6IGssCiAgICAgICAgICBlbmNvZGU6IF8sCiAgICAgICAgICB0b0FTQ0lJOiBmdW5jdGlvbiB0b0FTQ0lJKHQpIHsKICAgICAgICAgICAgcmV0dXJuIHYodCwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICByZXR1cm4gdS50ZXN0KHQpID8gInhuLS0iICsgXyh0KSA6IHQ7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSwKICAgICAgICAgIHRvVW5pY29kZTogZnVuY3Rpb24gdG9Vbmljb2RlKHQpIHsKICAgICAgICAgICAgcmV0dXJuIHYodCwgZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICByZXR1cm4gaC50ZXN0KHQpID8gayh0LnNsaWNlKDQpLnRvTG93ZXJDYXNlKCkpIDogdDsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSwgdm9pZCAwID09PSAobyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiBhOwogICAgICAgIH0uY2FsbChlLCByLCBlLCB0KSkgfHwgKHQuZXhwb3J0cyA9IG8pOwogICAgICB9KCk7CiAgICB9KS5jYWxsKHRoaXMsIHIoNDEpKHQpLCByKDkpKTsKICB9LCBmdW5jdGlvbiAodCwgZSkgewogICAgdC5leHBvcnRzID0gZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIHQud2VicGFja1BvbHlmaWxsIHx8ICh0LmRlcHJlY2F0ZSA9IGZ1bmN0aW9uICgpIHt9LCB0LnBhdGhzID0gW10sIHQuY2hpbGRyZW4gfHwgKHQuY2hpbGRyZW4gPSBbXSksIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LCAibG9hZGVkIiwgewogICAgICAgIGVudW1lcmFibGU6ICEwLAogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgcmV0dXJuIHQubDsKICAgICAgICB9CiAgICAgIH0pLCBPYmplY3QuZGVmaW5lUHJvcGVydHkodCwgImlkIiwgewogICAgICAgIGVudW1lcmFibGU6ICEwLAogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgcmV0dXJuIHQuaTsKICAgICAgICB9CiAgICAgIH0pLCB0LndlYnBhY2tQb2x5ZmlsbCA9IDEpLCB0OwogICAgfTsKICB9LCBmdW5jdGlvbiAodCwgZSwgcikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHQuZXhwb3J0cyA9IHsKICAgICAgaXNTdHJpbmc6IGZ1bmN0aW9uIGlzU3RyaW5nKHQpIHsKICAgICAgICByZXR1cm4gInN0cmluZyIgPT0gdHlwZW9mIHQ7CiAgICAgIH0sCiAgICAgIGlzT2JqZWN0OiBmdW5jdGlvbiBpc09iamVjdCh0KSB7CiAgICAgICAgcmV0dXJuICJvYmplY3QiID09IF90eXBlb2YodCkgJiYgbnVsbCAhPT0gdDsKICAgICAgfSwKICAgICAgaXNOdWxsOiBmdW5jdGlvbiBpc051bGwodCkgewogICAgICAgIHJldHVybiBudWxsID09PSB0OwogICAgICB9LAogICAgICBpc051bGxPclVuZGVmaW5lZDogZnVuY3Rpb24gaXNOdWxsT3JVbmRlZmluZWQodCkgewogICAgICAgIHJldHVybiBudWxsID09IHQ7CiAgICAgIH0KICAgIH07CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICBlLmRlY29kZSA9IGUucGFyc2UgPSByKDQ0KSwgZS5lbmNvZGUgPSBlLnN0cmluZ2lmeSA9IHIoNDUpOwogIH0sIGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgZnVuY3Rpb24gbih0LCBlKSB7CiAgICAgIHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwodCwgZSk7CiAgICB9CgogICAgdC5leHBvcnRzID0gZnVuY3Rpb24gKHQsIGUsIHIsIGkpIHsKICAgICAgZSA9IGUgfHwgIiYiLCByID0gciB8fCAiPSI7CiAgICAgIHZhciBzID0ge307CiAgICAgIGlmICgic3RyaW5nIiAhPSB0eXBlb2YgdCB8fCAwID09PSB0Lmxlbmd0aCkgcmV0dXJuIHM7CiAgICAgIHZhciBhID0gL1wrL2c7CiAgICAgIHQgPSB0LnNwbGl0KGUpOwogICAgICB2YXIgYyA9IDFlMzsKICAgICAgaSAmJiAibnVtYmVyIiA9PSB0eXBlb2YgaS5tYXhLZXlzICYmIChjID0gaS5tYXhLZXlzKTsKICAgICAgdmFyIGggPSB0Lmxlbmd0aDsKICAgICAgYyA+IDAgJiYgaCA+IGMgJiYgKGggPSBjKTsKCiAgICAgIGZvciAodmFyIHUgPSAwOyB1IDwgaDsgKyt1KSB7CiAgICAgICAgdmFyIGYsCiAgICAgICAgICAgIHAsCiAgICAgICAgICAgIGwsCiAgICAgICAgICAgIGQsCiAgICAgICAgICAgIHkgPSB0W3VdLnJlcGxhY2UoYSwgIiUyMCIpLAogICAgICAgICAgICBnID0geS5pbmRleE9mKHIpOwogICAgICAgIGcgPj0gMCA/IChmID0geS5zdWJzdHIoMCwgZyksIHAgPSB5LnN1YnN0cihnICsgMSkpIDogKGYgPSB5LCBwID0gIiIpLCBsID0gZGVjb2RlVVJJQ29tcG9uZW50KGYpLCBkID0gZGVjb2RlVVJJQ29tcG9uZW50KHApLCBuKHMsIGwpID8gbyhzW2xdKSA/IHNbbF0ucHVzaChkKSA6IHNbbF0gPSBbc1tsXSwgZF0gOiBzW2xdID0gZDsKICAgICAgfQoKICAgICAgcmV0dXJuIHM7CiAgICB9OwoKICAgIHZhciBvID0gQXJyYXkuaXNBcnJheSB8fCBmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gIltvYmplY3QgQXJyYXldIiA9PT0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHQpOwogICAgfTsKICB9LCBmdW5jdGlvbiAodCwgZSwgcikgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciBuID0gZnVuY3Rpb24gbih0KSB7CiAgICAgIHN3aXRjaCAoX3R5cGVvZih0KSkgewogICAgICAgIGNhc2UgInN0cmluZyI6CiAgICAgICAgICByZXR1cm4gdDsKCiAgICAgICAgY2FzZSAiYm9vbGVhbiI6CiAgICAgICAgICByZXR1cm4gdCA/ICJ0cnVlIiA6ICJmYWxzZSI7CgogICAgICAgIGNhc2UgIm51bWJlciI6CiAgICAgICAgICByZXR1cm4gaXNGaW5pdGUodCkgPyB0IDogIiI7CgogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICByZXR1cm4gIiI7CiAgICAgIH0KICAgIH07CgogICAgdC5leHBvcnRzID0gZnVuY3Rpb24gKHQsIGUsIHIsIGEpIHsKICAgICAgcmV0dXJuIGUgPSBlIHx8ICImIiwgciA9IHIgfHwgIj0iLCBudWxsID09PSB0ICYmICh0ID0gdm9pZCAwKSwgIm9iamVjdCIgPT0gX3R5cGVvZih0KSA/IGkocyh0KSwgZnVuY3Rpb24gKHMpIHsKICAgICAgICB2YXIgYSA9IGVuY29kZVVSSUNvbXBvbmVudChuKHMpKSArIHI7CiAgICAgICAgcmV0dXJuIG8odFtzXSkgPyBpKHRbc10sIGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICByZXR1cm4gYSArIGVuY29kZVVSSUNvbXBvbmVudChuKHQpKTsKICAgICAgICB9KS5qb2luKGUpIDogYSArIGVuY29kZVVSSUNvbXBvbmVudChuKHRbc10pKTsKICAgICAgfSkuam9pbihlKSA6IGEgPyBlbmNvZGVVUklDb21wb25lbnQobihhKSkgKyByICsgZW5jb2RlVVJJQ29tcG9uZW50KG4odCkpIDogIiI7CiAgICB9OwoKICAgIHZhciBvID0gQXJyYXkuaXNBcnJheSB8fCBmdW5jdGlvbiAodCkgewogICAgICByZXR1cm4gIltvYmplY3QgQXJyYXldIiA9PT0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHQpOwogICAgfTsKCiAgICBmdW5jdGlvbiBpKHQsIGUpIHsKICAgICAgaWYgKHQubWFwKSByZXR1cm4gdC5tYXAoZSk7CgogICAgICBmb3IgKHZhciByID0gW10sIG4gPSAwOyBuIDwgdC5sZW5ndGg7IG4rKykgewogICAgICAgIHIucHVzaChlKHRbbl0sIG4pKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHI7CiAgICB9CgogICAgdmFyIHMgPSBPYmplY3Qua2V5cyB8fCBmdW5jdGlvbiAodCkgewogICAgICB2YXIgZSA9IFtdOwoKICAgICAgZm9yICh2YXIgciBpbiB0KSB7CiAgICAgICAgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHQsIHIpICYmIGUucHVzaChyKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGU7CiAgICB9OwogIH0sIGZ1bmN0aW9uICh0LCBlLCByKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIG4gPSBmdW5jdGlvbiBuKHQsIGUpIHsKICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIG4pOwoKICAgICAgdGhpcy50YXJnZXQgPSBlLCB0aGlzLnR5cGUgPSB0OwogICAgfTsKCiAgICB2YXIgbyA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX24yKSB7CiAgICAgIF9pbmhlcml0cyhvLCBfbjIpOwoKICAgICAgdmFyIF9zdXBlcjIgPSBfY3JlYXRlU3VwZXIobyk7CgogICAgICBmdW5jdGlvbiBvKHQsIGUpIHsKICAgICAgICB2YXIgX3RoaXM0OwoKICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgbyk7CgogICAgICAgIF90aGlzNCA9IF9zdXBlcjIuY2FsbCh0aGlzLCAibWVzc2FnZSIsIGUpLCBfdGhpczQuZGF0YSA9IHQ7CiAgICAgICAgcmV0dXJuIF90aGlzNDsKICAgICAgfQoKICAgICAgcmV0dXJuIG87CiAgICB9KG4pOwoKICAgIHZhciBpID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfbjMpIHsKICAgICAgX2luaGVyaXRzKGksIF9uMyk7CgogICAgICB2YXIgX3N1cGVyMyA9IF9jcmVhdGVTdXBlcihpKTsKCiAgICAgIGZ1bmN0aW9uIGkodCwgZSwgcikgewogICAgICAgIHZhciBfdGhpczU7CgogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBpKTsKCiAgICAgICAgX3RoaXM1ID0gX3N1cGVyMy5jYWxsKHRoaXMsICJjbG9zZSIsIHIpLCBfdGhpczUud2FzQ2xlYW4gPSByLl9jbG9zZUZyYW1lUmVjZWl2ZWQgJiYgci5fY2xvc2VGcmFtZVNlbnQsIF90aGlzNS5yZWFzb24gPSBlLCBfdGhpczUuY29kZSA9IHQ7CiAgICAgICAgcmV0dXJuIF90aGlzNTsKICAgICAgfQoKICAgICAgcmV0dXJuIGk7CiAgICB9KG4pOwoKICAgIHZhciBzID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfbjQpIHsKICAgICAgX2luaGVyaXRzKHMsIF9uNCk7CgogICAgICB2YXIgX3N1cGVyNCA9IF9jcmVhdGVTdXBlcihzKTsKCiAgICAgIGZ1bmN0aW9uIHModCkgewogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBzKTsKCiAgICAgICAgcmV0dXJuIF9zdXBlcjQuY2FsbCh0aGlzLCAib3BlbiIsIHQpOwogICAgICB9CgogICAgICByZXR1cm4gczsKICAgIH0obik7CgogICAgdmFyIGEgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9uNSkgewogICAgICBfaW5oZXJpdHMoYSwgX241KTsKCiAgICAgIHZhciBfc3VwZXI1ID0gX2NyZWF0ZVN1cGVyKGEpOwoKICAgICAgZnVuY3Rpb24gYSh0LCBlKSB7CiAgICAgICAgdmFyIF90aGlzNjsKCiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIGEpOwoKICAgICAgICBfdGhpczYgPSBfc3VwZXI1LmNhbGwodGhpcywgImVycm9yIiwgZSksIF90aGlzNi5tZXNzYWdlID0gdC5tZXNzYWdlLCBfdGhpczYuZXJyb3IgPSB0OwogICAgICAgIHJldHVybiBfdGhpczY7CiAgICAgIH0KCiAgICAgIHJldHVybiBhOwogICAgfShuKTsKCiAgICB2YXIgYyA9IHsKICAgICAgYWRkRXZlbnRMaXN0ZW5lcjogZnVuY3Rpb24gYWRkRXZlbnRMaXN0ZW5lcih0LCBlKSB7CiAgICAgICAgZnVuY3Rpb24gcih0KSB7CiAgICAgICAgICBlLmNhbGwodGhpcywgbmV3IG8odCwgdGhpcykpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gbih0LCByKSB7CiAgICAgICAgICBlLmNhbGwodGhpcywgbmV3IGkodCwgciwgdGhpcykpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gYyh0KSB7CiAgICAgICAgICBlLmNhbGwodGhpcywgbmV3IGEodCwgdGhpcykpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gaCgpIHsKICAgICAgICAgIGUuY2FsbCh0aGlzLCBuZXcgcyh0aGlzKSk7CiAgICAgICAgfQoKICAgICAgICAiZnVuY3Rpb24iID09IHR5cGVvZiBlICYmICgibWVzc2FnZSIgPT09IHQgPyAoci5fbGlzdGVuZXIgPSBlLCB0aGlzLm9uKHQsIHIpKSA6ICJjbG9zZSIgPT09IHQgPyAobi5fbGlzdGVuZXIgPSBlLCB0aGlzLm9uKHQsIG4pKSA6ICJlcnJvciIgPT09IHQgPyAoYy5fbGlzdGVuZXIgPSBlLCB0aGlzLm9uKHQsIGMpKSA6ICJvcGVuIiA9PT0gdCA/IChoLl9saXN0ZW5lciA9IGUsIHRoaXMub24odCwgaCkpIDogdGhpcy5vbih0LCBlKSk7CiAgICAgIH0sCiAgICAgIHJlbW92ZUV2ZW50TGlzdGVuZXI6IGZ1bmN0aW9uIHJlbW92ZUV2ZW50TGlzdGVuZXIodCwgZSkgewogICAgICAgIHZhciByID0gdGhpcy5saXN0ZW5lcnModCk7CgogICAgICAgIGZvciAodmFyIF9uNiA9IDA7IF9uNiA8IHIubGVuZ3RoOyBfbjYrKykgewogICAgICAgICAgcltfbjZdICE9PSBlICYmIHJbX242XS5fbGlzdGVuZXIgIT09IGUgfHwgdGhpcy5yZW1vdmVMaXN0ZW5lcih0LCByW19uNl0pOwogICAgICAgIH0KICAgICAgfQogICAgfTsKICAgIHQuZXhwb3J0cyA9IGM7CiAgfSwgZnVuY3Rpb24gKHQsIGUsIHIpIHsKICAgIHZhciBuID0gcigwKSgid3gtd3M6c2VuZGVyIik7CgogICAgdC5leHBvcnRzID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAgICAgInVzZSBzdHJpY3QiOwoKICAgICAgZnVuY3Rpb24gX2NsYXNzKHQpIHsKICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgX2NsYXNzKTsKCiAgICAgICAgdGhpcy5fc29ja2V0ID0gdCwgdGhpcy5fcXVldWUgPSBbXSwgdGhpcy5fYnVmZmVyZWRCeXRlcyA9IDAsIHRoaXMuX2RlZmxhdGluZyA9ICExOwogICAgICB9CgogICAgICBfY3JlYXRlQ2xhc3MoX2NsYXNzLCBbewogICAgICAgIGtleTogInNlbmQiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBzZW5kKHQsIGUsIHIpIHsKICAgICAgICAgIG4oInNlbmQgbXNnOiAiLCB0LCAiIHNlbmRlcjogIiwgdGhpcywgdGhpcy5fZGVmbGF0aW5nKSwgdGhpcy5fZGVmbGF0aW5nID8gdGhpcy5lbnF1ZXVlKFt0aGlzLmRpc3BhdGNoLCB0LCBlLCByXSkgOiB0aGlzLmRpc3BhdGNoKHQsIGUsIHIpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImRpc3BhdGNoIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZGlzcGF0Y2godCwgZSwgcikgewogICAgICAgICAgbigiZGlzcGF0Y2ggbXNnOiAiLCB0LCAiLCBzZW5kZXI6ICIsIHRoaXMpLCB0aGlzLl9kZWZsYXRpbmcgPSAhMCwgImZ1bmN0aW9uIiA9PSB0eXBlb2YgZSAmJiAociA9IGUsIGUgPSB7fSksIHRoaXMuX2RlZmxhdGluZyA9ICExLCB0aGlzLl9zb2NrZXQuc2VuZCh7CiAgICAgICAgICAgIGRhdGE6IHQsCiAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIHN1Y2Nlc3ModCkgewogICAgICAgICAgICAgIHJldHVybiByICYmIHIobnVsbCwgdCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGZhaWw6IGZ1bmN0aW9uIGZhaWwodCkgewogICAgICAgICAgICAgIHJldHVybiByICYmIHIodCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLCB0aGlzLmRlcXVldWUoKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJkZXF1ZXVlIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZGVxdWV1ZSgpIHsKICAgICAgICAgIGZvciAoOyAhdGhpcy5fZGVmbGF0aW5nICYmIHRoaXMuX3F1ZXVlLmxlbmd0aDspIHsKICAgICAgICAgICAgdmFyIF90MiA9IHRoaXMuX3F1ZXVlLnNoaWZ0KCk7CgogICAgICAgICAgICB0aGlzLl9idWZmZXJlZEJ5dGVzIC09IF90MlsxXS5sZW5ndGgsIFJlZmxlY3QuYXBwbHkoX3QyWzBdLCB0aGlzLCBfdDIuc2xpY2UoMSkpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImVucXVldWUiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBlbnF1ZXVlKHQpIHsKICAgICAgICAgIHRoaXMuX2J1ZmZlcmVkQnl0ZXMgKz0gdFsxXS5sZW5ndGgsIHRoaXMuX3F1ZXVlLnB1c2godCk7CiAgICAgICAgfQogICAgICB9XSk7CgogICAgICByZXR1cm4gX2NsYXNzOwogICAgfSgpOwogIH0sIGZ1bmN0aW9uICh0LCBlKSB7CiAgICB0LmV4cG9ydHMgPSBmdW5jdGlvbiAodCwgZSkgewogICAgICBmb3IgKHZhciByID0gW10sIG4gPSAoZSA9IGUgfHwgMCkgfHwgMDsgbiA8IHQubGVuZ3RoOyBuKyspIHsKICAgICAgICByW24gLSBlXSA9IHRbbl07CiAgICAgIH0KCiAgICAgIHJldHVybiByOwogICAgfTsKICB9LCBmdW5jdGlvbiAodCwgZSkgewogICAgZnVuY3Rpb24gcih0KSB7CiAgICAgIHQgPSB0IHx8IHt9LCB0aGlzLm1zID0gdC5taW4gfHwgMTAwLCB0aGlzLm1heCA9IHQubWF4IHx8IDFlNCwgdGhpcy5mYWN0b3IgPSB0LmZhY3RvciB8fCAyLCB0aGlzLmppdHRlciA9IHQuaml0dGVyID4gMCAmJiB0LmppdHRlciA8PSAxID8gdC5qaXR0ZXIgOiAwLCB0aGlzLmF0dGVtcHRzID0gMDsKICAgIH0KCiAgICB0LmV4cG9ydHMgPSByLCByLnByb3RvdHlwZS5kdXJhdGlvbiA9IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIHQgPSB0aGlzLm1zICogTWF0aC5wb3codGhpcy5mYWN0b3IsIHRoaXMuYXR0ZW1wdHMrKyk7CgogICAgICBpZiAodGhpcy5qaXR0ZXIpIHsKICAgICAgICB2YXIgZSA9IE1hdGgucmFuZG9tKCksCiAgICAgICAgICAgIHIgPSBNYXRoLmZsb29yKGUgKiB0aGlzLmppdHRlciAqIHQpOwogICAgICAgIHQgPSAwID09ICgxICYgTWF0aC5mbG9vcigxMCAqIGUpKSA/IHQgLSByIDogdCArIHI7CiAgICAgIH0KCiAgICAgIHJldHVybiAwIHwgTWF0aC5taW4odCwgdGhpcy5tYXgpOwogICAgfSwgci5wcm90b3R5cGUucmVzZXQgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHRoaXMuYXR0ZW1wdHMgPSAwOwogICAgfSwgci5wcm90b3R5cGUuc2V0TWluID0gZnVuY3Rpb24gKHQpIHsKICAgICAgdGhpcy5tcyA9IHQ7CiAgICB9LCByLnByb3RvdHlwZS5zZXRNYXggPSBmdW5jdGlvbiAodCkgewogICAgICB0aGlzLm1heCA9IHQ7CiAgICB9LCByLnByb3RvdHlwZS5zZXRKaXR0ZXIgPSBmdW5jdGlvbiAodCkgewogICAgICB0aGlzLmppdHRlciA9IHQ7CiAgICB9OwogIH1dKTsKfSk7"},null]}